<%@ LANGUAGE="VBScript" %>
<%'Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved

'DO NOT EDIT THIS FILE%>

<%Response.Expires = 0
'Copyright 1988-2001 CambridgeSoft Corporation, all rights reserved.
dbkey="reg"
formgroup = request("formgroup")
if Not Session("UserValidated" & dbkey) = 1 then  response.redirect "/" & Application("Appkey") & "/logged_out.asp"
%>
<html>
<head>
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/cows_func_js.asp"-->
<!--#INCLUDE FILE = "../../source/secure_nav.asp"-->
<%'on error resume next
formmode = UCase(request("formmode"))
table_name = request("table_name")
if Not table_name  <> "" then
	table_name= Session("table_name")
else
	Session("table_name")=table_name
end if

Set DataConn = GetNewConnection(dbkey, formgroup, "base_connection")
if DataConn.State=0 then ' assume user has been logged out
	DoLoggedOutMsg()
end if
if (UCase(Request.QueryString("limit_access"))="ADD") OR Session("access_override" & table_name) <> ""  then
	Session("access_override" & table_name) = "ADD"
else
	Session("access_override" & table_name)= ""
end if

	Select case UCase(table_name)
		Case "RESULTTYPE"
			sql = "Select resulttype.result_type_id from resulttype where result_type_id>0"
		Case "EXPERIMENTTYPE"
			sql = "Select experimenttype.experiment_type_id from experimenttype where experiment_type_id>0"
		Case "PARAMETERTYPE"
			sql = "Select parametertype.parameter_type_id from parametertype where parameter_type_id>0"
	end Select
	RequeryDBRebuildRS dbkey, formgroup, sql, "", "",DataConn
	if  Session("hitlistrecordcount" & dbkey & formgroup) > 0 then
		Session("fEmptyRecordset" & dbkey & formgroup) = true
		
	else
		Session("fEmptyRecordset" & dbkey & formgroup) = false
		Session("error" & dbkey & formgroup)= false
	end if
	
	%>

<title>Chemical Registration - Manage Analytics Tables</title>
</head>
<body >
<!--#INCLUDE FILE = "../../source/app_vbs.asp"-->
<table border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td>
		<!--#INCLUDE VIRTUAL = "/cfserverasp/source/header_vbs.asp"-->
<%Session("ListLocation" & dbkey & formgroup) = Session("CurrentLocation" & dbkey & formgroup)%>

			<script language="javascript">
				if (bADD_ANALYTICS_TABLES.toLowerCase()=="true"){
					getFormViewLink('new', "/<%=Application("AppKey")%>/admin/manage_analytics_tables/manage_analytic_tables_result_form.asp",0,'add_record', "&table_name=" + "<%=table_name%>")
				}
			</script>
		</td>
	</tr>
</table>
<table border="1" cellpadding="0" cellspacing="0">

<%
if Not Session("fEmptyRecordset" & dbkey & formgroup) = True  then
	
	Select case UCase(table_name)
		Case "EXPERIMENTTYPE"
			relfields="experiment_type_id;2,experiment_type_name;0,experiment_type_description;0,experiment_type_created;0,experiment_type_modified;0,experiment_type_version;0"
		Case "RESULTTYPE"
			relfields="result_type_id;2,result_type_name;0,result_type_description;0,result_type_units;0"
		Case "PARAMETERTYPE"
			relfields="parameter_type_id;2,parameter_type_name;0,parameter_type_description;0,parameter_type_units;0"
	
		Case Else
			relfields = GetTableVal(dbkey, table_name, kTableRelFields)
	end select
	relfields_array = split(relfields, ",", -1)
	Response.Write "<tr>"

	for i = 0 to UBound(relfields_array)
		on error resume next
		temp_array = split(relfields_array(i), ";", -1)
		if instr(temp_array(0), ".")> 0 then
			new_array = split(temp_array(0), ".", -1)
			fieldname = new_array(1)
		else
			fieldname =temp_array(0)
		end if 
		if err.number > 0 then response.write "<strong>" & fieldname & "</strong>"
		Response.write "<th><font face=""Arial"" size=""1"" color=""Black""><strong>" & fieldname &  "</strong></font></th>"
	next
	Response.Write "</tr>"
end if
Session("LastStartingIndex" & dbkey & formgroup) =1%>
<!--#INCLUDE VIRTUAL ="/cfserverasp/source/recordset_vbs.asp"-->
<%'BaseID represents the primary key for the recordset from the base array for the current row
'BaseActualIndex is the actual id for the index the record is at in the array
'BaseRunningIndex if the id based on the number shown in list view
'BastTotalRecords is the recordcount for the array
'BaseRS (below is the recordset that is pulled for each record generated
	
	uniqueid = BaseID
	commit_type = "full_commit_ns"
	
	baseid_name = GetTableVal(dbkey, table_name, kPrimaryKey)
	sql = "Select * from " & table_name & " where " & baseid_name& "= " & BaseID

Set DataConn = GetNewConnection(dbkey, formgroup, "base_connection")
	Set BaseRS = DataConn.Execute(sql)
	if BaseRS.BOF <> True and BaseRS.EOF <> TRUE then
		BaseRS.MoveFirst
		
		%>
			<script language ="javascript">
		function getLink(field_val,force_formmode){
				var  commit_type = "full_commit_ns"
				var table_name = "<%=table_name%>"
				var uniqueid = "<%=baseid%>"
				getFormViewLink(field_val, "/<%=Application("AppKey")%>/admin/manage_analytics_tables/manage_analytic_tables_result_form.asp", <%=BaseActualIndex%>,force_formmode,uniqueid, "&table_name=" + table_name)
			}
		</script>
		<tr>
		<%for i = 0 to UBound(relfields_array)
			value = ""
			link_value = ""
			temp_array = split(relfields_array(i), ";", -1)
			if instr(temp_array(0), ".")> 0 then
				new_array = split(temp_array(0), ".", -1)
				fieldname = new_array(1)
			else
				fieldname =temp_array(0)
			end if 
			
			if Not (BaseRS.BOF AND BaseRS.EOF) then
					value = BaseRS(fieldname)
				else
					value = ""
			end if
			%>
			<td>
			<%
			if i = 0 then
				if bEDIT_ANALYTICS_TABLES= True or bDELETE_ANALYTICS_TABLES = True then
					bEdit = True
				end if
				if bEdit = True AND Not Session("access_override" & table_name)<> ""  then 
					bEditTable = True 
				else 
					bEditTable = False
				end if
		
				if bEditTable = True then%>
				
					<script language="javascript">
						link_value = "<%=value%>"
						if(link_value.length > 0 ) {
							getLink(link_value, "edit_record")
						}
						else {
							document.write('')
						}
					</script>
				<%else
				Response.Write value
				end if
			else
				
				if value = "" then
					value = "&nbsp;"
				end if
				if UCase(fieldname) = "ACTIVE" then
				value = CBool(value)
				end if
				Response.Write "<font face=""Arial"" size=""1"" color=""Black"">" & value & " </font>"
		   end if%>
		   </td>
		 
		<%next%>  
		<%CloseRS(BaseRS)%>
		<%CloseConn(DataConn)%>
	<%end if 'if BaseRS.BOF <> True and BaseRS.EOF <> TRUE%>
<!--#INCLUDE VIRTUAL ="/cfserverasp/source/recordset_footer_vbs.asp"-->
</tr></table>

</body>
</html>























