<%@ LANGUAGE="VBScript" %>
<%'Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved

'DO NOT EDIT THIS FILE%>

<%
Response.Expires = -1
'Copyright 1988-2001 CambridgeSoft Corporation, all rights reserved.
dbkey="reg"
formgroup = request("formgroup")
if Not Session("UserValidated" & dbkey) = 1 then  response.redirect "/" & Application("Appkey") & "/logged_out.asp"
%><html>
<head>
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/cows_func_js.asp"-->
<!--#INCLUDE FILE = "../../source/secure_nav.asp"-->

<%
formmode = UCase(request("formmode"))

%>
<title>Chemical Registration - Manage Tables</title>
<%'Response.write "at the beginning, currentrecord = " & Session("CurrentRecord" & dbkey & formgroup)%>


<script language="JavaScript">
<!-- Script hiding
	function go_url(theURL) {
		// Get the new URL, open a window, send the browser to the window
		var newWin;
		alert(theURL);
		newWin = document.open(theURL, "_URL", "resize=no");
	}
	
	function delete_parameter(theID, theExperiment) {
		// Open a temporary window which will then delete the relevent Parameter entry
		alert("Will Delete Parameter ID: " + theID + " from Experiment ID: " + theExperiment);
	}

	function delete_result(theID, theExperiment) {
		// Open a temporary window which will then delete the relevent Result entry
		alert("Will Delete Result ID: " + theID + " from Experiment ID: " + theExperiment);
	}

	function add_parameter(theExperiment) {
		// Open a temporary window which will then delete the relevent Result entry
		alert("Will Add Parameter to Experiment ID: " + theExperiment);
		// open('/chem_reg/reg/givaudan/manage_analytics_tables/MA_add_parameter.asp?etype='+theExperiment,'MA_add_par','height=300,width=400,menubar,resizeable');
	}

	function add_result(theExperiment) {
		// Open a temporary window which will then delete the relevent Result entry
		alert("Will Add Result to Experiment ID: " + theExperiment);
	}
// end script hiding --> 
</script>

</head>

<body >
<!--#INCLUDE FILE = "../../source/app_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/header_vbs.asp"-->
<%'Response.write "now, currentrecord = " & Session("CurrentRecord" & dbkey & formgroup)%>
<%
Session("fEmptyRecordset" & "reg") = False

tmp = Session("CurrentRecord" & dbkey & formgroup)
Session("override_current_index" & dbkey & formgroup)=true
%>
<!--#INCLUDE VIRTUAL ="/cfserverasp/source/recordset_vbs.asp"-->
<%Session("CurrentRecord" & dbkey & formgroup) = tmp%>

<%'Response.write "then, currentrecord = " & Session("CurrentRecord" & dbkey & formgroup)%>
<%'Response.write "pagemove = " &Request.Cookies("PagingMove" & dbkey & formgroup)%>
<%'Response.write "gotoValue = " &gotoValue%>
<!--formmode: <%=formmode%><br>-->

<%'BaseID represents the primary key for the recordset from the base array for the current row
'BaseActualIndex is the actual id for the index the record is at in the array
'BaseRunningIndex if the id based on the number shown in list view
'BastTotalRecords is the recordcount for the array
'BaseRS (below is the recordset that is pulled for each record generated
'on error resume next
	if formmode = "ADD_RECORD" then
		bAdd = true
		bUpdate = false
	else
		bAdd = false
		bUpdate = true
	end if
	'Response.Write "BaseID=" & BaseID
	'Response.Write "current_index = " & current_index
	'Response.write "currentrecord = " & Session("CurrentRecord" & dbkey & formgroup)
	uniqueid = BaseID
	commit_type = "full_commit_ns"
	table_name = request("table_name")
	Set DataConn = GetConnection(dbkey, formgroup, table_name)
	if DataConn.State=0 then ' assume user has been logged out
		DoLoggedOutMsg()
	end if
	if bUpdate = true then
		baseid_name = GetTableVal(dbkey, table_name, kPrimaryKey)
		datatype =getDataType(dbkey,  formgroup,  table_name & "." & baseid_name)
		delimiter = GetFieldDelimiter(datatype)
		sql = "Select * from " & table_name & " where " & baseid_name & "=" & delimiter&  BaseID & delimiter	
		'Response.Write sql
		Set BaseRS = DataConn.Execute(sql)
	end if
	
%>

<%Select Case UCase(table_Name)
Case "PARAMETERTYPE"%>
<script language="javascript">
	required_fields="parametertype.parameter_type_name;0:Parameter Name"
</script>	
<table border = 0>
<%if bUpdate = true then%>
<tr><td>ID</td><td><%ShowResult dbkey, formgroup, BaseRS,"parametertype.parameter_type_id", "raw_no_edit", "30", "50"%></td></tr>
<%end if%>
<tr><td>Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"parametertype.parameter_type_name", "raw", "30", "50"%></td></tr>
<tr><td>Description</td><td><%ShowResult dbkey, formgroup, BaseRS,"parametertype.parameter_type_description", "raw", "30", "50"%></td></tr>
<tr><td>Units</td><td><%ShowResult dbkey, formgroup, BaseRS,"parametertype.parameter_type_units", "raw", "30", "50"%></td></tr>
</table>
<%Case "RESULTTYPE"%>
<script language="javascript">
	required_fields="resulttype.result_type_name;0:Result Name"
</script>	
<table border = 0>
<%if bUpdate = true then%>
<tr><td>ID</td><td><%ShowResult dbkey, formgroup, BaseRS,"resulttype.result_type_id", "raw_no_edit", "30", "50"%></td></tr>
<%end if%>
<tr><td>Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"resulttype.result_type_name", "raw", "30", "50"%></td></tr>
<tr><td>Description</td><td><%ShowResult dbkey, formgroup, BaseRS,"resulttype.result_type_description", "raw", "30", "50"%></td></tr>

<tr><td>Units</td><td><%ShowResult dbkey, formgroup, BaseRS,"resulttype.result_type_units", "raw", "30", "50"%></td></tr>
</table>
<%Case "EXPERIMENTTYPE"%>
<script language="javascript">
	required_fields="experimenttype.experiment_type_name;0:Experiment Name"
</script>
<table border = 0>
<%if bUpdate = true then%>
<tr><td>ID</td><td><%ShowResult dbkey, formgroup, BaseRS,"experimenttype.experiment_type_id", "raw_no_edit", "30", "50"%></td></tr>
<%end if%>
<tr><td>Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"experimenttype.experiment_type_name", "raw", "30", "50"%></td></tr>
<tr><td>Description</td><td><%ShowResult dbkey, formgroup, BaseRS,"experimenttype.experiment_type_description", "raw", "", "50"%></td></tr>

<tr><td>Created</td><td><%ShowResult dbkey, formgroup, BaseRS,"experimenttype.experiment_type_created", "raw", "DATE_PICKER:8","17"%></td></tr>
<tr><td>Modified</td><td><%ShowResult dbkey, formgroup, BaseRS,"experimenttype.experiment_type_modified", "raw", "DATE_PICKER:8","17"%></td></tr>


<tr><td>Version</td><td><%ShowResult dbkey, formgroup, BaseRS,"experimenttype.experiment_type_version", "raw", "SCRIPT:isValid(this,3)", "50"%></td></tr>
</table>
<%end select%>

<!--#INCLUDE VIRTUAL ="/cfserverasp/source/recordset_footer_vbs.asp"-->
<br>
<table cellspacing="0" cellpadding="0" border="1" bordercolor="Silver" bgcolor="White">
	<tr>
		<td align="left" valign="top">
<% if UCase(table_name)= "EXPERIMENTTYPE" and bUpdate = true then 

Dim mapRS, eType
eType = BaseRS("experiment_type_id").Value
' sql ="select par.parameter_type_name,par.parameter_type_id,exp.experiment_type_name,etype.experiment_type_id,etype.parameter_type_id"
sql ="select exp.experiment_type_name,par.parameter_type_name,par.parameter_type_units,par.parameter_type_id,exp.experiment_type_id"
sql = sql & " from experimenttypeparameters etype, parametertype par, experimenttype exp"
sql = sql & " where exp.experiment_type_id=etype.experiment_type_id and par.parameter_type_id=etype.parameter_type_id"
sql = sql & " and etype.experiment_type_id=" & eType

' Response.Write "Get parameters using SQL: " & sql & "<br>"
Response.Write "<font face=""Arial"" color=""Navy"" Size=""3"">Parameter Types</font><br>"
on error resume next
Set mapRS = DataConn.Execute(sql)
if mapRS.BOF = True and mapRS.EOF = True then
	Response.Write "<font face=""Arial"" color=""Red"" Size=""2"">No parameter types set.<br></font>"
%>
<script language="JavaScript">
<!-- // hide script from older browsers
getFormViewBtn("add_parameter_btn.gif", "/<%=Application("appkey")%>/admin/manage_analytics_tables/MA_add_parameter.asp", "<%=eType%>","MA_ADD","self","manage_analytics_tables_form_group","<%=eType%>")
//getFormViewBtn("add_parameter_btn.gif", "/<%=Application("appkey")%>/admin/manage_analytics_tables/MA_add_parameter.asp", "<%=Session("CurrentRecord" & dbkey & formgroup)%>","MA_ADD","self","manage_analytics_tables_form_group","<%=Session("CurrentRecord" & dbkey & formgroup)%>")
// -->
</script>
<%
else
	' Get the parameter map and show it to the user...
	Response.Write "<table border=""1"" cellspacing=""0"" cellpadding=""0"" bgcolor=""White""><tr>"
	' Add the column for the add/delete buttons
	Response.Write "<th>"
%>
<script language="JavaScript">
<!-- // hide script from older browsers
getFormViewBtn("add_parameter_btn.gif", "/<%=Application("appkey")%>/admin/manage_analytics_tables/MA_add_parameter.asp", "<%=eType%>","MA_ADD","self","manage_analytics_tables_form_group","<%=eType%>")
//getFormViewBtn("add_parameter_btn.gif", "/<%=Application("appkey")%>/admin/manage_analytics_tables/MA_add_parameter.asp", "<%=Session("CurrentRecord" & dbkey & formgroup)%>","MA_ADD","self","manage_analytics_tables_form_group","<%=Session("CurrentRecord" & dbkey & formgroup)%>")
// -->
</script>
<%
	' Response.Write "&nbsp;<a href=""javascript:add_parameter('" & mapRS("experiment_type_id").Value & "')"" alt=""Add Parameter""><img SRC=""/chem_reg/graphics/add_parameter_btn.gif"" border=""0"" alt=""Add Parameter""></a>"
	Response.Write "</th>"
	' Add specific fields only
	Response.Write "<th><font face=""Arial"" color=""Black"" Size=""1"">Parameter Type</font></th>"
	Response.Write "<th><font face=""Arial"" color=""Black"" Size=""1"">Standard Units</font></th>"
	Response.Write "</tr>"
	do while Not mapRS.EOF=True
		' Get the next mapping element line...
		Response.Write "<tr>"
		' Prepend the delete button
		Response.Write "<td>"
		If  Session("DELETE_ANALYTICS_TABLES" & dbkey) = true then
		
%>
<script language="JavaScript">
<!-- // hide script from older browsers
getFormViewBtn("delete_btn.gif", "/<%=Application("appkey")%>/admin/manage_analytics_tables/MA_delete_parameter.asp", "<%=eType%>","MA_DELETE","self","manage_analytics_tables_form_group","<%=mapRS("parameter_type_id").value%>")
//getFormViewBtn("delete_btn.gif", "/<%=Application("appkey")%>/admin/manage_analytics_tables/MA_delete_parameter.asp", "<%=Session("CurrentRecord" & dbkey & formgroup)%>","MA_DELETE","self","manage_analytics_tables_form_group","<%=mapRS("parameter_type_id").value%>")
// -->
</script>
<%
		' Response.Write "<a href=""javascript:delete_parameter('" & mapRS("parameter_type_id").value & "', '" & mapRS("experiment_type_id").Value & "')"" alt=""Delete Parameter""><img SRC=""/chem_reg/graphics/delete_btn.gif"" border=""0"" alt=""Delete Parameter""></a>"
		else
		Response.Write "&nbsp;"
		end if
		Response.Write "</td>"
		

		' Write only specific columns rather than all of them...
		Response.Write "<td><font face=""Arial"" color=""Black"" Size=""1"">" & mapRS("parameter_type_name").Value & "</font></td>"
		Response.Write "<td><font face=""Arial"" color=""Black"" Size=""1"">" & mapRS("parameter_type_units").Value & "</font></td>"
		
		Response.Write "</tr>"

		mapRS.MoveNext
	loop
	Response.Write "</tr></table>"
end if

if mapRS.State = adStateOpen then mapRS.Close
Set mapRS=Nothing

%>
		</td>
		<td align="left" valign="top">
<%
on error resume next
' sql ="select res.result_type_name,res.result_type_id,exp.experiment_type_name,etype.experiment_type_id,etype.result_type_id"
sql ="select exp.experiment_type_name,res.result_type_name,res.result_type_id,res.result_type_units,exp.experiment_type_id"
sql = sql & " from experimenttyperesults etype, resulttype res, experimenttype exp"
sql = sql & " where exp.experiment_type_id=etype.experiment_type_id and res.result_type_id=etype.result_type_id"
sql = sql & " and etype.experiment_type_id=" & BaseRS("experiment_type_id").Value

' Response.Write "Get results using SQL: " & sql & "<br>"
Response.Write "<font face=""Arial"" color=""Navy"" Size=""3"">Result Types</font><br>"

Set mapRS = DataConn.Execute(sql)
if mapRS.BOF=True and mapRS.EOF=True then
	Response.Write "<font face=""Arial"" color=""Red"" Size=""2"">No result types set.<br></font>"
%>
<script language="JavaScript">
<!-- // hide script from older browsers
getFormViewBtn("add_result_btn.gif", "/<%=Application("appkey")%>/admin/manage_analytics_tables/MA_add_result.asp", "<%=eType%>","MA_ADD","self","manage_analytics_tables_form_group","<%=eType%>")
//getFormViewBtn("add_result_btn.gif", "/<%=Application("appkey")%>/admin/manage_analytics_tables/MA_add_result.asp", "<%=Session("CurrentRecord" & dbkey & formgroup)%>","MA_ADD","self","manage_analytics_tables_form_group","<%=Session("CurrentRecord" & dbkey & formgroup)%>")
// -->
</script>
<%
else
	' Get the parameter map and show it to the user...
	Response.Write "<table border=""1"" cellspacing=""0"" cellpadding=""0"" bgcolor=""White""><tr>"
	Response.Write "<th>"
%>
<script language="JavaScript">
<!-- // hide script from older browsers
getFormViewBtn("add_result_btn.gif", "/<%=Application("appkey")%>/admin/manage_analytics_tables/MA_add_result.asp", "<%=mapRS("experiment_type_id").Value%>","MA_ADD","self","manage_analytics_tables_form_group","<%=mapRS("experiment_type_id").Value%>")
//getFormViewBtn("add_result_btn.gif", "/<%=Application("appkey")%>/admin/manage_analytics_tables/MA_add_result.asp", "<%=mapRS("experiment_type_id").Value%>","MA_ADD","self","manage_analytics_tables_form_group","<%=mapRS("experiment_type_id").Value%>")
// -->
</script>
<%
	' Response.Write "<a href=""javascript:add_result('" & mapRS("experiment_type_id").Value & "')"" alt=""Add Result""><img SRC=""/chem_reg/graphics/add_result_btn.gif"" border=""0"" alt=""Add Result""></a>"
	Response.Write "</th>"
	Response.Write "<th><font face=""Arial"" color=""Black"" Size=""1"">Result Type</font></th>"
	Response.Write "<th><font face=""Arial"" color=""Black"" Size=""1"">Standard Units</font></th>"
	Response.Write "</tr>"
	do while Not mapRS.EOF=True
		' Get the next mapping element line...
		Response.Write "<tr>"
		' Prepend the delete button
		Response.Write "<td>"
		If  Session("DELETE_ANALYTICS_TABLES" & dbkey) = true then
		
%>
<script language="JavaScript">
<!-- // hide script from older browsers
getFormViewBtn("delete_btn.gif", "/<%=Application("appkey")%>/admin/manage_analytics_tables/MA_delete_result.asp", "<%=eType%>","MA_DELETE","self","manage_analytics_tables_form_group","<%=mapRS("result_type_id").value%>")
//getFormViewBtn("delete_btn.gif", "/<%=Application("appkey")%>/admin/manage_analytics_tables/MA_delete_result.asp", "<%=Session("CurrentRecord" & dbkey & formgroup)%>","MA_DELETE","self","manage_analytics_tables_form_group","<%=mapRS("result_type_id").value%>")
// -->
</script>
<%
		' Response.Write "<a href=""javascript:delete_result('" & mapRS("result_type_id").value & "', '" & mapRS("experiment_type_id").Value & "')"" alt=""Delete Result""><img SRC=""/chem_reg/graphics/delete_btn.gif"" border=""0"" alt=""Delete Result""></a>"
		else
		Response.Write "&nbsp;"
		end if
		Response.Write "</td>"
		
		Response.Write "<td><font face=""Arial"" color=""Black"" Size=""1"">" & mapRS("result_type_name").Value & "</font></td>"
		Response.Write "<td><font face=""Arial"" color=""Black"" Size=""1"">" & mapRS("result_type_units").Value & "</font></td>"

		Response.Write "</tr>"
		mapRS.MoveNext
	loop
	Response.Write "</tr></table>"
end if

if mapRS.State = adStateOpen then mapRS.Close
Set mapRS=Nothing

%>
<!-- close enclosing two column table -->
	</td>
</tr>
</table>

<!--
No JavaScript No URL:  <img src="/chem_reg/graphics/delete_btn.gif" alt="Delete Button"><br>
JavaScript No URL: <a href="javascript:go_url('http://www.google.com/')"><img src="/<%=Application("AppKey")%>/graphics/delete_btn.gif" alt="Delete Button"></a><br>
No JavaScript URL: <a href="http://www.google.com/" target="_Google"><img src="/<%=Application("AppKey")%>/graphics/delete_btn.gif" alt="Delete Button"></a><br>
<br>
<a href="#" onClick="open('/<%=Application("AppKey")%>/reg/admin/manage_analytics_tables/MA_add_parameter.asp?etype=3','MA_add_par','height=200,width=200,menubar,resizeable');">
Add Parameter...
</a>
<br>
<a href="#" onClick="open('/<%=Application("AppKey")%>/reg/admin/manage_analytics_tables/MA_add_result.asp?etype=3','MA_add_res','height=200,width=200,menubar,resizeable');">
Add Result...
</a>
<br>
-->
<%else
if UCase(table_name)= "EXPERIMENTTYPE" and bUpdate = false then 
Response.Write "To add parameters types and result types, please add the new experiment type and then edit the new record"
end if
end if%>
<%
' Store the current location for use in the wizards...
lRT = Session("CurrentLocation" & dbkey & formgroup)
Session("MA_return_to") = lRT
%>
</tr></td></table>
</body>
</html>



























