<%@ LANGUAGE="VBScript" %>
<%'Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved

'DO NOT EDIT THIS FILE%>

<%Response.Expires = 0
'Copyright 1988-2001 CambridgeSoft Corporation, all rights reserved.
dbkey="reg"
formgroup = request("formgroup")
if Not Session("UserValidated" & dbkey) = 1 then  response.redirect "/" & Application("Appkey") & "/logged_out.asp"
%>
<html>

<head>
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/cows_func_js.asp"-->
<!--#INCLUDE FILE = "../../source/secure_nav.asp"-->



<%
formmode = UCase(request("formmode"))

%>



<title>Chemical Registration - Manage Tables</title>
</head>

<body >
<!--#INCLUDE FILE = "../../source/app_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/header_vbs.asp"-->
<!--#INCLUDE VIRTUAL ="/cfserverasp/source/recordset_vbs.asp"-->

<%'BaseID represents the primary key for the recordset from the base array for the current row
'BaseActualIndex is the actual id for the index the record is at in the array
'BaseRunningIndex if the id based on the number shown in list view
'BastTotalRecords is the recordcount for the array
'BaseRS (below is the recordset that is pulled for each record generated
on error resume next
	if formmode = "ADD_RECORD" then
		bAdd = true
		bUpdate = false
		bEditWG = true
		bEditUserID = true
	else
		bAdd = false
		bUpdate = true
		if Session("Edit_WorkGroup" & dbkey) = True OR  Session("Add_WorkGroup" & dbkey) = True  OR Session("Delete_WorkGroup" & dbkey) = True then
			bEditWG=true
		else
			bEditWG=false
		end if
		if Session("Edit_Users_Table" & dbkey) =  True then
			bEditUserID=true
		else
			bEditUserID=false
		end if
	end if
	
	uniqueid = BaseID
	commit_type = "full_commit_ns"
	table_name = request("table_name")
	if Not table_name <> "" then
		Response.Write "no_table_name"
		Response.End
	end if


	Set DataConn = GetConnection(dbkey, formgroup, table_name)
	if DataConn.State=0 then ' assume user has been logged out
		DoLoggedOutMsg()
	end if
	if bUpdate = true then
		baseid_name = GetTableVal(dbkey, table_name, kPrimaryKey)
		datatype =getDataType(dbkey,  formgroup,  table_name & "." & baseid_name)
		delimiter = GetFieldDelimiter(datatype)
		sql = "Select * from " & table_name & " where " & baseid_name & "=" & delimiter&  BaseID & delimiter	
		Set BaseRS = DataConn.Execute(sql)
	end if
	
%>



<%ActiveFlag_TEXT= CBool(BaseRS("Active"))
if bUpdate = true then
ActiveFlag_VAL = BaseRS("Active")
ActiveFlag_LIST="1:True,0:False"
else
ActiveFlag_VAL = True
ActiveFlag_LIST="1"
end if

Select Case UCase(table_Name)
Case "NOTEBOOKS"
if bUpdate = true then
	Lookup_People_Person_ID_TEXT = getValueFromTablewConn(DataConn,"People", "person_id", BaseRS("User_code"), "Last_Name")			
	Lookup_People_Person_ID_VAL =  BaseRS("User_code")
end if

Lookup_People_Person_ID_LIST= GetPeopleList(DataConn)

Case "PEOPLE"
if bUpdate = true then
	Lookup_People_Person_ID_TEXT = getValueFromTablewConn(DataConn,"People", "person_ID", BaseRS("User_code"), "Last_Name")			
	Lookup_People_Person_ID_VAL =  BaseRS("Supervisor_Internal_ID")
	Lookup_Site_Site_ID_TEXT = getValueFromTablewConn(DataConn,"Sites", "Site_ID", BaseRS("Site_ID"), "Site_Name")	
	Lookup_Site_Site_ID_VAL =  BaseRS("Site_ID")
	Lookup_People_UserID_TEXT = BaseRS("User_ID")
	Lookup_People_UserID_VAL = BaseRS("User_ID")
	currentPeople_ID = UCase(Lookup_People_UserID_VAL) & ":" & UCase(Lookup_People_UserID_TEXT)
end if
	Lookup_People_Person_ID_LIST= GetPeopleList(DataConn)
	Lookup_Site_Site_ID_LIST= GetSiteList(DataConn)
	if bUpdate = true THEN
		if bEditUserID = true then
			theList = ListAllUnBoundUsers(dbkey, formgroup,"chem_reg_privileges")
			if Not theList <> "" then
				Lookup_People_UserID_LIST=currentPeople_ID & "," & "Login Disabled:Login Disabled"
			else
				Lookup_People_UserID_LIST=theList & "," & currentPeople_ID & "," & "Login Disabled:Login Disabled"
			end if
		else
			Lookup_People_UserID_LIST= ""
		end if
	else
		theList = ListAllUnBoundUsers(dbkey, formgroup,"chem_reg_privileges")
		if theList <> "" then
			Lookup_People_UserID_LIST=theList & "," & "Login Disabled:Login Disabled"
		else
			Lookup_People_UserID_LIST= "Login Disabled:Login Disabled"
		end if
	end if
End Select
Select Case UCase(table_Name)
<%Case "SITES"%>
<table border = 0>
<%if bUpdate = true then%>
<tr><td>ID</td><td><%ShowResult dbkey, formgroup, BaseRS,"Sites.Site_ID", "raw_no_edit", "0", "30"%></td></tr>
<%end if%>
<tr><td>Site Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"Sites.Site_Name", "raw", "0", "30"%></td></tr>
<tr><td>Site Code</td><td><%ShowResult dbkey, formgroup, BaseRS,"Sites.Site_Code", "raw", "0", "30"%></td></tr>
<tr><td>Active</td><td><%ShowLookUpList dbkey, formgroup,BaseRS,"Sites.Active",ActiveFlag_LIST,  ActiveFlag_VAL,ActiveFlag_TEXT,0,false,"value","1"%></td></tr>
</table>


<%Case "PEOPLE"%>
<table border = 0>
<%if bUpdate = true then%>
<tr><td>ID</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Person_ID", "raw_no_edit", "0", "30"%></td></tr>
<%end if%>
<tr><td>Chemist Code</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.User_Code", "raw", "0", "30"%></td></tr>
<%if bAdd = True then%>
<tr><td>Unbound User_ID</td><td><%
ShowLookUpList dbkey, formgroup,BaseRS,"People.User_ID",Lookup_People_UserID_LIST, Lookup_People_UserID_VAL,Lookup_People_UserID_TEXT,0,false,"value","Login Disabled"%></td></tr>
<%else%>
<tr><td>User_ID</td><td><%ShowLookUpList dbkey, formgroup,BaseRS,"People.User_ID",Lookup_People_UserID_LIST, Lookup_People_UserID_VAL,Lookup_People_UserID_TEXT,0,false,"value","Login Disabled"%></td></tr>

<%end if%>
<tr><td>Supervisor/Workgroup ID</td><td><%ShowLookUpList dbkey, formgroup,BaseRS,"People.Supervisor_Internal_ID", Lookup_People_Person_ID_LIST,  Lookup_People_Person_ID_VAL,Lookup_People_Person_ID_TEXT,0,false,"value","1"%></td></tr>

<tr><td>First Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.First_Name", "raw", "0", "30"%></td></tr>
<tr><td>Middle Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Middle_Name", "raw", "0", "30"%></td></tr>
<tr><td>Last Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Last_Name", "raw", "0", "30"%></td></tr>
<tr><td>Site</td><td><%ShowLookUpList dbkey, formgroup,BaseRS,"People.Site_ID",Lookup_Site_Site_ID_LIST,  Lookup_Site_Site_ID_VAL,Lookup_Site_Site_ID_TEXT,0,false,"value","1"%></td></tr>
</td></tr>

<tr><td>Telephone</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Telephone", "raw", "0", "30"%></td></tr>
<tr><td>Email</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Email", "raw", "0", "30"%></td></tr>
<tr><td>Active</td><td><%ShowLookUpList dbkey, formgroup,BaseRS,"People.Active",ActiveFlag_LIST,  ActiveFlag_VAL,ActiveFlag_TEXT,0,false,"value","1"%></td></tr>

</table>
<%End Select%>

<!--#INCLUDE VIRTUAL ="/cfserverasp/source/recordset_footer_vbs.asp"-->




</body>
</html>



























