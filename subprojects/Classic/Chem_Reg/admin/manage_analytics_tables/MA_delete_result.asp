<%@ LANGUAGE="VBScript" %>
<%'Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved

'DO NOT EDIT THIS FILE%>

<%Response.Expires = 0
'Copyright 1988-2001 CambridgeSoft Corporation, all rights reserved.
dbkey="reg"
formgroup = request("formgroup")
if Not Session("UserValidated" & dbkey) = 1 then  response.redirect "/" & Application("Appkey") & "/logged_out.asp"
%>
<HTML>
<HEAD>
<META NAME="GENERATOR" Content="Microsoft Visual Studio 6.0">
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/cows_func_js.asp"-->
<!--#INCLUDE FILE = "../../source/secure_nav.asp"-->
<%
Dim DataConn, oRS, sql, oCmd
dim eType, tStep, pType
' Collect data
if Request.Form("STEP") <> "" then tStep = Request.Form("STEP")
if Request.QueryString("etype") <> "" Then eType = Request.QueryString("etype")
if Request.QueryString("ptype") <> "" Then pType = Request.QueryString("ptype")
if Request.QueryString("indexvalue") <> "" and eType = "" then eType=Request.QueryString("indexvalue")
if Request.QueryString("alt_unique_id") <> "" and pType = "" then pType=Request.QueryString("alt_unique_id")
%>
</HEAD>
<BODY>
<!--#INCLUDE FILE = "../../source/app_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/header_vbs.asp"-->
<% if tStep="" and eType <> "" Then %>
<!-- Set up the available results and get the user to add one -->
<%

' Store the etype...
Session("MA_etype") = eType
Session("MA_ptype") = pType
%>
<P>
<FONT face="Arial" size="2" color="Navy"><STRONG>Step 1 of 2</STRONG> - Confirm deletion of Result: <%=pType%> for ExperimentTypeID: <%=eType%></FONT></P>
<FORM METHOD="Post" ACTION="\chem_reg\analytics\manage_analytics_tables\MA_delete_result.asp" ID="FormStep1" NAME="FormStep1">
<FONT face="Arial" size="2" color="Navy">Result Type : </FONT>
<SELECT NAME="ConfirmDelete" SIZE="1">
<OPTION SELECTED VALUE="Yes">Yes</OPTION>
<OPTION VALUE="No">No</OPTION>
</SELECT>
<INPUT TYPE="Hidden" NAME="STEP" VALUE="1">
<INPUT TYPE="Submit" ID="Submit" NAME="Submit" VALUE="Next &gt;">
</FORM>

<% elseif tStep="1" then %>
<%

if Request.Form("ConfirmDelete") = "Yes" Then
	eType = Session("MA_etype")
	pType = Session("MA_ptype")

	Set DataConn = GetConnection(dbkey, formgroup, "experimenttype")
	if DataConn.State=0 then ' assume user has been logged out
		DoLoggedOutMsg()
	end if
	' Delete the result from the table
	' then try to tell the main window to refresh :-)

	Set oCmd = Server.CreateObject("ADODB.Command")
	oCmd.ActiveConnection = DataConn
	oCmd.CommandType = adCmdText

	sql = "DELETE FROM experimenttyperesults WHERE experiment_type_id=" & eType & " AND result_type_id=" & pType
	oCmd.CommandText = sql
	oCmd.Execute

	if DataConn.Errors.Count <> 0 then
		for each lError in DataConn.Errors
			Response.Write "<br>Connection Error: " & lError.Number & "<br>"
			Response.Write "         Source : " & lError.Source & "<br>"
			Response.Write "    Description : " & lError.Description & "<br>"
		next
	end if

	Set oCmd=Nothing
	CloseConn(DataConn)

	showmessagedialog("Result deleted")
	redirectpath=MakeQueryStringBeDifferent(Session("MA_return_to"))
	doredirect dbkey,redirectpath
	
else
	showmessagedialog("Result not deleted")
	redirectpath=MakeQueryStringBeDifferent(Session("MA_return_to"))
	doredirect dbkey,redirectpath
end if
%>
<% else %>
Should not come here...<br>
The request.querystring was: <%=Request.QueryString%>
The step is: "<%=tStep%>", the eType is: "<%=eType%>"<br>
<% end if %>
<!-- <a href="#" OnClick="window.close()">Close</a> -->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/input_form_footer_vbs.asp"-->
</BODY>
</HTML>
