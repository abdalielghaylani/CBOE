<%@ LANGUAGE=VBScript%>
<%'Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved

'DO NOT EDIT THIS FILE%>

<%
' Response.Buffer = True
Response.Expires = 0
dbkey = "reg"
if Not Session("UserValidated" & dbkey) =  1 then  response.redirect "/" & Application("AppKey") & "/logged_out.asp"
Dim GF_debug
GF_debug=False
%>
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/cows_func_js.asp"-->
<!--#INCLUDE FILE = "../source/secure_nav.asp"-->
<title>Chemical Registration - Analytics Results Form View</title>
</head>
<body <%=Application("BODY_BACKGROUND") & """ bgProperties=fixed"%>>
<!--#INCLUDE FILE = "../source/app_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/header_vbs.asp"-->

<%
' on error resume next

lsBatchID = request.querystring("alt_unique_id")
lsFullID = request.querystring("unique_id")
BaseActualIndex =request.querystring("indexvalue")

if GF_debug=True then
Response.Write "lsBatchID: " & lsBatchID & "<br>"
Response.Write "lsFullID: " & lsFullID & "<br>"
Response.Write "BaseActualIndex: " & BaseActualIndex & "<br>"
Response.Write "Request.QueryString: " & Request.QueryString & "<br>"

end if

Set RegConn=getRegConn(dbkey, formgroup)
if RegConn.State=0 then ' assume user has been logged out
		DoLoggedOutMsg()
end if
set oCmd = Server.CreateObject("ADODB.COMMAND")
oCmd.ActiveConnection = RegConn
oCmd.CommandType = adCmdText
Set BaseRS = Server.CreateObject("ADODB.Recordset")
Set RegRS = Server.CreateObject("ADODB.Recordset")
Set MoleculesRS = Server.CreateObject("ADODB.Recordset")

' sql = GetDisplaySQL(dbkey, formgroup,"Batches.*", "Batches", "", lsBatchID, "")
sql = "SELECT reg_internal_id,MOL_ID,batch_number,batch_internal_id from batches WHERE batch_internal_id=?"
oCmd.CommandText = sql
oCmd.Parameters.Append oCmd.CreateParameter("pBatchID", 139, 1, 0, lsBatchID) 
BaseRS.Open oCmd
oCmd.Parameters.Delete "pBatchID"

if err.number <> 0 and RegConn.Errors.count <> 0  and (Not err.number = "265946")then
	for each oErr in RegConn.Errors
		if not oErr.number = 265946 then
			if oErr.number <> 0  then
				Response.Write "ERROR: " & oErr.number & " SOURCE: " & oErr.source & " DESC: " & oErr.description & "<BR>"
			else
				Response.Write "WARNING: " & oErr.number & " SOURCE: " & oErr.source & " DESC: " & oErr.description & "<BR>"
			end if
		end if
	next 
end if
if BaseRS.EOF=True and BaseRS.BOF=True then
	Response.Write "ERROR: No records found in Batches table with SQL:<br>" & sql & "<BR>"
else
	lsRegID = BaseRS("reg_internal_id").Value
	lsBatchMolID = BaseRS("MOL_ID").Value
end if

sql = "Select cpd_internal_id,MOL_ID,reg_number from Reg_Numbers where reg_id=?"
set oCmd = Server.CreateObject("ADODB.COMMAND")
oCmd.ActiveConnection = RegConn
oCmd.CommandType = adCmdText
oCmd.CommandText = sql
oCmd.Parameters.Append oCmd.CreateParameter("pRegID", 139, 1, 0, lsRegID) 
RegRS.Open oCmd
oCmd.Parameters.Delete "pRegID"

if err.number <> 0 and RegConn.Errors.count <> 0 and (Not err.number =-2147217845) then
	for each oErr in RegConn.Errors
		if not oErr.number = 265946 then
			if oErr.number <> 0  then
				Response.Write "ERROR: " & oErr.number & " SOURCE: " & oErr.source & " DESC: " & oErr.description & "<BR>"
			else
				Response.Write "WARNING: " & oErr.number & " SOURCE: " & oErr.source & " DESC: " & oErr.description & "<BR>"
			end if
		end if
	next 
end if

if RegRS.EOF=True and RegRS.BOF=True then
	Response.Write "ERROR: No records found in Reg_Numbers table with SQL:<br>" & sql & "<BR>"
else
	lsIntID = RegRS("cpd_internal_id").Value
	lsMolID = RegRS("MOL_ID").Value
end if

' sql = "Select * from Structures where cpd_internal_id = " & lsIntID
' RAS 4-Oct-2000 Get the Structure based on Batches.MOL_ID?
' Basically look if we have a valid MOL_ID in the batches table, and if not
' get the MOL_ID for the parent structure using the Reg_Numbers table as before...
if lsBatchMolID="" then
	sql = "SELECT base64_cdx FROM Structures where cpd_internal_id =?"
	set oCmd = Server.CreateObject("ADODB.COMMAND")
	oCmd.ActiveConnection = RegConn
	oCmd.CommandType = adCmdText
	oCmd.CommandText = sql
	oCmd.Parameters.Append oCmd.CreateParameter("pCPD", 139, 1, 0, lsIntID) 
	MoleculesRS.Open oCmd
	oCmd.Parameters.Delete "pCPD"
else
	sql = "SELECT base64_cdx FROM Structures where MOL_ID=?"
	set oCmd = Server.CreateObject("ADODB.COMMAND")
	oCmd.ActiveConnection = RegConn
	oCmd.CommandType = adCmdText
	oCmd.CommandText = sql
	oCmd.Parameters.Append oCmd.CreateParameter("lsBatchMolID", 139, 1, 0, lsBatchMolID) 
	MoleculesRS.Open oCmd
	oCmd.Parameters.Delete "lsBatchMolID"
end if


if err.number <> 0 and RegConn.Errors.count <> 0 and (Not err.number = -2147217845)then
	for each oErr in RegConn.Errors
		if not oErr.number = 265946 then
			if oErr.number <> 0  then
				Response.Write "ERROR: " & oErr.number & " SOURCE: " & oErr.source & " DESC: " & oErr.description & "<BR>"
			else
				Response.Write "WARNING: " & oErr.number & " SOURCE: " & oErr.source & " DESC: " & oErr.description & "<BR>"
			end if
		end if
	next 
end if
if MoleculesRS.EOF=True and MoleculesRS.BOF=True then
	Response.Write "ERROR: No records found in Structures table with SQL:<br>" & sql & "<BR>"
end if

fullregNumber = RegRS("reg_number") & "/" & padNumber(Application("BATCH_NUMBER_LENGTH_GUI"), BaseRS("Batch_Number"))
%>

<%if GF_debug=True Then%>
<table border="1" width="500" bgcolor="White" borderColor=IndianRed cellspacing=0 cellpadding=2>
	<tr>
		<td valign="top" width="100"><strong><font face="Arial" color="#000000" size="2">Batch ID: <%=lsBatchID%><br>MOL ID: <%=lsMolID%></font></strong></td>
		<td valign="top" width="150"><strong><font face="Arial" color="#000000" size="2">Reg ID: <%=lsRegID%><br>Internal ID: <%=lsIntID%></font></strong></td>
		<td valign="top" width="200"><strong><font face="Arial" color="#000000" size="2">Reg #: <%=RegRS("Reg_Number") & "/" & padNumber(Application("BATCH_NUMBER_LENGTH_GUI"), BaseRS("Batch_Number"))%>
			<br>Batch MOL_ID: <%=lsBatchMolID%></strong></font></td>
	</tr>
	<tr>
		<td valign="top" width="100" rowspan="5"><font face="Arial" size="1" color="#000000"></font>
			<%if  Session("ADD_EVAL_DATA" & dbkey) = True then%>
			<script language="JavaScript"><!--
			//getRecordNumber(<%=BaseRunningIndex%>)
			document.write ('<br>')
			getFormViewBtn("enter_data_btn.gif", "/<%=Application("Appkey")%>/analytics/analytics_DE_start.asp", "<%=BaseActualIndex%>","manage_analytics","self","analytics_form_group","<%=lsBatchID%>")
			// -->
			</script><%end if%></td>
		<td valign="top" width="350" colspan="2"><font face="Arial" size="1" color="#000000">
		<%ShowResult dbkey, formgroup, MoleculesRS, "Structures.BASE64_CDX", "Base64CDX", 200, 100%>  
		</font></td>
	</tr>
</table>
<%else%>
<table border="1" width="500" bgcolor="White" borderColor=IndianRed cellspacing=0 cellpadding=2>
	<tr>
		<td colspan="2" align="left" valign="top" width="200"><font face="Arial" color="#000000" size="2"><strong>Reg #: <%=RegRS("Reg_Number") & "/" & padNumber(Application("BATCH_NUMBER_LENGTH_GUI"), BaseRS("Batch_Number"))%></strong></font></td>
	</tr>
	<tr>
		<td valign="top" width="100"><font face="Arial" size="1" color="#000000"></font>
			<%if  Session("ADD_EVAL_DATA" & dbkey) = True then%>
			<script language="JavaScript"><!--
			getFormViewBtn("enter_data_btn.gif", "/<%=Application("Appkey")%>/analytics/analytics_DE_start.asp", "<%=BaseActualIndex%>","manage_analytics","self","analytics_form_group","<%=lsBatchID%>")
			// -->
			</script><%end if%></td>
		<td valign="top" width="350"><font face="Arial" size="1" color="#000000">
			<%ShowResult dbkey, formgroup, MoleculesRS, "Structures.BASE64_CDX", "Base64CDX", 200, 100%></font></td>
	</tr>
</table>
<%end if%>
<%
	Dim sCmd, oRS, rRS
	set oCmd = Server.CreateObject("ADODB.COMMAND")
	oCmd.ActiveConnection = RegConn
	oCmd.CommandType = adCmdText
	sql = "select count(*) as nExpts from experiments where experiment_batch_id=?"
	oCmd.CommandText = sql
	oCmd.Parameters.Append oCmd.CreateParameter("lsBatchID", 139, 1, 0, lsBatchID) 
	Set rRS = oCmd.Execute
	oCmd.Parameters.Delete "lsBatchID"
	if Not (rRS.eof=True and rRS.BOF=True) then
		lsNExpts = rRS("nExpts").Value
		lsNExpts = CInt(lsNExpts)
	else
		lsNExpts = 0
	end if

	' Get the experiment details for each experiment related to the specific Batch ID passed in...
	' sCmd = "SELECT Experiments.experiment_batch_id, Experiments.experiment_id, ExperimentType.experiment_type_name, Experiments.experiment_date, Experiments.experiment_location, Experiments.experiment_comment, Experiments.experiment_reference"
	'sCmd = sCmd & " FROM ExperimentType INNER JOIN Experiments ON ExperimentType.experiment_type_id = Experiments.experiment_type_id"
	'sCmd = sCmd & " WHERE Experiments.experiment_batch_id = " & BaseRS("BATCH_ID").Value & " ;"
	'changed for oracle compatibility
	
	sCmd = "SELECT Experiments.experiment_batch_id, Experiments.experiment_id, ExperimentType.experiment_type_name, Experiments.experiment_date, Experiments.experiment_location, Experiments.experiment_comment, Experiments.experiment_reference"
	sCmd = sCmd & " FROM ExperimentType, Experiments"
	sCmd = sCmd & " WHERE Experiments.experiment_batch_id=?"
	sCmd = sCmd & " AND ExperimentType.experiment_type_id=Experiments.experiment_type_id"
	sCmd = sCmd & " ORDER BY Experiments.experiment_id"
	set oCmd = Server.CreateObject("ADODB.COMMAND")
	oCmd.ActiveConnection = RegConn
	oCmd.CommandType = adCmdText
	oCmd.CommandText = sCmd
	oCmd.Parameters.Append oCmd.CreateParameter("lsBatchID", 139, 1, 0, lsBatchID) 
	Set oRS = oCmd.Execute
	oCmd.Parameters.Delete "lsBatchID"

	if  err.number <> 0 and RegConn.Errors.count <> 0  and (Not err.number = -2147217845)then
		for each oErr in RegConn.Errors
			if not oErr.number = 265946 then
				if oErr.number <> 0  then
					Response.Write "ERROR: " & oErr.number & " SOURCE: " & oErr.source & " DESC: " & oErr.description & "<BR>"
				else
					Response.Write "WARNING: " & oErr.number & " SOURCE: " & oErr.source & " DESC: " & oErr.description & "<BR>"
				end if
			end if
		next 
	end if
	
	if oRS.BOF = True and oRS.EOF = True Then
		Response.Write "<FONT FACE=""Arial"" COLOR=""IndianRed"" SIZE=""1"">No Experiments found for : " & fullregnumber & "&nbsp;</FONT><BR>"
	else
		Response.Write "<FONT FACE=""Arial"" COLOR=""IndianRed"" SIZE=""1"">There are " & lsNExpts & " experiments for : " & fullregnumber & "&nbsp;</FONT><BR>"
		Do while not oRS.EOF
	
			if GF_debug=True then Response.Write "Get results for Experiment: " & oRS("experiment_id").Value & "<br>"
	
			' Display the header information...
			on error resume next
			if GF_debug=True Then
				Response.Write "<BR><TABLE WIDTH=""600"" BORDER=""1"" CELLPADDING=""2"" CELLSPACING=""1"" BGCOLOR=""IndianRed"">"
				Response.Write "<TR>"
				Response.Write "<TD WIDTH=""75"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>Batch ID</STRONG></FONT></TD>"
				Response.Write "<TD WIDTH=""125"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & oRS("experiment_batch_id").Value & "&nbsp;</FONT></TD>"
				Response.Write "<TD WIDTH=""75"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>Expt. #</STRONG></FONT></TD>"
				Response.Write "<TD WIDTH=""125"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & oRS("experiment_id").Value & "&nbsp;</FONT></TD>"
				Response.Write "<TD WIDTH=""75"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>Expt. Type</STRONG></FONT></TD>"
				Response.Write "<TD WIDTH=""125"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & oRS("experiment_type_name").Value & "&nbsp;</FONT></TD></TR>"
				Response.Write "<TR><TD WIDTH=""75"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>Date</STRONG></FONT></TD>"
				Response.Write "<TD WIDTH=""125"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & oRS("experiment_date").Value & "&nbsp;</FONT></TD>"
				Response.Write "<TD WIDTH=""75"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>Location</STRONG></FONT></TD>"
				Response.Write "<TD WIDTH=""125"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & oRS("experiment_location").Value & "&nbsp;</FONT></TD>"
				Response.Write "<TD WIDTH=""75"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>Reference</STRONG></FONT></TD>"
				Response.Write "<TD WIDTH=""125"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & oRS("experiment_reference").Value & "&nbsp;</FONT></TD></TR>"
				Response.Write "<TR><TD WIDTH=""75"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>Comment</STRONG></FONT></TD>"
				Response.Write "<TD WIDTH=""525"" BGCOLOR=""Silver"" COLSPAN=""5""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & oRS("experiment_comment").Value & "&nbsp;</FONT></TD></TR>"
				Response.Write "</TABLE>"
			else
				Response.Write "<BR><TABLE WIDTH=""600"" BORDER=""1"" CELLPADDING=""2"" CELLSPACING=""1"" BGCOLOR=""IndianRed"">"
				Response.Write "<TR>"
				Response.Write "<TD WIDTH=""75"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""2""><STRONG>Expt. Type</STRONG></FONT></TD>"
				Response.Write "<TD WIDTH=""125"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""2"">" & oRS("experiment_type_name").Value & "&nbsp;</FONT></TD>"
				Response.Write "<TD WIDTH=""75"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>Date</STRONG></FONT></TD>"
				Response.Write "<TD WIDTH=""125"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & oRS("experiment_date").Value & "&nbsp;</FONT></TD></TR>"
				Response.Write "<TR><TD WIDTH=""75"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>Location</STRONG></FONT></TD>"
				Response.Write "<TD WIDTH=""125"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & oRS("experiment_location").Value & "&nbsp;</FONT></TD>"
				Response.Write "<TD WIDTH=""75"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>Reference</STRONG></FONT></TD>"
				Response.Write "<TD WIDTH=""125"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & oRS("experiment_reference").Value & "&nbsp;</FONT></TD></TR>"
				Response.Write "<TR><TD WIDTH=""75"" BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>Comment</STRONG></FONT></TD>"
				Response.Write "<TD WIDTH=""525"" BGCOLOR=""Silver"" COLSPAN=""5""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & oRS("experiment_comment").Value & "&nbsp;</FONT></TD></TR>"
				Response.Write "</TABLE>"
			end if
			
			' Get the results for this experiment ID
			Response.Write "<TABLE WIDTH=""600"" BORDER=""1"" CELLPADDING=""2"" CELLSPACING=""1"" BGCOLOR=""IndianRed""><TR><TD BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""2"">Parameters</FONT></TD><TD BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""2"">Results</FONT></TD></TR><TR><TD BGCOLOR=""Silver"" VALIGN=""top"">"
				
			' Get the Parameter information using the correct Experiment ID
			' sCmd = "SELECT Experiments.experiment_id, ParameterType.parameter_type_name, Parameters.parameter_value, ParameterType.parameter_type_units"
			' sCmd = sCmd & " FROM ParameterType INNER JOIN (Experiments INNER JOIN [Parameters] ON Experiments.experiment_id = Parameters.parameter_experiment_id) ON ParameterType.parameter_type_id = Parameters.parameter_type_id"
			' sCmd = sCmd & " WHERE Experiments.experiment_id = " & oRS("experiment_id").Value & " ;"
			
			' Changed for Oracle compatibility
			sCmd = "SELECT Experiments.experiment_id, ParameterType.parameter_type_name, Parameters.parameter_value, ParameterType.parameter_type_units"
			sCmd = sCmd & " FROM ParameterType, Experiments, Parameters"
			sCmd = sCmd & " WHERE Experiments.experiment_id=Parameters.parameter_experiment_id"
			sCmd = sCmd & " AND ParameterType.parameter_type_id=Parameters.parameter_type_id"
			sCmd = sCmd & " AND Experiments.experiment_id=?"
			expID=oRS("experiment_id").Value
			if GF_debug=True then Response.Write "Get Parameter data using:<br>" & sCmd & "<br>"
			set oCmd = Server.CreateObject("ADODB.COMMAND")
			oCmd.ActiveConnection = RegConn
			oCmd.CommandType = adCmdText
			oCmd.CommandText = sCmd
			oCmd.Parameters.Append oCmd.CreateParameter("expID", 139, 1, 0, expID) 
			Set rRS = oCmd.Execute
			oCmd.Parameters.Delete "expID"
			if RegConn.Errors.count <> 0 and (Not err.number = -2147217845) then
				for each oErr in RegConn.Errors
					if not oErr.number = 265946 then
						if oErr.number <> 0  then
							Response.Write "ERROR: " & oErr.number & " SOURCE: " & oErr.source & " DESC: " & oErr.description & "<BR>"
						else
							Response.Write "WARNING: " & oErr.number & " SOURCE: " & oErr.source & " DESC: " & oErr.description & "<BR>"
						end if
					end if
				next 
			end if
	
			if rRS.BOF = True and rRS.EOF = True Then
				Response.Write "<FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">No Parameters</FONT><BR>"
			else
				
				' get the results and display in a Tabular form...
				Response.Write "<TABLE WIDTH=""290"" BORDER=""1"" CELLPADDING=""2"" CELLSPACING=""0"" BGCOLOR=""IndianRed"">"
				' Response.Write "<TR><TD BGCOLOR=""Silver"">Parameter</TD>"
				' Response.Write "<TD BGCOLOR=""Silver"">Value</TD>"
				' Response.Write "<TD BGCOLOR=""Silver"">Units</TD>"
				' Response.Write "</TR>"
				do while not rRS.EOF = True
					'Get the data for this row
					Response.Write "<TR>"
					Response.Write "<TD BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>" & rRS("parameter_type_name").Value & "&nbsp;</STRONG></FONT></TD>"
					Response.Write "<TD BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & rRS("parameter_value").Value & "&nbsp;</FONT></TD>"
					Response.Write "<TD BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & rRS("parameter_type_units").Value & "&nbsp;</FONT></TD>"
					Response.Write "</TR>"
					rRS.MoveNext
				loop
				
				Response.Write "</TABLE>"
			end if

			Response.Write "</TD><TD BGCOLOR=""Silver"" VALIGN=""top"">"
				
			if rRS.State = adStateOpen Then rRS.Close
			Set rRS = Nothing

			' Get the Result information using the correct Experiment ID
			'sCmd = "SELECT Experiments.experiment_id, ResultType.result_type_name, Results.result_value, ResultType.result_type_units"
			'sCmd = sCmd & " FROM ResultType INNER JOIN (Experiments INNER JOIN [Results] ON Experiments.experiment_id = Results.result_experiment_id) ON ResultType.result_type_id = Results.result_type_id"
			'sCmd = sCmd & " WHERE Experiments.experiment_id = " & oRS("experiment_id").Value & " ;"
			
			' changed for oracle compat
			sCmd = "SELECT Experiments.experiment_id, ResultType.result_type_name, Results.result_value, ResultType.result_type_units"
			sCmd = sCmd & " FROM ResultType, Experiments, Results"
			sCmd = sCmd & " WHERE Experiments.experiment_id=Results.result_experiment_id AND ResultType.result_type_id=Results.result_type_id"
			sCmd = sCmd & " AND Experiments.experiment_id=?"
			expID = oRS("experiment_id").Value
			if GF_debug=True then Response.Write "Get Result data using:<br>" & sCmd & "<br>"
			set oCmd = Server.CreateObject("ADODB.COMMAND")
			oCmd.ActiveConnection = RegConn
			oCmd.CommandType = adCmdText
			oCmd.CommandText = sCmd
			oCmd.Parameters.Append oCmd.CreateParameter("expID", 139, 1, 0, expID) 
			Set rRS = oCmd.Execute
			oCmd.Parameters.Delete "expID"
			
			if RegConn.Errors.count <> 0  and (Not err.number = -2147217845 ) then
				for each oErr in RegConn.Errors
					if not oErr.number = 265946 then
						if oErr.number <> 0  then
							Response.Write "ERROR: " & oErr.number & " SOURCE: " & oErr.source & " DESC: " & oErr.description & "<BR>"
						else
							Response.Write "WARNING: " & oErr.number & " SOURCE: " & oErr.source & " DESC: " & oErr.description & "<BR>"
						end if
					end if
				next 
			end if
				
			if rRS.BOF = True and rRS.EOF = True Then
				Response.Write "<FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">No Results</FONT><BR>"
			else
				' get the results and display in a Tabular form...
				Response.Write "<TABLE WIDTH=""290"" BORDER=""1"" CELLPADDING=""2"" CELLSPACING=""0"" BGCOLOR=""IndianRed"">"
				' Response.Write "<TR><TD BGCOLOR=""Silver"">Result</TD>"
				' Response.Write "<TD BGCOLOR=""Silver"">Value</TD>"
				' Response.Write "<TD BGCOLOR=""Silver"">Units</TD>"
				' Response.Write "</TR>"
				do while not rRS.EOF = True
					'Get the data for this row
					Response.Write "<TR>"
					Response.Write "<TD BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1""><STRONG>" & rRS("result_type_name").Value & "&nbsp;</STRONG></FONT></TD>"
					Response.Write "<TD BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & rRS("result_value").Value & "&nbsp;</FONT></TD>"
					Response.Write "<TD BGCOLOR=""Silver""><FONT FACE=""Arial"" COLOR=""Black"" SIZE=""1"">" & rRS("result_type_units").Value & "&nbsp;</FONT></TD>"
					Response.Write "</TR>"
					rRS.MoveNext
				loop
					
				Response.Write "</TABLE>"
			end if

			Response.Write "</TD></TR></TABLE>"

			if rRS.State = adStateOpen then rRS.Close
			Set rRS = Nothing

			if GF_debug=True then Response.Write "Finished experiment - do MoveNext<br>"
			
			oRS.MoveNext
		loop ' Get the next experiment...
	end if

	if GF_debug=True then Response.Write "Finished all experiments<br>"
			
	if oRS.State = adStateOpen Then oRS.Close
	Set oRS = Nothing
%>
<p>&nbsp;</p>
</body>
<%
	CloseRS(BaseRS)
	CloseRS(RegRS)
	CloseRS(MoleculesRS)
	CloseConn(RegConn)
%>
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/input_form_footer_vbs.asp"-->
<script language="JavaScript">
	windowloaded = true
</script>
</body>
</html>
