
<%' Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved
'DO NOT EDIT THIS FILE
'This file contains routines for setting user search and diplay prefs from the prefs dialog box
'This file requires that manage_user_settings_vbs.aap, ado.inc and server_const_vbs.asp be included in the calling page%>
<%

'global connection for user settings table. set via GetUserSettingsConnection
Sub SetSearchPrefs(dbkey, formgroup)
	Dim SearchPrefsString
	User_ID = getUserSettingsID(dbkey, formgroup)
	SearchPrefsString = request("SearchPrefs")
	Session("SearchPrefs" & dbkey) = SearchPrefsString
	Session("SearchPrefs" & dbkey & formgroup) = SearchPrefsString
	Setting_Name = Ucase("SEARCHPREFS" & dbkey & formgroup)
	currentSearchPrefs = selectCurrentSettings(dbkey, formgroup, User_ID, Setting_Name)
	on error resume next
	if currentSearchPrefs = -1 then
		insertCurrentSettings dbkey, formgroup, Setting_Name, User_ID, SearchPrefsString 
	else
		updateCurrentSettings dbkey, formgroup, Setting_Name, User_ID, SearchPrefsString 
	end if
	
End Sub

Sub UserResultsPrefs(dbkey, formgroup)
	Dim DisplayPrefsString
	DisplayPrefsString = request("UserResultsPrefs")
	
	User_ID = getUserSettingsID(dbkey, formgroup)
	Setting_Name = Ucase("USERRESULTSPREFS" & dbkey & formgroup)
	currentSearchPrefs = selectCurrentSettings(dbkey, formgroup, User_ID, Setting_Name)
	on error resume next
	if currentSearchPrefs = -1 then
		insertCurrentSettings dbkey, formgroup, Setting_Name, User_ID, DisplayPrefsString 
	else
		updateCurrentSettings dbkey, formgroup, Setting_Name, User_ID, DisplayPrefsString 
	end if
	Session("UserResultsPrefs" & dbkey) =  DisplayPrefsString
End Sub

'SYAN added on 2/6/2006 to enable ISIS editing
Sub DrawPref(dbkey, formgroup)
	'stop
	Dim DrawPrefVal
	DrawPrefVal = request("DrawPref")
	
	User_ID = getUserSettingsID(dbkey, formgroup)
	Setting_Name = Ucase("DrawPref" & dbkey)
	currentDrawPref = selectCurrentSettings(dbkey, formgroup, User_ID, Setting_Name)
	on error resume next
	if currentDrawPref = -1 then
		insertCurrentSettings dbkey, formgroup, Setting_Name, User_ID, DrawPrefVal 
	else
		updateCurrentSettings dbkey, formgroup, Setting_Name, User_ID, DrawPrefVal 
	end if
	Session("DrawPref" & dbkey) =  DrawPrefVal
End Sub
'End of SYAN modification

Sub UserNumListView(dbkey, formgroup)
	Dim NumDisplayPrefsString
	NumDisplayPrefsString = request("UserNumListView")
	User_ID = getUserSettingsID(dbkey, formgroup)
	Setting_Name = Ucase("USERNUMLISTVIEW" & dbkey & formgroup)
	currentSearchPrefs = selectCurrentSettings(dbkey, formgroup, User_ID, Setting_Name)
	on error resume next
	if currentSearchPrefs = -1 then
		insertCurrentSettings dbkey, formgroup, Setting_Name, User_ID, NumDisplayPrefsString 
	else
		updateCurrentSettings dbkey, formgroup, Setting_Name, User_ID, NumDisplayPrefsString 
	end if
	Session("UserNumListView" & dbkey) = NumDisplayPrefsString
	
End sub


'-------------------------------------------------------------------------------
' Purpose:  writes imformation to a output file 
' Assumes: 	a session is active
' Inputs:   inputstr - variable to output
' Returns:	information in cfwlog.txt
'-------------------------------------------------------------------------------
Sub LogAction(ByVal inputstr)
		on error goto 0
		filepath = Application("ServerDrive") & "\" & Application("ServerRoot") & "\cfwlog.txt"
		Set fs = Server.CreateObject("Scripting.FileSystemObject")
		Set a = fs.OpenTextFile(filepath, 8, True)  
		a.WriteLine Now & ": " & inputstr
		a.WriteLine " "
		a.close
End Sub

	
	



%>