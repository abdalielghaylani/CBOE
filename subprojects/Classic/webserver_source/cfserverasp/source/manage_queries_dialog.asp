<%@ LANGUAGE=VBScript  %>
<%'Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved%>
<%'DO NOT EDIT THIS FILE
%>

<!--#INCLUDE VIRTUAL = "/cfserverasp/source/cows_func_vbs.asp" -->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/manage_user_settings_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/utility_func_vbs.asp"-->



<html>

<head>
<script LANGUAGE="javascript" src="/cfserverasp/source/Choosecss.js"></script>
<%
dbkey=request("dbname")
formgroup=request("formgroup")
manage_query_mode =request("manage_query_mode")
formmode = request("formmode")
formgroupflag= GetFormGroupVal(dbkey, formgroup, kFormGroupFlag)
button_path = Application("NavButtonGifPath")
getUserSettingsID dbkey, formgroup
actionpath = Application("appkey") & "/" & dbkey & "/" & dbkey & "_action.asp?dbname=" & dbkey & "&formgroup=" & formgroup
'LJB 9/16/200 adjust menu font size for mac IE browser
if detectIEMac() = true then
	IEMac = "true"
else
	IEMac = "false"
end if%>

	<title>Queries</title>

	
<script language="javascript">
OpenerWindow = opener
var IEMac = "<%=IEMAC%>"

function doEditQueries(queryid, dbkey, formgroup){
	
	fullpath = '/<%=Application("appkey")%>/manage_queries_dialog.asp?query_id=' + queryid +'&dbname=' + dbkey + '&formgroup=' + formgroup 
	var w = ""
	if (w.name == null){
		var w = window.open(fullpath,"edit_queries","width=450,height=300,status=no,resizable=yes");
		w.focus()}
	else{
		w.focus()
	}
}

function doReturnMain(){
	var formgroup = "<%=request("formgroup")%>"
	var dbkey = "<%=request("dbname")%>"
	var appkey = "<%=Application("appkey")%>"
	var new_location ='/' + appkey +  '/' + 'save_query.asp?manage_query_mode=' + 'manage_queries' + '&dbname=' + dbkey + '&formgroup=' + formgroup
	document.location.replace(new_location)
	

}

function doReloadNav(){
	var formgroup = "<%=request("formgroup")%>"
	var dbkey = "<%=request("dbname")%>"
	var appkey = "<%=Application("appkey")%>"
	var new_location ='/' + appkey +  '/' + 'save_query.asp?manage_query_mode=' + 'reload_Nav' + '&dbname=' + dbkey + '&formgroup=' + formgroup
	

	document.location.replace(new_location)
}

function doSwitchDbkey(query_mode){

	var newDbkey = document.cows_input_form.db_selector.options[document.cows_input_form.db_selector.selectedIndex].value;
	var formgroup = "<%=request("formgroup")%>"
	var appkey = "<%=Application("appkey")%>"
	var new_location ='/' + appkey +  '/' + 'save_query.asp?manage_query_mode=' + query_mode + '&dbname=' + newDbkey + '&formgroup=' + formgroup
	document.location.replace(new_location)
}

function doSwitchFormGroup(query_mode){
	var dbkey = "<%=request("dbname")%>"
	var appkey = "<%=Application("appkey")%>"
	var newfgkey = document.cows_input_form.fg_selector.options[document.cows_input_form.fg_selector.selectedIndex].value;
	var new_location ='/' + appkey +  '/' + 'save_query.asp?manage_query_mode=' + query_mode + '&dbname=' + dbkey + '&formgroup=' + newfgkey
	document.location.replace(new_location)

}


function doManageQueryAction(action){
	var formgroup = "<%=request("formgroup")%>"
	var dbkey = "<%=request("dbname")%>"
	var appkey = "<%=Application("appkey")%>"
	var actiontemp ='/' + appkey + '/' + dbkey + '/' + dbkey + '_action.asp?dataaction=' + action + '&dbname=' + dbkey + '&formgroup=' + formgroup
	
	if (document.cows_input_form.db_query_item){
		var field = document.cows_input_form.db_query_item.options[document.cows_input_form.db_query_item.selectedIndex]
	
		if (field.value == ""){
			alert("You must first select a query from the drop down");
			return false;
		} 
	}
	document.cows_input_form.action = actiontemp
	if(action.toLowerCase() == "restore_query"){
		
		var queryid = field.value
		if (queryid.length > 0){
			
			document.cows_input_form.target = OpenerWindow.name
			document.cows_input_form.submit()
			if (IEMac == "false"){
				window.close();
			}
		}else{
			alert("Please select a query")
		}
	}else{
		if(action.toLowerCase() == "edit_query"){
			var queryid = field.value
			
			if (queryid.length > 0){
			
				var new_location ='/' + appkey +  '/' + 'save_query.asp?queryid=' + queryid + '&manage_query_mode=' + action + '&dbname=' + dbkey + '&formgroup=' + formgroup
				document.location.replace(new_location)
				//document.location.reload(true)
			}else{
				 
			alert("Please select a query")
			}
			
		
		}
		else{
			if(action.toLowerCase() == "save_query"){
				
				doSaveQuery()
			
			}
			else{
				var bcontinue = confirm("Are you sure you want to delete the selected query?");
				if (bcontinue){
					document.cows_input_form.submit()
					//document.location.reload(true)
				}
			}
		}
		
	}
	//document.location.reload(true)
}

function doSaveQuery(){
	var formgroup = "<%=request("formgroup")%>"
	var dbkey = "<%=request("dbname")%>"
	var appkey = "<%=Application("appkey")%>"
	var action = "save_query"
	var actiontemp ='/' + appkey + '/' + dbkey + '/' + dbkey + '_action.asp'
	document.cows_input_form.action = actiontemp + '?DataAction=' + action + "&formgroup=" + formgroup + "&dbname=" + dbkey 
	document.cows_input_form.submit();
	//doReloadNav()
	
}

function doUpdate(){
	
	var formgroup = "<%=request("formgroup")%>"
	var dbkey = "<%=request("dbname")%>"
	var appkey = "<%=Application("appkey")%>"
	var action = "edit_stored_query"
	var allow_public = "<%=Application("ALLOW_PUBLIC_QUERIES")%>"
	var actiontemp ='/' + appkey + '/' + dbkey + '/' + dbkey + '_action.asp'
	if ((allow_public == "1") || (allow_public==1)){
		if(document.cows_input_form.IS_PUBLIC_CB.checked == true){
			document.cows_input_form.IS_PUBLIC.value = "1"
		}
		else{
			document.cows_input_form.IS_PUBLIC.value = "0"
		}
	}else{
		document.cows_input_form.IS_PUBLIC.value = "0"
	}
	document.cows_input_form.action = actiontemp + '?DataAction=' + action + "&formgroup=" + formgroup + "&dbname=" + dbkey 
	document.cows_input_form.submit();
	OpenerWindow.reloadNavBar()	
}

</script>


</head>

<body bgColor="#ffffff">

<%

Select Case UCase(manage_query_mode)
Case "SAVE_QUERY"%>
<form name="cows_input_form" action="<%=actionpath%>" Method ="post">
  <table border="0" width="398">
    <tr>
      <td width="500" colspan = "2"><a href="#" onclick="doManageQueryAction('save_query');return false;"><img border="0"
      src="<%=button_path & "OK.gif"%>" alt="save query"></a>
      <a href="#" onclick="window.close();return false;"><img border="0"
      src="<%=button_path & "Cancel.gif"%>" alt="close window without saving"></a> </td>
    </tr>
    <tr><td width="500" colspan = "2" nowrap ><strong><br>Please type a name and description for the query to be saved:<br> <br></strong></td></tr>
     <tr><td width="100">Query Name</td><td width="200"><input type="text" name="query_name" size="40" ></td></tr><tr><td>Description</td><td><input type="text" name="query_description" size="40" ></td></tr>
    <input type = "hidden" name = "username" value = "<%=Session("USER_SETTINGS_ID" & dbkey) %>"><input type = "hidden" name = "sessionid" value = "<%=session.sessionid%>"></td></tr> <% if CBool(Application("ALLOW_PUBLIC_QUERIES")) = true then%><tr><td width="100">Make Public</td><td><input type="checkbox" name="IS_PUBLIC" value="1"></td></tr><%end if%>
    </tr>
  </table>
</form>

<%	case "RELOAD_NAV"%>
	<script language="javascript">
		OpenerWindow.reloadNavBar()
		window.close()
	</script>
<%	case "RESTORE_QUERY"%>



<form name="cows_input_form" action=" " Method ="post">
  <table border="0" width="398">
    <tr>
      <td width="300"><a href="#" onclick="doManageQueryAction('restore_query');return false;"><img border="0"
      src="<%=button_path & "restore_btn.gif"%>" alt="restore selected query"></a>
      <a href="#" onclick="window.close();return false;"><img border="0"
      src="<%=button_path & "Cancel.gif"%>" alt="close window without changes"></a> </td>
    </tr>
   <tr><td><input type = "hidden" name = "username" value = "<%=Session("USER_SETTINGS_ID" & dbkey) %>"><input type = "hidden" name = "sessionid" value = "<%=session.sessionid%>">
	</td></tr></table>
	
	
	
	<table border="0" width="398"></td></tr><tr><td></td></tr>
	<table border="0" width="398">
		<%
		WriteFormGroupSelector("restore_query")
		WriteDBSelector("restore_query")
		%>
	<tr>
		<td>
			Select a query to restore:
		</td>
	</tr>
	<tr><tr><td>
	<%
	WriteSavedItems dbkey, formgroup 		
		%>
		</td></tr></table>
</form>


<%	case "HISTORY"%>
<form name="cows_input_form" Method ="post">
  <table border="0" width="398">
    <tr>
      <td width="300"><a href="#" onclick="doManageQueryAction('restore_query');return false;"><img border="0"
      src="<%=button_path & "restore_btn.gif"%>" alt="restore selected query"></a>
      <a href="#" onclick="window.close();return false;"><img border="0"
      src="<%=button_path & "Cancel.gif"%>" alt="close window without changes"></a> </td>
    </tr>
   <tr><td><input type = "hidden" name = "username" value = "<%=Session("USER_SETTINGS_ID" & dbkey) %>"><input type = "hidden" name = "sessionid" value = "<%=session.sessionid%>">
	</td></tr></table>
		
	<table border="0" width="398" ID="Table1"></td></tr><tr><td></td></tr>
	<table border="0" width="398" ID="Table2">
		<%
		WriteFormGroupSelector("history")
		WriteDBSelector("restore_query")
		%>
	<tr>
		<td>
			Select a query to restore:
		</td>
	</tr>
	<tr><tr><td><%
WriteHistoryItems dbkey, formgroup 		
			
	
	
	
		%>
		</td></tr></table>
</form>
<%	
Case "MANAGE_QUERIES"
%><form name="cows_input_form" Method ="post">
  <table border="0" width="398">
  <tr>
      <td width="300">
      <a href="#" onclick="doManageQueryAction('restore_query');return false;"><img border="0"
      src="<%=button_path & "restore_btn.gif"%>" alt="restore selected query"></a>
      <a href="#" onclick="doManageQueryAction('edit_query');return false;"><img border="0"
      src="<%=button_path & "edit_btn.gif"%>" alt="edit query information"></a>
      <a href="#" onclick="doManageQueryAction('delete_query');return false;"><img border="0"
      src="<%=button_path & "delete_btn.gif"%>" alt="delete selected query"></a>
      <a href="#" onclick="window.close();return false;"><img border="0"
      src="<%=button_path & "Close.gif"%>" alt="close window without changes"></a> </td>
    </tr>
   <tr><td><input type = "hidden" name = "username" value = "<%=Session("USER_SETTINGS_ID" & dbkey) %>"><input type = "hidden" name = "new_name" value = ""><input type = "hidden" name = "is_public" value = ""><input type = "hidden" name = "sessionid" value = "<%=session.sessionid%>">
	</td></tr></table>
	
	<table border="0" width="398"></td></tr><tr><td></td></tr>
	<table border="0" width="398">
		<%
		WriteFormGroupSelector("manage_queries")
		WriteDBSelector("restore_query")
		%>
	<tr>
		<td>
			Select a query to restore:
		</td>
	</tr>
	<tr><tr><td><%
	WriteAllItems dbkey, formgroup	
			
		
	%>
		</td></tr></table>
</form><%

Case "EDIT_QUERY"%>
<form name="cows_input_form" Method ="post">
  <table border="0" width="398">
 <a href="#" onclick="doUpdate();return false;"><img border="0"
	      src="<%=button_path & "ok.gif"%>" alt="update selected query information"></a>
	 <a href="#" onclick="doReturnMain();return false;"><img border="0"
	      src="<%=button_path & "Cancel.gif"%>" alt="close window without changes"></a> </td>
	      
	      <%
	DB_QUERY_SCHEMA = getCoreSchemaPrefix(dbkey, formgroup)
	If DB_QUERY_SCHEMA <> "" then
		DB_QUERY_TABLE = DB_QUERY_SCHEMA & "." & "DB_QUERY"
	else
		DB_QUERY_TABLE = "DB_QUERY"
	end if
	GetManageQueriesConnection dbkey, formgroup, "base_connection"
	queryid = request("queryid")
	sql = "Select * from " & DB_QUERY_TABLE & " where query_id=" &  queryid
	
	ON ERROR RESUME NEXT
	Set RS = Server.CreateObject("ADODB.Recordset")
	RS.Open sql, ManageQueriesConn
	if not (RS.BOF and RS.EOF)then
	'for i = 0 to rs.Fields.count
		'Response.Write rs.Fields.item(i).value
	'next
	%>



	<table border = "1">
	<input type="hidden" name = "db_query_item" value = "<%=queryid%>">
	
	<input type = "hidden" name ="editable_fields" value = "QUERY_NAME,DESCRIPTION,IS_PUBLIC">
	<tr><td >Query Name</td><td ><input type = "text" size= "40" name ="QUERY_NAME" value = "<%=RS("QUERY_NAME")%>"></td></tr>
	<tr><td >Description</td><td ><input type = "text" size= "40" name ="DESCRIPTION" value = "<%=RS("DESCRIPTION")%>"></td></tr>
	<% if CBool(Application("ALLOW_PUBLIC_QUERIES")) = true then
		if CBool(RS("is_public")) = True then
			checkedVal = "checked"
			checkedText = "1"
		else
			checkedVal = ""
			checkedText = "0"
		end if%>
		<input type="hidden" name = "IS_PUBLIC" value = "<%=checkedText%>">
		<tr><td>Public Query</td><td size= "40" ><input type="checkbox" name = "IS_PUBLIC_CB" <%=checkedVal%> > </td></tr>
		
	<%else%>
	
		<input type="hidden" name = "IS_PUBLIC" value = "0">
	<%end if%>
<%end if%>
</table>
</form>


<%End Select
%>
</body>
</html>

<%
Sub WriteHistoryItems(dbkey, formgroup)

		sql = getHistoryInfoFromDBQuery(dbkey, formgroup, Session("USER_SETTINGS_ID" & dbkey))
		on error resume next
		
		GetManageQueriesConnection dbkey, formgroup, "base_connection"
		Set RS = ManageQueriesConn.Execute(sql)
		Response.Write "<SELECT name=""db_query_item""  >"
		Response.Write "<option value =>--Select One--</option>"
		if Not (RS.EOF and RS.BOF) then
			Do While Not RS.EOF
				query_name = RS("query_name") 
				description = RS("description") 
				query_id = RS("query_id") 
				Response.Write "<option value=""" & query_id  & """>" & query_name & ": " & description &  "</option>"
				RS.MoveNext
			Loop
		end if
		Response.Write "</SELECT>"
End Sub


Sub WriteSavedItems(dbkey,formgroup)

		on error resume next
		sql = getUserInfoFromDBQuery(dbkey, formgroup,Session("USER_SETTINGS_ID" & dbkey))
	
		GetManageQueriesConnection dbkey, formgroup, "base_connection"
		Set RS = ManageQueriesConn.Execute(sql)
		
		Response.Write "<SELECT name=""db_query_item""  >"
		Response.Write "<option value =>--Select One--</option>"
	
		if Not (RS.EOF and RS.BOF) then
			Do While Not RS.EOF
				query_name = RS("query_name") 
				description = RS("description") 
				query_id = RS("query_id") 
				Response.Write "<option value=""" & query_id  & """>" & query_name & ": " & description &  "</option>"
				RS.MoveNext
			Loop
		rs.close
		end if
		
	
		
		Response.Write "</SELECT>"
  End Sub
  
  
Sub WriteAllItems(dbkey,formgroup)
		on error resume next
		sql =   getUserInfoFromDBQuery(dbkey, formgroup,Session("USER_SETTINGS_ID" & dbkey))
		
		GetManageQueriesConnection dbkey, formgroup, "base_connection"
		Set RS = ManageQueriesConn.Execute(sql)
		
		Response.Write "<SELECT name=""db_query_item""  >"
		Response.Write "<option value =>--Select One--</option>"
		Response.Write "<option value =>--SAVED QUERIES--</option>"
		if Not (RS.EOF and RS.BOF) then
			Do While Not RS.EOF
				query_name = RS("query_name") 
				description = RS("description") 
				query_id = RS("query_id") 
				Response.Write "<option value=""" & query_id  & """>" & query_name & ": " & description &  "</option>"
				RS.MoveNext
			Loop
		rs.close
		end if
		
		sql = getHistoryInfoFromDBQuery(dbkey, formgroup, Session("USER_SETTINGS_ID" & dbkey))

		
		Set RS = ManageQueriesConn.Execute(sql)
		Response.Write "<option value =>--HISTORY ITEMS--</option>"
		if Not (RS.EOF and RS.BOF) then
			Do While Not RS.EOF
				query_name = RS("query_name") 
				description = RS("description") 
				query_id = RS("query_id") 
				Response.Write "<option value=""" & query_id  & """>" & query_name & ": " & description &  "</option>"
				RS.MoveNext
			Loop
		end if
		
		Response.Write "</SELECT>"
  End Sub
  
  Sub WriteDBSelector(query_mode)
	if lcase(formmode) <> "search" OR lcase(formgroupflag) <> "global_search" then Exit Sub
	'EXIT POINT
	
	multi_dbnames = Application("DBNames")
	multi_dbnames_array = split(multi_dbnames, ",", -1)
	arrSize = UBound(multi_dbnames_array )
	if  arrSize > 0 then 
		Response.Write "<tr>" & vblf
		Response.Write "	<td>" & vblf
		Response.Write "		Select a Database:" & vblf
		Response.Write "	</td>" & vblf
		Response.Write "</tr>" & vblf
		Response.Write "<tr>" & vblf
		Response.Write "	<td>" & vblf
		Response.Write "		<SELECT name=""db_selector"" onChange=""doSwitchDbkey(&quot;" & query_mode & "&quot;)"" >" & vblf
		For i=0 to arrSize
			theDB = multi_dbnames_array(i)
			displayname = Application("DisplayName" & theDB)
			if theDB = dbkey then
				checked = "selected"
			Else
				checked = ""
			End if	
			Response.Write "		<option " & checked & " value=""" & theDB & """>" & displayname &"</option>"
		Next  
		Response.Write "</SELECT>" & vblf
		Response.Write "</td>" & vblf
		Response.Write "</tr>" & vblf
	end if
End sub	  


'JHS 1/24/2008 adding this (copied from biosar)
Function getAllUserPublicFormgroups(dbkey, formgroup, user_name,byref User_Conn)
	
	Dim RS
	Dim DBA_Conn, SEC_Conn
	Dim cmd
	Set RS = Server.CreateObject("ADODB.RECORDSET")
	Set cmd = Server.CreateObject("ADODB.Command")
	on error resume next
	if not isObject(User_conn) then
		set user_conn = UserConnection
	end if
	Cmd.ActiveConnection = User_Conn
	cmd.CommandType = adCmdText
	sql = "SELECT granted_role FROM user_role_privs UNION SELECT granted_role FROM role_role_privs UNION SELECT role FROM role_role_privs"
	cmd.commandtext =sql
	RS.open cmd 
	
	If not (RS.BOF and RS.EOF)then
		RS.MoveFirst		
		priv_table = UCase(Application("PRIV_TABLE_NAME"))
		Do While Not RS.EOF	
			role_name = RS("Granted_Role")
			if Not role_name = "BIOSAR_MASTER_ROLE" then
				if roles_list <> "" then
					roles_list = roles_list & "," & "'" & role_name& "'"
				else
					roles_list = "'" & role_name& "'"
				end if
			end if
			RS.MoveNext
		Loop
		RS.Close
	end if
	if trim(roles_list) <> "" then
		sql = "Select CS_SECURITY.SECURITY_ROLES.ROLE_NAME From CS_SECURITY.SECURITY_ROLES,CS_SECURITY." & priv_table &_
				" WHERE  CS_SECURITY.SECURITY_ROLES.ROLE_ID = CS_SECURITY." & priv_table & ".role_internal_id" &_
				
				" AND CS_SECURITY." & priv_table & ".IS_FORMGROUP_ROLE=1" &_
				" AND CS_SECURITY.SECURITY_ROLES.ROLE_NAME IN (" & roles_list &  ")" 
		
		Set RS = USER_CONN.Execute(sql)

		if not (RS.BOF and RS.EOF) then
			do While Not RS.EOF
				formgroup_role_name = RS("ROLE_NAME")
				formgroup_role_name_array = split(formgroup_role_name, "_", -1)
				formgroup_id = formgroup_role_name_array(UBound(formgroup_role_name_array))
				if valid_formgroup_ids <> "" then
					valid_formgroup_ids = valid_formgroup_ids & "," & formgroup_id
				else
					valid_formgroup_ids = formgroup_id
				end if
			RS.MoveNext
			loop
		end if
	else
		valid_formgroup_ids= ""
	end if
	'CloseConn(DBA_Conn)
	
	getAllUserPublicFormgroups = valid_formgroup_ids
End Function	





Sub WriteFormGroupSelector(query_mode)
	Dim RS
	Dim Cmd
	
	if NOT CBool(Application("ALLOW_QUERY_MNGMNT_FG_SELECTOR")) then Exit Sub
	FORMGROUP_UNIQUE_IDENTIFIER = Application("FORMGROUP_UNIQUE_IDENTIFIER")
	schema =  getCoreSchemaPrefix(dbkey, formgroup)
	dbms =  GetUserSettingsSQLSyntax(dbkey, formgroup)
	if UCase(dbms) = "ORACLE" then
		sql = "SELECT FORMGROUP_ID,FORMGROUP_NAME, DESCRIPTION FROM " & schema & "." & "DB_FORMGROUP WHERE Upper(USER_ID) = ? OR IS_PUBLIC='1' OR IS_PUBLIC='Y'"
	else
		sql = "SELECT FORMGROUP_ID,FORMGROUP_NAME, DESCRIPTION FROM DB_FORMGROUP WHERE USER_ID = ? OR IS_PUBLIC='1' OR IS_PUBLIC='Y'"
	end if
	
	GetManageQueriesConnection dbkey, formgroup, "base_connection"

	
	'JHS 1/24/2008 - required to hide formgroups if you don't have permission
	if UCASE(dbkey) = "BIOSAR_BROWSER" then
		Set pfgconn = getNewConnection(dbkey, formgroup, "base_connection")
		'on error resume next
		if not pfgconn.state = 1 then
			Set pfgconn = getNewConnection(dbkey, formgroup, "base_connection")
		end if

		valid_user_public_formgroup_ids = getAllUserPublicFormgroups(dbkey, formgroup, Session("UserName" & dbkey), pfgconn)
		sql = sql & " AND FORMGROUP_ID IN(" & valid_user_public_formgroup_ids & ")"

	end if
	sql = sql & " ORDER BY DESCRIPTION"

	Set Cmd = Server.CreateObject("ADODB.COMMAND")
	Cmd.ActiveConnection = ManageQueriesConn
	Cmd.CommandType = adCmdText
	Cmd.CommandText = sql
	 
	Cmd.Parameters.Append Cmd.CreateParameter("pUserName", 200, 1, 30, UCase(Session("USER_SETTINGS_ID" & dbkey)))
	on error resume next
	Set RS = Cmd.Execute
	
	if err.number = 0 then
		if  NOT (RS.EOF AND RS.BOF) then 
		
			Response.Write "<tr>" & vblf
			Response.Write "	<td>" & vblf
			Response.Write "		Select a Form:" & vblf
			Response.Write "	</td>" & vblf
			Response.Write "</tr>" & vblf
			Response.Write "<tr>" & vblf
			Response.Write "	<td>" & vblf
			Response.Write "		<SELECT name=""fg_selector"" onChange=""doSwitchFormGroup(&quot;" & query_mode & "&quot;)"" >" & vblf
			Do While NOT RS.EOF
				theFG = RS(FORMGROUP_UNIQUE_IDENTIFIER)
				displayname = RS("FORMGROUP_NAME") & ":" & RS("DESCRIPTION")
				if lcase(theFG) = lcase(formgroup)  then
					checked = "selected"
				Else
					checked = ""
				End if	
				Response.Write "		<option " & checked & " value=""" & theFG & """>" & displayname &"</option>"
				RS.MoveNext
			Loop 
			Response.Write "</SELECT>" & vblf
			Response.Write "</td>" & vblf
			Response.Write "</tr>" & vblf
		end if
	end if
End sub	  
  
  

%>

