<%' Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved
'DO NOT EDIT THIS FILE%>

<%
'allows control over the number of logged in users to a particular application.
'check if value is empty and if so get value from ini (PARTITION_THRESH=). This will only happen once for the application.
'Only if a variable exists in the cfserver.ini will this set of variables make any difference.


if Application("MaxUsers") = "" then
	Application.Lock
		Application("MaxUsers") = GetINIValue( "optional", "GLOBALS","PARTITION_THRESH","web_app","cfserver")
	'if ini value is empty then there is no limit so set it to a high value
	if (Application("MaxUsers") = "INIEmpty" or Application("MaxUsers") = "NULL" or Application("MaxUsers") = "") then
		Application("MaxUsers")=1000000
	end if
	on error resume next 
	test = CLng(Application("MaxUsers"))
		if err.number > 0 then
			'the setting is not appropriate numeric - override
			Application("MaxUsers")=1000000
		end if
		on error goto 0
	Application.UnLock
end if

if CLng(Application("NumberCurrentUsers")) > CLng(Application("MaxUsers")) then
%>		
<script language="javascript">
top.location.replace('/<%=Application("APPKEY")%>/max_users_process.asp');
</script>			
		
<%		
End if
%>