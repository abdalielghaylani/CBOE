<%'Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved
'DO NOT EDIT THIS FILE%>

<%

dbkey = request("dbname")
formgroup=request("formgroup")%>

<!--#INCLUDE VIRTUAL = "/cfserverasp/source/utility_func_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/global_app_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/set_max_users_vbs.asp"-->

<%

formmode=request("formmode")
session("formmode_loaded") = formmode
strFormMode = formmode
specialmode = request.querystring("special")
formgroupflag=GetFormGroupVal(dbkey, formgroup, kFormGroupFlag)
field_map_group = Application(formgroup & dbkey & "FieldMapGroup")
if field_map_group <> "" then
	mw_field_map=GetFieldMapVal(dbkey, field_map_group, kMolWeightMap)
	formula_field_map=GetFieldMapVal(dbkey, field_map_group, kStructureMap)
	structure_field_map=GetFieldMapVal(dbkey, field_map_group, kFormulaMap)
	other_field_map=GetFieldMapVal(dbkey, field_map_group, kOtherFieldMap)
end if

defaultListView =GetFormGroupVal(dbkey, formgroup, kNumListView)
DBSearchNames=request("dbsearchnames")
globalSearchDBs=Application("GlobalSearchDBs")
globalSearchBase = Application("GlobalBaseDB")
buttonpath =Application("NavButtonGifPath")
selected_id = request.querystring("selected_id")
no_nav_message = request.querystring("no_nav_message")
'!DGB! 02/2003 For restore hit list we pick up record count from session hitlistrecordcount variable 
'if Session("hitlistrecordcount" & dbkey & formgroup) <> "" then
'	totalrecords = Session("hitlistrecordcount" & dbkey & formgroup)
'Else
	if isArray(Session("Base_RS" & dbkey & formgroup)) then
		totalrecords = UBound(Session("Base_RS" & dbkey & formgroup), 2) + 1
	else
		totalrecords = 0
	end if
'End if
BaseTable = GetTableGroupVal(dbkey, formgroup, kBaseTable)
if CBool(Application("Use_Session_Record_Counts")) = True then
	if Session(BaseTable & "RecordCount" & dbkey)= "" then
		UpdateBaseTableRecordCount dbkey, formgroup, ""
		DBRecordCount = Session(BaseTable & "RecordCount" & dbkey)
		Session("DBRecordCount" & dbkey) = DBRecordCount
	else
		DBRecordCount = Session(BaseTable & "RecordCount" & dbkey)
		Session("DBRecordCount" & dbkey) = DBRecordCount
	end if
	
else
	if Application(BaseTable & "RecordCount" & dbkey)= "" or Application(BaseTable & "RecordCount" & dbkey) = "0" then
		UpdateBaseTableRecordCount dbkey, formgroup, ""
		DBRecordCount = Application(BaseTable & "RecordCount" & dbkey)
		Application("DBRecordCount" & dbkey) = DBRecordCount
	else
		DBRecordCount = Application(BaseTable & "RecordCount" & dbkey)
		Application("DBRecordCount" & dbkey) = DBRecordCount
	end if
end if
mainpage=Application("Main_Page" & dbkey)
if mainpage = 1 or UCase(mainpage) = "TRUE" then
	mainpage_enabled = 1
else
	mainpage_enabled = 0
end if
if dbkey = "reg" then mainpage_enabled = 1
login_required = Application("LoginRequired" & dbkey)
if login_required = 1 or UCase(login_required = "TRUE") then
	login_required = 1
else
	login_required = 0
end if
get_last_location = request("get_last_location")
last_location_text = request("last_location_text")
button_override = request("button_override")
	
%>
<script language = "javascript">
//The following line detects browsers that don't send cookies
if (!document.cookie) top.location.href="/cfserverasp/source/nocookies.html"; 

var CSStatusWindow=""
var override_non_chemical_submit_flag = ""
var appkey = "<%=Application("appkey")%>"
var cd_plugin_threshold = "<%=APPLICATION("CD_PLUGIN_THRESHOLD")%>"

//SYAN added on 2/18/2004 to turn CDAX version alerting on and off
var alert_cdax_version = "<%=APPLICATION("ALERT_CDAX_VERSION")%>"

var CD_AUTODOWNLOAD_PLUGIN = "<%=APPLICATION("CD_PLUGIN_DOWNLOAD_PATH")%>"
var override_submit = false
var enable_query_manager = "<%=APPLICATION("ENABLE_QUERY_MANAGER")%>"
var DoAfterOnLoad = false
var stored_location = ""
var formgroup = "<%=formgroup%>"

if(formgroup ==null || formgroup == ""){
	formgroup = "base_form_group"
}
var dbname="<%=dbkey%>"
var commit_type = ""

//define globals used by navbar and val functions- retrieved from querystring and other asp variables
var strucAppletFields = ""
var relLoadedFields = ""
var mainpage_enabled="<%=mainpage_enabled%>"
function getCookieVal(name){
	var cname = name  + "=";
	var dc= document.cookie;
	if(dc.length > 0){
		begin = dc.indexOf(cname);
			if(begin != -1){
				begin += cname.length;
				end = dc.indexOf(";",begin);
					if(end == -1) end = dc.length;
						 var temp = unescape(dc.substring(begin,end));
						 theResult = temp
						 
						  return theResult
			}
		}
	return null;	
}

var appkey="<%=Application("appkey")%>"
var regButtonOverride = false
var editStrucOverride=false
var editButtonOverride = false
var last_searchname = "<%=Session("SearchData" & "SearchName" & dbkey & formgroup)%>"

var get_last_location = "<%=get_last_location%>"
if (get_last_location.toLowerCase() == "true"){
	var last_location = getCookieVal("lastlocation" + dbname + formgroup)
	var last_location_text = "<%=last_location_text%>"
}else{
	var last_location = ""
	var last_location_text = ""

}
var button_override = "<%=button_override%>"
var app_db_names="<%=Application("DBNames")%>"
//!DGB! Change to accomodate additinal frame inside main frame
var MainWindow
var noFrame = ""
// if there is a frame inside the main frame it now becomes the MainWindow

if (!<%=Application("mainwindow")%>.mainFrame){
	MainWindow = <%=Application("mainwindow")%>
}
else{
	MainWindow = <%=Application("mainwindow")%>.mainFrame
}

if (MainWindow == null || MainWindow == ""){
		MainWindow = top.frames("main")
	}
var NavBarWindow = <%=Application("nav_bar_window")%>
if (NavBarWindow == null || NavBarWindow == ""){
		NavBarWindow = top.frames("navbar")
	}

var UserInfoWindow = <%=Application("user_info_window")%>
if (UserInfoWindow == ""  || UserInfoWindow == null){
		UserInfoWindow = top.frames("userinfo")
	}

var the_gs_base_db="<%=globalSearchBase%>"
var the_gs_dbs="<%=globalSearchDBs%>"
var formmode="<%=formmode%>"
if(formmode ==null || formmode == ""){
	formmode = "search"
}
var displayname = "<%=Application("DisplayName" & dbkey)%>"
var formgroupflag="<%=formgroupflag%>"

if(formgroupflag=="GLOBAL_SEARCH"){
var stored_queries = "<%=Request.Cookies("SavedQueriesGlobal" & dbkey & formgroup)%>"
}
else{
var stored_queries = "<%=Request.Cookies("SavedQueries" & dbkey & formgroup)%>"
}
var marked_hits = ""
var temp_hits = "<%=currentMarkedHits%>"
if ((temp_hits == null)||(temp_hits == -1)){
	marked_hits = ""
}
else{
	marked_hits = temp_hits
}
var structure_transfer =new String
var structure_transfer_name =new String
var defaultListView = "<%=defaultListView%>"
var no_nav_message= "<%=no_nav_message%>"
no_nav_message = unescape(no_nav_message)
var selected_id = "<%=selected_id%>"
var button_gif_path = "<%=buttonpath%>"
var specialmode = "<%=specialmode%>"
var dbsearchnames = "<%=dbsearchnames%>"
var no_refine_dialog=""
//set global variable for checking on plugin availability
var plugin = true
//declare variables for looking at browser info
var Browser = navigator.appName;
var Version = navigator.appVersion;
var NSCheck = 0, MicroCheck = 0, Ver3Check = 0, Ver4Check = 0;
var Ver5Check = 0, Ver6Check = 0, WinVer = 0, MacVer = 0;
var MacIE = 0, MacNet4 = 0, WinIE3 = 0, WinIE4 = 0, MacNet3 = 0;
var WinNet3 = 0, WinNet4 = 0, WinNet6 = 0, MacNet6 = 0;
var db_type="<%=Application("DataBaseType" & dbkey)%>"
var more_available = "<%=strTrueFalse(Session("MoreMolids" & dbkey & formgroup))%>"
var fEmptyRecordset = "<%=strTrueFalse(Session("fEmptyRecordset" & dbkey & formgroup))%>"
var get_next_count = "<%=Session("GetNextCount" & dbkey & formgroup)%>"
var get_next_array_count = "<%=Session("GetNextArrayCount" & dbkey & formgroup)%>"
var results_display="<%=Session("ResultsDisplay" & dbkey & formgroup)%>"
if(results_display == ""){
	results_display = "list"}
var results_refine_flag = "<%=Session("RS_Results_Filter" & dbkey & formgroup)%>"
var action_form_path ="<%=Application("ActionForm" & dbkey)%>"
var dbname = "<%=request.querystring("dbname")%>"
var success_message ="<%=Session("Success" & dbkey & formgroup)%>"
var message = "<%=Session("Message" & dbkey & formgroup)%>"
var refine_mode="<%=Session("FilterReturnedWhere" & dbkey & formgroup)%>"

//variable that differ based on the appflag
if (formgroupflag == "GLOBAL_SEARCH"){
	var gs_base_db="<%=Application("GlobalBaseDB")%>"
}
if((formgroupflag == "REG_COMMIT")||(formgroupflag == "REG_TEMP")){
	var duplicates_flag = "<%=request.querystring("duplicates_check")%>"
	if(!duplicates_flag == "true"){
		duplicates_flag = "false"
	}
	if(duplicates_flag == "true"){
		duplicate_ids = "<%=Session("Dup_Check_RS" & dbkey & formgroup)%>"
	}
}
//file path information
var help_path="<%=Application("HelpFile")%>"
var about_path="<%=Application("About")%>"
var prefs_path="<%=Application("Prefs")%>"
var app_Path="<%=Application("AppPathHTTP")%>"
var db_Path="<%=Application("DBPathHTTP" & dbkey)%>"
var refine_path="<%=Application("AppPathHTTP") & "/refine_type.asp"%>"
var reg_dups_path="<%=Application("AppPathHTTP") & "/source/reg_dups.asp"%>"
var edit_structure_path="<%=Application("AppPathHTTP") & "/edit_structure.asp"%>"
var save_query_path="<%=Application("AppPathHTTP") & "/save_query.asp"%>" 
var user_info_path="<%=Application("AppPathHTTP")&"/user_info.asp"%>"
var nav_path="<%=Application("NavBar" & dbkey)%>"
var export_hits_path="<%=Application("ExportHits" & dbkey)%>"

//form fields information
var base_table="<%=GetTableGroupVal(dbkey, formgroup, kBaseTable)%>"
var mol_table="<%=GetTableGroupVal(dbkey, formgroup, kMolTable)%>"
var db_record_count="<%=DBRecordCount%>"

var struc_fields="<%=GetFormGroupVal(dbkey, formgroup, kStructureFields)%>"
var formula_fields="<%=GetFormGroupVal(dbkey, formgroup, kFormulaFields)%>"
var mw_fields="<%=GetFormGroupVal(dbkey, formgroup, kMWFields)%>"
var relational_fields="<%=GetFormGroupVal(dbkey, formgroup, kRelFields)%>"
var required_fields="<%=GetFormGroupVal(dbkey, formgroup, kRequiredFields)%>"
var plugin_value="<%=GetFormGroupVal(dbkey, formgroup, kPluginValue)%>"

var sd_file_fields="<%=GetFormGroupVal(dbkey, formgroup, kSDFileFields)%>"
var input_form_path ="<%=GetFormGroupVal(dbkey, formgroup, kInputFormPath)%>"
var result_form_path =	"<%=GetFormGroupVal(dbkey, formgroup, kResultFormPath)%>"
if(result_form_path.indexOf(";") != -1){
	result_temp = result_form_path.split(";")
	result_form_path = result_temp[0]
	result_form_view_path = result_temp[1]}
var status="<%=Session("Status" & dbkey & formgroup)%>"
var status_comment="<%=Session("StatusComment" & dbkey & formgroup)%>"
var path_info="<%=request.servervariables("path_info")%>"
var base_list_view_path=result_form_path
//current search vars
var totalrecords = "<%=totalrecords%>"

var base_current_index_range=  "<%=Session("CurrentIndexRange" & dbkey & formgroup)%>"
var base_current_index= "<%=Request.QueryString("BaseCurrentIndex")%>"
if((base_current_index == "")||(base_current_index == 0)){
	base_current_index = "<%=Session("BaseCurrentIndex" & dbkey & formgroup)%>"
}
var base_num_list_view= "<%=GetFormGroupVal(dbkey, formgroup, kNumListView)%>"
var base_records_found= "<%=totalrecords%>"
var base_current_record ="<%=Request.QueryString("BaseCurrentRecord")%>"
var page_move =""
var currentrecords="<%=Session("CurrentRecord" & dbkey & formgroup)%>"
var theTimer="<%=Timer%>"
var RegTempPriv = "<%=Session("Register_Temp" & dbkey)%>"



function loadUserInfoFrame(){
	if (UserInfoWindow != self){
		UserInfoWindow.location.replace(app_Path + "/user_info.asp?dbname=" + "<%=dbkey%>" + "&formgroup=" + formgroup+ "&formmode=" + formmode)
	}
}
function loadNavBarFrame(add_on){
	if (NavBarWindow != self){
		
		NavBarWindow.location.replace(app_Path + "/navbar.asp?dbname=" + "<%=dbkey%>" + "&formgroup=" + formgroup+ "&formmode=" + formmode + "&timer=" + theTimer + add_on)
	}
}
function loadBlankNav(){
	if (NavBarWindow != self){
		NavBarWindow.location.replace(app_Path + "/blank.html")
	}
}


</script>


<!--#INCLUDE VIRTUAL = "/cfserverasp/source/form_val_js.js"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/navbar_js.js"-->


<%if Session("reload_list") = true AND UCase(request("formmode")) = "LIST" AND detectNS4() then
Session("reload_list") = false
%>
<script language="javascript">
location.reload(true)
</script>
<%end if%>

<%if Session("reload_form") = true AND Instr(UCase(request("formmode")), "EDIT")>0  AND detectNS4() then
Session("reload_form") = false
%>
<script language="javascript">
location.reload(true)
</script>


<%end if%>

<%if UCase(strTrueFalse(GetFormGroupVal(dbkey, formgroup, kPluginValue))) = "TRUE" then
	if detectNS4 = true then%>
	<script language="JavaScript" src= "/cfserverasp/source/chemdraw_ns4.js"></script>
	<%else%>
	<script language="JavaScript" src= "/cfserverasp/source/chemdraw.js"></script>
	<%end if %>

	<script language="JavaScript"> 
	if (window.doPluginDetect != null) {
		cd_includeWrapperFile("/cfserverasp/source/", doPluginDetect)
	}
	else {
		cd_includeWrapperFile("/cfserverasp/source/")
	}
	</script>
<%end if%>

