<%@ LANGUAGE=VBScript  %>
<%'Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved%>
<%'DO NOT EDIT THIS FILE%>
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/utility_func_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/global_app_vbs.asp"-->
<!--#INCLUDE FILE = "source/security_flags.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/ado.inc" -->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/server_const_vbs.asp" -->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/search_func_vbs.asp" -->
<!--#INCLUDE FILE = "source/app_js.js"-->
<!--#INCLUDE FILE = "source/app_vbs.asp"-->


<html>

<head>
<script LANGUAGE="javascript" src="/biosar_browser/biosar_browser_admin/admin_tool/Choosecss.js"></script>
<%
dbkey=request("dbname")
formgroup=request("formgroup")
manage_query_mode =request("manage_query_mode")
button_path = Application("NavButtonGifPath")
getUserSettingsID dbkey, formgroup
%>
	<title>Forms</title>

	
<script language="javascript">

function doEditQueries(queryid, dbkey, formgroup){
	
	fullpath = '/<%=Application("appkey")%>/manage_queries_dialog.asp?query_id=' + queryid +'&dbname=' + dbkey + '&formgroup=' + formgroup 
	var w = ""
	if (w.name == null){
		var w = window.open(fullpath,"edit_queries","width=450,height=300,status=no,resizable=yes");
		w.focus()}
	else{
		w.focus()
	}
}

function doReturnMain(){
	var formgroup = "<%=request("formgroup")%>"
	var dbkey = "<%=request("dbname")%>"
	var appkey = "<%=Application("appkey")%>"
	var new_location ='/' + appkey +  '/' + 'save_query.asp?manage_query_mode=' + 'manage_queries' + '&dbname=' + dbkey + '&formgroup=' + formgroup
	

	document.location.replace(new_location)
	

}

function doReloadNav(){
	var formgroup = "<%=request("formgroup")%>"
	var dbkey = "<%=request("dbname")%>"
	var appkey = "<%=Application("appkey")%>"
	var new_location ='/' + appkey +  '/' + 'save_query.asp?manage_query_mode=' + 'reload_Nav' + '&dbname=' + dbkey + '&formgroup=' + formgroup
	

	document.location.replace(new_location)
	

}





function doFormSubmit2(theFormGroupValue){
	var theaction = "/biosar_browser/biosar_browser/biosar_browser_action.asp?dataaction=db&dbname=biosar_browser&bypass_ini=true&formgroup=" + theFormGroupValue 
	document.cows_input_form.action =theaction
	
	document.cows_input_form.target = "main"
	document.cows_input_form.submit()
		if(document.cows_input_form.close_window.checked){
			window.close()
		}
}
</script>
</head>

<body bgColor="#ffffff">
<form name="cows_input_form" Method ="post">
   <input type = "hidden" name = "username" value = "<%=Session("USER_SETTINGS_ID" & dbkey) %>">
	<table border="0" width="398"></td></tr><tr><td>Click a link to select a query form (auto close this window <input type=checkbox  checked name=close_window>) </td></tr><tr><td>
	<%	
			WriteFormGroupsLinks(dbkey)
		%>
		</td></tr></table>
</form>
</body>
</html>

<%


Sub writeFormGroupsLinks(dbkey)
	dbkey = "biosar_browser"
	formgroup = "base_form_group"
	Dim DataConn
	Set DataConn = getNewConnection(dbkey, formgroup, "base_connection")
	'on error resume next
	if not DataConn.state = 1 then
		Set DataConn = getNewConnection(dbkey, formgroup, "base_connection")
	end if
	Set RS = Server.CreateObject("ADODB.RECORDSET")
	'determind which formgroup ids are public and whether the current user has access
	valid_user_public_formgroup_ids= getAllUserPublicFormgroups(dbkey, formgroup, Session("UserName" & dbkey), DataConn)

	'create sql that includes both the user_id and the public formgroups to get full list of formgroups
	if valid_user_public_formgroup_ids <> "" then
		sql = "Select * from BIOSARDB.DB_FORMGROUP Where upper(BIOSARDB.DB_FORMGROUP.USER_ID)='" & UCase(Session("UserName" & dbkey))  & "' OR  BIOSARDB.DB_FORMGROUP.FORMGROUP_ID IN(" & valid_user_public_formgroup_ids & ")"
	else
		sql = "Select * from BIOSARDB.DB_FORMGROUP Where upper(BIOSARDB.DB_FORMGROUP.USER_ID)='" & UCase(Session("UserName" & dbkey)) & "'"
	end if
	RS.Open sql, DataConn,adOpenKeyset,adLockOptimistic
	if (RS.EOF and RS.BOF) then
		Response.Write "no formgroups found"
	else
		RS.MoveFirst
		Session("bypass_ini" & dbkey) = true
		Response.Write "<table>"
		Do While Not RS.EOF
			link_string=""
			formgroup_name = RS("FORMGROUP_NAME") 
			description = RS("DESCRIPTION") 
			formgroup_id = RS("FORMGROUP_ID") 
			fullString = TruncateInSpan(formgroup_name & ":" & description,50,formgroup_id)
			link_string = "<td><a class=""MenuLink"" href=""#"" onclick=""doFormSubmit2(" & formgroup_id & ");return false"">" & fullString & "</a></td>"
			Response.Write link_string & "<tr>"
			RS.MoveNext
		Loop
		Response.Write "</table>"
	end if
End Sub


'****************************************************************************************
'*	PURPOSE: Truncates and <span>s a string.  The full string is placed in the title attribute
'*			<span> tag so that it will appear as a pop up help 	                            
'*	INPUT: the string, the truncatation length, the id attribute of <span> 	                    			
'*	OUTPUT: a pair of <span></span> elements containing the truncated content and the title 										
'****************************************************************************************
Function TruncateInSpan(strText, Length, id)
	Dim str
	str = "<span "
	'if the text contents are longer than the desired length 
	'then place the full text contents in the title popup box
	'and truncate the text inside the <span>
	if len(strText) > Length then 
		str = str & "title=""" & strText & """"
		str = str & " id=""" & id &""">"
		str = str & left(strText, Length-3) & "..."
	else
		str = str & "id=""" & id &""" title="""">" & strText
	end if
	str = str & "</span>"
	TruncateInSpan = str
End function	

%>

