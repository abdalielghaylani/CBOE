<%@ LANGUAGE="VBSCRIPT" %>
<%'Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved
'DO NOT EDIT THIS FILE%>

<html>

<head><%formgroup=request.querystring("formgroup")
dbkey=request.querystring("dbname")
formgroupflag=request.querystring("formgroupflag")
saved_queries=request.querystring("saved_queries")

%>
<script language="javascript">
OpenerWindow = opener

function doOK(){
	var thename= document.savequeryform.queryname.value
	saved_queries = "<%=saved_queries%>"
	theArray = saved_queries.split(":S:")
	var nameFound 
	nameFound = false
	var i
	
	if(theArray.length>=3) {
		alert("A maximum of three queries may be saved. Delete queries by clicking the saved queries button then try again.")
	}
	else{
	for (i=0;i<theArray.length;i++){
		if (theArray[i]==thename){
			nameFound = true
		}
	}
	if (nameFound == true){
		alert("The query name you entered already exists, please enter another name.")
		}
	else{
		OpenerWindow.doSavedQueryAction(thename, "save_query")
		window.close()
		}
	}
}
function doManageQueryAction(theName,action){
	var formgroup = "<%=request("formgroup")%>"
	var dbkey = "<%=request("dbname")%>"
	if (action=="delete_query"){
		deleteQuery(theName,thedb)
		document.user_info.target = "userinfo" 
	}
	if (action == "save_query"){
		document.user_info.target = "userinfo" 
	}
	if (action == "restore_query"){
		document.user_info.target = "main" 
	}
	if (action == "history"){
		document.user_info.target = "main" 
	}
	var actiontemp =document.action_form_path + '?dataaction=' + action + '&queryname=' + theName + '&dbname=' + dbname + '&formgroup=' + formgroup
	
	//document.location.reload(true)
}
</script>

<title></title>
</head>

<body bgColor="#ffffff">
<%Select Case Request.QueryString("save_query_mode")
Case "new"%>
<form name="savequeryform" Method ="post">
  <table border="0" width="398">
    <tr>
      <td width="300"><a href="javascript:doOK()"><img border="0"
      src="<%=Application("NavButtonGifPath") & "OK.gif"%>" width="61" height="21" alt="save query"></a>
      <a href="javascript:window.close()"><img border="0"
      src="<%=Application("NavButtonGifPath") & "Cancel.gif"%>" width="61" height="21"
      alt="close window without saving"></a> </td>
    </tr>
    <tr>
      <td width="300"><big><strong>Please type a name for the query to be saved: </strong></big><p><big><strong><br>
      </strong></big><input type="text" name="queryname" size="20" ></td>
    </tr>
  </table>
</form>


<%	case "show"%>
<form name="storedqueries" Method ="post">
  <table border="0" width="398">
    <tr><td width="300"><big><strong>Please select a query from the list: </strong></big></td></tr><tr>
      <td width="300"><a href="javascript:doAction('restore_query')"><img border="0"
      src="<%=Application("NavButtonGifPath") & "restore_btn.gif"%>" width="61" height="21" alt="restore selected query"></a>
      <a href="javascript:doAction('delete_query')"><img border="0"
      src="<%=Application("NavButtonGifPath") & "delete_btn.gif"%>" width="61" height="21" alt="delete selected query"></a>
      <a href="javascript:window.close()"><img border="0"
      src="<%=Application("NavButtonGifPath") & "Cancel.gif"%>" width="61" height="21"
      alt="close window without changes"></a> </td>
    </tr>
   <tr><td>
	<%if formgroupflag = "GLOBAL_SEARCH" then
		theName = Application("GlobalBaseDB")
	else
		theName=Request.querystring("dbname")
	end if
		if theName <> "" then
			theStoredString = Request("saved_queries")
			theStringArray = Split(theStoredString, ":S:", -1)
			Response.Write "<Select name= """ & theName & """ Size = 5 >"
			for j = 0 to UBound(theStringArray)
				thequeryname = theStringArray(j)
				if j=0 then
					Response.Write "<option selected value=" & theQueryName & ">" & theQueryName & "</option>"
				else
					Response.Write "<option value=" & theQueryName & ">" & theQueryName & "</option>"
				end if
			next
			Response.Write "</select>"
		end if
	end select
%>
	
 </td></tr></table>
</form>

</body>
</html>
