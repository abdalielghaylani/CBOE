<%@ LANGUAGE="VBSCRIPT" %>
<%' Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved
'DO NOT EDIT THIS FILE%>
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/cows_func_vbs.asp" -->
<!--added functions for performing custom application  tasks-->
<!--#INCLUDE FILE = "app_vbs.asp"-->
<!--#INCLUDE FILE = "app_js.js"-->
<html>

<head><%
dbkey=request("dbname")
formgroup=request("formgroup")
manage_query_mode =request("manage_query_mode")
 

%>
<script language="javascript">
OpenerWindow = opener

function doManageQueryAction(action){
	var formgroup = "<%=request("formgroup")%>"
	var dbkey = "<%=request("dbname")%>"
	var appkey = "<%=Application("appkey")%>"
	var actiontemp ='/' + appkey + '/' + dbkey + '/' + dbkey + '_action.asp?dataaction2=' + action + '&dbname=' + dbkey + '&formgroup=' + formgroup
	document.cows_input_form.action = actiontemp
	if(action.toLowerCase() == "restore_query"){
		document.cows_input_form.target = OpenerWindow.name
	}
	document.cows_input_form.submit()
	window.close()
	//document.location.reload(true)
}
</script>

<title></title>
</head>

<body bgColor="#ffffff">
<%Select Case UCase(manage_query_mode)
Case "SAVE_QUERY"%>
<form name="cows_input_form" Method ="post">
  <table border="0" width="398">
    <tr>
      <td width="300" colspan = "2"><a href="javascript:doManageQueryAction('save_query')"><img border="0"
      src="<%=Application("NavButtonGifPath") & "OK.gif"%>" width="61" height="21" alt="save query"></a>
      <a href="javascript:window.close()"><img border="0"
      src="<%=Application("NavButtonGifPath") & "Cancel.gif"%>" width="61" height="21"
      alt="close window without saving"></a> </td>
    </tr>
    <tr><td width="300" colspan = "2"><strong>Please type a name and description for the query to be saved: </strong></td></tr>
     <tr><td width="100">Query Name</td><td width="200"><input type="text" name="query_name" size="40" ></td></tr><tr><td>Description</td><td><input type="text" name="query_description" size="40" ></td></tr>
    <input type = "hidden" name = "username" value = "<%=Session("UserName" & dbkey)%>"><input type = "hidden" name = "sessionid" value = "<%=session.sessionid%>">
    </tr>
  </table>
</form>


<%	case "RESTORE_QUERY"%>
<form name="cows_input_form" Method ="post">
  <table border="0" width="398">
    <tr><td width="300"><big><strong>Please select a query from the list: </strong></big></td></tr><tr>
      <td width="300"><a href="javascript:doManageQueryAction('restore_query')"><img border="0"
      src="<%=Application("NavButtonGifPath") & "restore_btn.gif"%>" width="61" height="21" alt="restore selected query"></a>
      <a href="javascript:doManageQueryAction('delete_query')"><img border="0"
      src="<%=Application("NavButtonGifPath") & "delete_btn.gif"%>" width="61" height="21" alt="delete selected query"></a>
      <a href="javascript:window.close()"><img border="0"
      src="<%=Application("NavButtonGifPath") & "Cancel.gif"%>" width="61" height="21"
      alt="close window without changes"></a> </td>
    </tr>
   <tr><td><input type = "hidden" name = "username" value = "<%=Session("UserName" & dbkey)%>"><input type = "hidden" name = "sessionid" value = "<%=session.sessionid%>">
	<%		
			sql = getUserInfoFromDBQuery(dbkey, formgroup,Session("UserName" & dbkey))
			
			basetable = GetBaseTable(dbkey, formgroup, "basetable")
			Set DataConn = GetConnection(dbkey, formgroup, basetable)
			Set RS = DataConn.Execute(sql)
			Response.Write "<SELECT name=""db_query_item""  >"
			Response.Write "<option value =>--Select One--</option>"
			if Not (RS.EOF and RS.BOF) then
				Do While Not RS.EOF
					query_name = RS("query_name") 
					description = RS("description") 
					query_id = RS("query_id") 
					Response.Write "<option value=""" & query_id  & """>" & query_name & ": " & description &  "</option>"
					RS.MoveNext
				Loop
			end if
			Response.Write "</SELECT>"
		
case "HISTORY"%>
<form name="cows_input_form" Method ="post">
  <table border="0" width="398">
    <tr><td width="300"><big><strong>Please select a query from the list: </strong></big></td></tr><tr>
      <td width="300"><a href="javascript:doManageQueryAction('restore_query')"><img border="0"
      src="<%=Application("NavButtonGifPath") & "restore_btn.gif"%>" width="61" height="21" alt="restore selected query"></a>
      <a href="javascript:doManageQueryAction('delete_query')"><img border="0"
      src="<%=Application("NavButtonGifPath") & "delete_btn.gif"%>" width="61" height="21" alt="delete selected query"></a>
      <a href="javascript:window.close()"><img border="0"
      src="<%=Application("NavButtonGifPath") & "Cancel.gif"%>" width="61" height="21"
      alt="close window without changes"></a> </td>
    </tr>
   <tr><td><input type = "hidden" name = "username" value = "<%=Session("UserName" & dbkey)%>"><input type = "hidden" name = "sessionid" value = "<%=session.sessionid%>">
	<%
			
			sql = getSessionInfoFromDBQuery(dbkey, formgroup, session.sessionid)
			
			basetable = GetBaseTable(dbkey, formgroup, "basetable")
			Set DataConn = GetConnection(dbkey, formgroup, basetable)
			Set RS = DataConn.Execute(sql)
			Response.Write "<SELECT name=""db_query_item""  >"
			Response.Write "<option value =>--Select One--</option>"
			if Not (RS.EOF and RS.BOF) then
				Do While Not RS.EOF
					query_name = RS("query_name") 
					description = RS("description") 
					query_id = RS("query_id") 
					Response.Write "<option value=""" & query_id  & """>" & query_name & ": " & description &  "</option>"
					RS.MoveNext
				Loop
			end if
			Response.Write "</SELECT>"
End Select
%>
	
 </td></tr></table>
</form>

</body>
</html>


