<%@ LANGUAGE=VBScript %>
<%response.expires = 0%>
<%' Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved
%>
<%
'DGB Redirection to Login screen is now managed by Session on Start
'if Application("LoginRequired" & dbkey) =1 then
'	if Not Session("UserValidated" & dbkey) = 1 then  response.redirect "/" & Application("Appkey") & "/logged_out.asp"
'end if
'Response.Write Request.QueryString
Dim CDD_DEBUG
CDD_DEBUG = false
Session("DBMS_TYPE") = "ORACLE"
Session("DBMSTYPE") = "ORACLE"


%>
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<%'Copyright 1999-2003 CambridgeSoft Corporation. All rights reserved%>
<%'DO NOT EDIT THIS FILE
%>
<%Session("AllowOrganizeFGSubmenu") = true
Session("AllowOrganizePublicFGSubmenu") = true


'dbkey=request("dbname")
dbkey = "biosar_browser"
'formgroup=request("formgroup")
formgroup = "base_form_group"
manage_query_mode =request("manage_query_mode")
button_path = Application("NavButtonGifPath")
getUserSettingsID dbkey, formgroup
%>
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/cows_func_js.asp"-->
<!--#INCLUDE VIRTUAL = "/biosar_browser/source/secure_nav.asp"-->
<!--#INCLUDE VIRTUAL = "/biosar_browser/source/app_js.js"-->
<!--#INCLUDE VIRTUAL = "/biosar_browser/source/app_vbs.asp"-->
<!--#INCLUDE VIRTUAL=  "/biosar_browser/biosar_browser_admin/admin_tool/admin_func_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/menubar_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/server_const_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/search_func_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/manage_queries.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/marked_hits_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/hitlist_management_func_vbs.asp"-->


<%	dbkey = "biosar_browser"

	formgroup = "base_form_group"
	
	'JHS 5/2/2007 -Check the system connection,
	' because if it doesn't work the forms won't work anyway.
	Dim testSystemConn
	on error resume next
	Set testSystemConn = sysconnection
	if err.number > 0 then
		Response.Clear
		Response.Write "Cannot create a base connection.  Please check your system password."
		Response.End
	end if
	Set testSystemConn = Nothing
	
	Dim DataConn
	Dim varItemFilterSelect
	Set DataConn = getNewConnection(dbkey, formgroup, "base_connection")
	'on error resume next
	if not DataConn.state = 1 then
		Set DataConn = getNewConnection(dbkey, formgroup, "base_connection")
	end if
	Set RS_public = Server.CreateObject("ADODB.RECORDSET")
	'determind which formgroup ids are public and whether the current user has access
	valid_user_public_formgroup_ids= getAllUserPublicFormgroups(dbkey, formgroup, Session("UserName" & dbkey), DataConn)

	'JHS 4/24/2007 - using the sql below was hiding public forms for users, if they were in their private forms
	'this was making it look like forms they had made public were still private.
	'they will now show up in both places 
	'CSBR-67076
	
	'old comment - create sql that includes both the user_id and the public formgroups to get full list of formgroups
	'if valid_user_public_formgroup_ids <> "" then
	'	sql_public = "Select formgroup_id from BIOSARDB.DB_FORMGROUP Where  BIOSARDB.DB_FORMGROUP.FORMGROUP_ID IN(" & valid_user_public_formgroup_ids & ") AND IS_PUBLIC='Y' and Not upper(BIOSARDB.DB_FORMGROUP.USER_ID)='" & UCase(Session("UserName" & dbkey)) & "'"
	'else
	'	sql_public = "Select formgroup_id from BIOSARDB.DB_FORMGROUP Where  BIOSARDB.DB_FORMGROUP.FORMGROUP_ID =0"
	'end if
	
	'JHS 4/24/2007 - using the sql below will show all public forms and will not elimate those that are already listed in *My Forms*
	'I could see complaints as this is pretty different behavior.
	'sql_public = "Select formgroup_id from BIOSARDB.DB_FORMGROUP Where  IS_PUBLIC='Y'"
	'Now putting in new bug fix 8/6/2007 by using if then....
	if valid_user_public_formgroup_ids <> "" then
		sql_public = "Select formgroup_id from BIOSARDB.DB_FORMGROUP Where  BIOSARDB.DB_FORMGROUP.FORMGROUP_ID IN(" & valid_user_public_formgroup_ids & ") AND IS_PUBLIC='Y'"
	else
		sql_public = "Select formgroup_id from BIOSARDB.DB_FORMGROUP Where  BIOSARDB.DB_FORMGROUP.FORMGROUP_ID =0"
	end if
	

	ItemFilterSelect="::CS::" & sql_public%>



<script LANGUAGE="javascript" src="/biosar_browser/biosar_browser_admin/admin_tool/Choosecss.js"></script>
<script LANGUAGE="javascript" >

</script>
	<title>Forms</title>

	

</head>

<body bgColor="#ffffff">



<!--#INCLUDE FILE="../source/inlineTreeview.asp"-->
<!--#INCLUDE VIRTUAL = "/biosar_browser/biosar_browser_admin/admin_tool/footer.asp"-->

</body>
</html>





