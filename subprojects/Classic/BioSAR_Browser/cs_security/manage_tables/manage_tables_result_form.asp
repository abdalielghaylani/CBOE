<%@ LANGUAGE=VBScript%>
<%Response.expires=0
'Copyright 1998-2001 CambridgeSoft Corporation All Rights Reserved
'DO NOT EDIT THIS FILE
if not dbkey <> "" then dbkey=request("dbname")
formgroup= request("formgroup")

if Not Session("UserValidated" & dbkey) = 1 then  response.redirect "/" & Application("Appkey") & "/logged_out.asp"%>


<html>

<head>
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/cows_func_js.asp"-->
<!--#INCLUDE FILE = "../../source/secure_nav.asp"-->
<!--#INCLUDE FILE = "../../cs_security/admin_utils_vbs.asp"-->
<!--#INCLUDE FILE = "../../cs_security/admin_utils_js.js"-->
<!--#INCLUDE FILE = "../../source/app_js.js"-->
<script language="javascript">

var unique_id = ""

	
</script>
<%
formmode = UCase(request("formmode"))
if not Session("access_override" & table_name) <> "" then
 Session("access_override" & table_name) = Request.QueryString("limit_access")
end if

%>



<title>Manage Security Tables</title>
</head>

<body <%=Application("BODY_BACKGROUND")%> >
<!--#INCLUDE FILE = "../../source/app_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/header_vbs.asp"-->
<%
Session("fEmptyRecordset" & dbkey & formgroup) = False
Session("error" & dbkey & formgroup)= false
Session("override_current_index" & dbkey & formgroup)=true

%>
<!--#INCLUDE VIRTUAL ="/cfserverasp/source/recordset_vbs.asp"-->

<%'BaseID represents the primary key for the recordset from the base array for the current row
'BaseActualIndex is the actual id for the index the record is at in the array
'BaseRunningIndex if the id based on the number shown in list view
'BastTotalRecords is the recordcount for the array
'BaseRS (below is the recordset that is pulled for each record generated
on error resume next
	if formmode = "ADD_RECORD" then
		bAdd = true
		bUpdate = false
		bEditWG = true
		bEditUserID = true
	else
		bAdd = false
		bUpdate = true
		if Session("Edit_WorkGroup" & dbkey) = True OR  Session("Add_WorkGroup" & dbkey) = True  OR Session("Delete_WorkGroup" & dbkey) = True then
			bEditWG=true
		else
			bEditWG=false
		end if
		if Session("Edit_Users_Table" & dbkey) =  True then
			bEditUserID=true
		else
			bEditUserID=false
		end if
	end if
	
	uniqueid = BaseID
	commit_type = "full_commit_ns"
	table_name = request("table_name")
	if Not table_name <> "" then
		Response.Write "no_table_name"
		Response.End
	end if
	Set DataConn = GetConnection(dbkey, formgroup, table_name)
	if DataConn.State=0 then ' assume user has been logged out
		DoLoggedOutMsg()
	end if
	if bUpdate = true then
		baseid_name = GetTableVal(dbkey, table_name, kPrimaryKey)
		datatype =getDataType(dbkey,  formgroup,  table_name & "." & baseid_name)
		delimiter = GetFieldDelimiter(datatype)
		sql = "Select * from " & table_name & " where " & baseid_name & "=" & delimiter&  BaseID & delimiter	
		Set BaseRS = DataConn.Execute(sql)
	end if
	
%>
<script language="javascript">

unique_id = "<%=baseID%>"
</script>

<%if bUpdate = true then
	ActiveFlag_TEXT= CBool(BaseRS("Active"))
	ActiveFlag_VAL = BaseRS("Active")
else
	ActiveFlag_TEXT= True
	ActiveFlag_VAL = "1"
end if

ActiveFlag_LIST="1:True,0:False"

Select Case UCase(table_Name)

Case "PEOPLE"
if bUpdate = true then
	Lookup_People_Person_ID_TEXT = getValueFromTablewConn(DataConn,"People", "person_id", BaseRS("person_id"), "Last_Name")			
	Lookup_People_Person_ID_VAL =  BaseRS("Supervisor_Internal_ID")
	Lookup_Site_Site_ID_TEXT = getValueFromTablewConn(DataConn,"Sites", "Site_ID", BaseRS("Site_ID"), "Site_Name")	
	Lookup_Site_Site_ID_VAL =  BaseRS("Site_ID")
	Lookup_People_UserID_TEXT = BaseRS("User_ID")
	Lookup_People_UserID_VAL = BaseRS("User_ID")
	currentPeople_ID = UCase(Lookup_People_UserID_VAL) & ":" & UCase(Lookup_People_UserID_TEXT)
end if
	Lookup_People_Person_ID_LIST= GetPeopleList(DataConn)
	Lookup_Site_Site_ID_LIST= GetSiteList(DataConn)

	if bUpdate = true THEN
		if bEditUserID = true then
			theList = ListAllUnBoundUsers(dbkey, formgroup,Application("appkey") & "_Privileges")
						
			if Not theList <> "" then
				Lookup_People_UserID_LIST=currentPeople_ID & "," & "Login Disabled:Login Disabled"
			else
				Lookup_People_UserID_LIST=theList & "," & currentPeople_ID & "," & "Login Disabled:Login Disabled"
			end if
		else
			Lookup_People_UserID_LIST= ""
		end if

	else
		theList = ListAllUnBoundUsers(dbkey, formgroup,Application("appkey") & "_Privileges")
		if theList <> "" then
			Lookup_People_UserID_LIST=theList & "," & "Login Disabled:Login Disabled"
		else
			Lookup_People_UserID_LIST= "Login Disabled:Login Disabled"
		end if
	end if
End Select
Select Case UCase(table_Name)

Case "SITES"%>
<table border = 0>
<%if bUpdate = true then%>
<tr><td>ID</td><td><%ShowResult dbkey, formgroup, BaseRS,"Sites.Site_ID", "raw_no_edit", "0", "30"%></td></tr>
<%end if%>
<tr><td>Site Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"Sites.Site_Name", "raw", "0", "30"%></td></tr>
<tr><td>Site Code</td><td><%ShowResult dbkey, formgroup, BaseRS,"Sites.Site_Code", "raw", "0", "30"%></td></tr>
<tr><td>Active</td><td><%ShowLookUpList dbkey, formgroup,BaseRS,"Sites.Active",ActiveFlag_LIST,  ActiveFlag_VAL,ActiveFlag_TEXT,0,false,"value","1"%></td></tr>
</table>


<%Case "PEOPLE"
	if NOT UCase(Request.QueryString("limit_access")) = "WORKGROUP" then%>
		<table border = 0>
			<%if bUpdate = true then%>
			<tr><td>ID</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Person_ID", "raw_no_edit", "0", "30"%></td></tr>
			<%end if%>
			<tr><td>Chemist Code</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.User_Code", "raw", "0", "30"%></td></tr>
			<%if bAdd = True then%>
			<tr><td>Unbound User_ID</td><td><%
			ShowLookUpList dbkey, formgroup,BaseRS,"People.User_ID",Lookup_People_UserID_LIST, Lookup_People_UserID_VAL,Lookup_People_UserID_TEXT,0,false,"value","Login Disabled"%></td></tr>
			<%else%>
			<tr><td>Oracle User ID</td><td><%ShowLookUpList dbkey, formgroup,BaseRS,"People.User_ID",Lookup_People_UserID_LIST, Lookup_People_UserID_VAL,Lookup_People_UserID_TEXT,0,false,"value","Login Disabled"%></td></tr>

			<%end if%>
			<tr><td>Supervisor/Workgroup ID</td><td><%ShowLookUpList dbkey, formgroup,BaseRS,"People.Supervisor_Internal_ID", Lookup_People_Person_ID_LIST,  Lookup_People_Person_ID_VAL,Lookup_People_Person_ID_TEXT,0,false,"value","1"%></td></tr>

			<tr><td>First Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.First_Name", "raw", "0", "30"%></td></tr>
			<tr><td>Middle Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Middle_Name", "raw", "0", "30"%></td></tr>
			<tr><td>Last Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Last_Name", "raw", "0", "30"%></td></tr>
			<tr><td>Site</td><td><%ShowLookUpList dbkey, formgroup,BaseRS,"People.Site_ID",Lookup_Site_Site_ID_LIST,  Lookup_Site_Site_ID_VAL,Lookup_Site_Site_ID_TEXT,0,false,"value","1"%></td></tr>
			</td></tr>

			<tr><td>Telephone</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Telephone", "raw", "0", "30"%></td></tr>
			<tr><td>Email</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Email", "raw", "0", "30"%></td></tr>
			<tr><td>Active</td><td><%ShowLookUpList dbkey, formgroup,BaseRS,"People.Active",ActiveFlag_LIST,  ActiveFlag_VAL,ActiveFlag_TEXT,0,false,"value","1"%></td></tr>

		</table>
	<%else%>

	<table border = 0>
		<%if bUpdate = true then%>
		<tr><td>ID</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Person_ID", "raw_no_edit", "0", "30"%></td></tr>
		<%end if%>
		<tr><td>Chemist Code</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.User_Code", "raw_no_edit", "0", "30"%></td></tr>
		
		<tr><td>Oracle User ID</td><td><%=Lookup_People_UserID_TEXT%></td></tr>

		<tr><td>Supervisor/Workgroup ID</td><td><%ShowLookUpList dbkey, formgroup,BaseRS,"People.Supervisor_Internal_ID", Lookup_People_Person_ID_LIST,  Lookup_People_Person_ID_VAL,Lookup_People_Person_ID_TEXT,0,false,"value","1"%></td></tr>

		<tr><td>First Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.First_Name", "raw_no_edit", "0", "30"%></td></tr>
		<tr><td>Middle Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Middle_Name", "raw_no_edit", "0", "30"%></td></tr>
		<tr><td>Last Name</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Last_Name", "raw_no_edit", "0", "30"%></td></tr>
		<tr><td>Site</td><td><%=Site_Site_ID_TEXT%></td></tr>
		</td></tr>

		<tr><td>Telephone</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Telephone", "raw_no_edit", "0", "30"%></td></tr>
		<tr><td>Email</td><td><%ShowResult dbkey, formgroup, BaseRS,"People.Email", "raw_no_edit", "0", "30"%></td></tr>
		<tr><td>Active</td><td><%=ActiveFlag_TEXT%></td></tr>

		</table>
	<%end if%>
<%End Select

'if err.number > 0 then Response.Write err.description%>

<!--#INCLUDE VIRTUAL ="/cfserverasp/source/recordset_footer_vbs.asp"-->




</body>
</html>



























