<%@ LANGUAGE=VBScript%>
<%Response.expires=0
'Copyright 1998-2001 CambridgeSoft Corporation All Rights Reserved
'DO NOT EDIT THIS FILE
if not dbkey <> "" then dbkey=request("dbname")
formgroup= request("formgroup")

if Not Session("UserValidated" & dbkey) = 1 then  response.redirect "/" & Application("Appkey") & "/logged_out.asp"%>


<!--#INCLUDE VIRTUAL = "/cfserverasp/source/cows_func_js.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/server_const_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/search_func_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/display_func_vbs.asp"-->

<!--#INCLUDE FILE = "../../cs_security/admin_utils_vbs.asp"-->
<!--#INCLUDE FILE = "../../cs_security/admin_utils_js.js"-->

<!--#INCLUDE FILE = "../../source/secure_nav.asp"-->
<html>

<head>
<script language="javascript">

	MainWindow =<%=Application("MainWindow")%>
	formmode = "add_record"
	MainWindow.formgroupflag = "manage_users"
	//var existingUser = '<%=CStr(Request("existingUser"))%>';
</script> 
<% action = request.querystring("process_request")

roles_string = GetRoleList(dbkey, formgroup)
privTable = Application("appkey") & "_privileges"
users_string = ListAllUsers(dbkey, formgroup, privTable)
%>

</head>
<body <%=Application("BODY_BACKGROUND")%>>

<!--#INCLUDE FILE = "../../source/app_vbs.asp"-->
<% 
Select Case UCase(action)
	Case "ADD_USER"
	
		isSuccess= AddUser(dbkey, formgroup)
		
		if isSuccess = "" then%>
			<script language = "javascript">
				alert("user added")
				location.replace("<%=Session("ListLocation" & dbkey & formgroup)%>")
			</script>
		<%else%>
			<%if instr(isSuccess, "is not an existing Oracle user")> 0 then%>
			<script language = "javascript">
				alert("<%=isSuccess%>")
				location.replace("<%=Session("ListLocation" & dbkey & formgroup)%>")
			</script>
			<%else%>
			<script language = "javascript">
				alert("<%=isSuccess%>")
				
			</script>
			<%End if%>
		<%End if%>
<%End Select%>

<form name="user_manager" action="/<%=Application("appkey")%>/<%=dbkey%>/manage_security/manage_users_new.asp" Method="Post">
<!--SYAN added on 2/1/2002 To add an oracle existing user-->
<input type="hidden" name="userExisting" value="<%=CStr(Request("existingUser"))%>">
<!--End of SYAN modification-->
 <% if NOT UCase(CStr(Request("existingUser"))) = "TRUE" then %>
<table width="544">
<tr><td width="294">
<table>
<tr width="300">
<td width="136" nowrap>
User Name&nbsp;
</td>
<td width="150">
 <input type="text" name = "user_name" width = "40">
<tr>
<td width="136" nowrap>
Password&nbsp;
</td>
<td width="150">
 <input type="password" name = "password" width = "40">
</td>
</tr>

<tr>
<td width="136" nowrap>
Password Confirm&nbsp;&nbsp;
</td>
<td width="150">
 <input type="password" name = "password_confirmed"  width = "40">
</td>
</tr>
<tr>

<td width="136" valign="top" nowrap>
Role
</td>
<td width="150">
<%If Not CBool(Application("ENABLE_ADD_NON_CS_ROLE")) = true then%>	
<Script language="javascript">
	buildSelectBox("roles", "<%=roles_string%>")
</script>
<%else%>
<Script language="javascript">
	buildMultiSelectBox("roles_hidden","<%=roles_string%>","6")
</script>
<%end if%>
</td>
</tr>

<tr>
<td colspan="2" width="275">
<%If CBool(Application("ENABLE_ADD_NON_CS_ROLE")) = true then%>	
		<br>
		<a href="javascript:getOtherRoleWindow('/<%=Application("appkey")%>/blank.html','<%=dbkey%>','NEW_USER')">Add Existing Role To CS Security</a>
<%end if%>	
</td>
</tr>

</table>
</td></tr></table>

</form>
<%else%>

<table width="544">
<tr><td width="294">
<table>
<tr width="300">
<td width="136" nowrap>
Existing User Name&nbsp;
</td>
<td width="150">
 <input type="text" name = "user_name" width = "40">
<tr>
<td width="136" nowrap>
</td>
<td width="150">
 <input type="hidden" name = "password"  value = "null">
</td>
</tr>

<tr>
<td width="136" nowrap>
</td>
<td width="150">
 <input type="hidden" name = "password_confirmed"  value = "null">
</td>
</tr>
<tr>
<td width="136" nowrap>
Role to Add
</td>
<td width="150"><Script language="javascript">
buildSelectBox("roles", "<%=roles_string%>")
</script>
</td>
</tr>

<tr>
<td colspan="2" width="275">

</td>
</tr>

</table>
</td></tr></table>

</form>

<%end if%>

<form name="cows_input_form" method="post" Action="<%=default_action_path%>" ID="Form2">
<input type = "hidden" name="CurrentLocation" value ="<%=Session("CurrentLocation" & dbkey & formgroup)%>" ID="Hidden17">

<input type = "hidden" name="LastCurrentLocation" value ="<%=Session("LastCurrentLocation" & dbkey & formgroup)%>" ID="Hidden18">
<input type="hidden" name="CurrentRecord" value = "<%=Session("CurrentRecord" & dbkey & formgroup)%>" ID="Hidden19">
</form>
<form name="nav_variables" method="post" Action="<%=Session("CurrentLocation" & dbkey & formgroup)%>" ID="Form1">
<input type = "hidden" name = "RecordRange" Value =  "<%=Session("RecordRange" & dbkey & formgroup)%>" ID="Hidden1">
<input type = "hidden" name = "CurrentRecord" Value =  "<%=Session("RecordRange" & dbkey & formgroup)%>" ID="Hidden2">
<input type = "hidden" name = "AtStart" Value =  "<%=Session("AtStart" & dbkey & formgroup)%>" ID="Hidden3">
<input type = "hidden" name = "AtEnd" Value =  "<%=Session("AtEnd" & dbkey & formgroup)%>" ID="Hidden4">
<input type = "hidden" name = "Base_RSRecordCount" Value =  "<%=Session("Base_RSRecordCount" & dbkey & formgroup)%>" ID="Hidden5">
<input type = "hidden" name = "TotalRecords" Value =  "<%=Session("Base_RSRecordCount" & dbkey & formgroup)%>" ID="Hidden6">
<input type = "hidden" name = "PagingMove" Value =  "<%=Session("PagingMove" & dbkey & formgroup)%>" ID="Hidden7">
<input type = "hidden" name = "CommitType" Value = "<%=commit_type%>" ID="Hidden8">
<input type = "hidden" name = "TableName" Value =  "<%=table_name%>" ID="Hidden9">
<input type = "hidden" name = "UniqueID" Value =  "<%=uniqueid%>" ID="Hidden10">
<input type = "hidden" name = "BaseID" Value =  "<%=BaseID%>" ID="Hidden11">
<input type = "hidden" name = "CPDDBCounter" Value =  "<%=cpdDBCounter%>" ID="Hidden12">
<input type = "hidden" name = "CurrentIndex" Value =  "<%=currentindex%>" ID="Hidden13">
<input type = "hidden" name = "BaseActualIndex" Value =  "<%=BaseActualIndex%>" ID="Hidden14">
<input type = "hidden" name = "Base64" Value =  "<%=Session("BASE64_CDX" & uniqueid & dbkey & formgroup)%>" ID="Hidden15">
<input type = "hidden" name = "Stored_Location" Value =  "" ID="Hidden16">

</form>
<script language="javascript">
	top.frames["navbar"].location.replace("/" + "<%=Application("appkey")%>"+ "/navbar.asp?nav_override=true&dbname=<%=dbkey%>&formmode=manage_users_new")
</script>
</body>
</html>



