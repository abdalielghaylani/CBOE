

<script language = "javascript">
//Copyright 1998-2001 CambridgeSoft Corporation All Rights Reserved%>
//PURPOSE OF FILE: TO add custom javascript functions to an applciation
//All form files generated by the wizard have a #INCLUDE for this file. Add the #INCLUDE to form files
//that you might add to the application.
var bISPublic = ""
var reportSQL = ""


function doProfileSubmit(dbkey, formgroup){

	var bSubmit=true
	if(document.form1.profile_name.value.length == 0){
		bSubmit = false
		alert("Please enter a profile name")
	}
	if(document.form1.profile_description.value.length == 0){
		bSubmit = false
		alert("Please enter a profile description")
	}
	if(document.form1.profile_description.value.length >50){
		bSubmit = false
		alert("Profile Description cannot be greater then 50 characters")
	}
	if(document.form1.profile_name.value.length >50){
		bSubmit = false
		alert("Profile Name cannot be greater then 50 characters")
	}
	
	if((document.form1.BoilerPlateLine1.value.length >80) || (document.form1.BoilerPlateLine2.value.length>80) || (document.form1.BoilerPlateLine3.value.length>80) || (document.form1.BoilerPlateLine4.value.length>80) || (document.form1.BoilerPlateLine5.value.length > 80)){
		bSubmit = false
		alert("Header text lines cannot be greater then 80 characters")
	}
	if (bSubmit == true){
		document.form1.submit()
		doCreateReport(dbkey, formgroup);
		window.close()
	}else{
	window.focus()
	}
}	
function doRefresh(){

	var currentURL = top.frames["ActionFrame"].location.href
	var new_profile_info = document.forms["form1"].elements["profile_name"].options[document.forms["form1"].elements["profile_name"].selectedIndex].value
	
	var report_orientation = document.forms["form1"].elements["report_orientation"].options[document.forms["form1"].elements["report_orientation"].selectedIndex].value
	var report_papersize = document.forms["form1"].elements["report_papersize"].options[document.forms["form1"].elements["report_papersize"].selectedIndex].value
	var New_Page_Each_Rec = document.forms["form1"].elements["New_Page_Each_Rec"].options[document.forms["form1"].elements["New_Page_Each_Rec"].selectedIndex].value
	var ReportFormat = document.forms["form1"].elements["ReportFormat"].options[document.forms["form1"].elements["ReportFormat"].selectedIndex].value
	var table_layout = document.forms["form1"].elements["table_layout"].options[document.forms["form1"].elements["table_layout"].selectedIndex].value
	var ReportName = document.forms["form1"].elements["ReportName"].options[document.forms["form1"].elements["ReportName"].selectedIndex].value
	var currentSettingsString = "&report_orientation=" + report_orientation + "&report_papersize=" + report_papersize + "&New_Page_Each_Rec=" + New_Page_Each_Rec + "&ReportFormat=" + ReportFormat + "&table_layout=" + table_layout + "&ReportName=" + ReportName
	
	document.forms["form1"].elements["run_report"].value = "false"
	if(currentURL.indexOf("profile_name") != -1){
	
		var profile_info="<%=request("profile_name")%>"
		var c_report_orientation="<%=request("report_orientation")%>"
		var c_report_papersize="<%=request("report_papersize")%>"
		var c_New_Page_Each_Rec="<%=request("New_Page_Each_Rec")%>"
		var c_ReportFormat="<%=request("ReportFormat")%>"
		var c_table_layout="<%=request("table_layout")%>"
		var c_ReportName="<%=request("ReportName")%>"
		var newURL = currentURL.replace("%7C", "|")

		var newURL = newURL.replace("&profile_name="+ profile_info, "&profile_name="+ new_profile_info)
		var newURL = newURL.replace("&report_orientation="+ c_report_orientation, "&report_orientation="+ report_orientation)
		var newURL = newURL.replace("&report_papersize="+ c_report_papersize, "&report_papersize="+ report_papersize)
		var newURL = newURL.replace("&New_Page_Each_Rec="+ c_New_Page_Each_Rec, "&New_Page_Each_Rec="+ New_Page_Each_Rec)
		var newURL = newURL.replace("&ReportFormat="+ c_ReportFormat, "&ReportFormat="+ ReportFormat)
		var newURL = newURL.replace("&table_layout="+ c_table_layout, "&table_layout="+ table_layout)
		var newURL = newURL.replace("&ReportName="+ c_ReportName, "&ReportName="+ ReportName)
		var newURL = newURL.replace("&run_report=true", "")
		
		
	}
	else{
		var newURL = currentURL.replace("&run_report=true", "")
		var newURL = newURL.replace("&formgroup=", "&profile_name="+ new_profile_info  + currentSettingsString + "&formgroup=")
	}
	top.frames["ActionFrame"].location.href=newURL
	
}
function doClose(){
opener.location.reload()
window.close()

}
function getLogoLinks(){
	var outputval = ""
	add_schema = "<%=Session("ADD_ADMIN_SCHEMA"  & "biosar_browser")%>"
	delete_schema = "<%=Session("DELETE_ADMIN_SCHEMA" & "biosar_browser")%>"
	if (add_schema.toLowerCase() == "true"){
		outputval = outputval + '<a href="javascript:goAddLogo()">Add</a>'
	}
	if (delete_schema.toLowerCase() == "true"){
		outputval = outputval + '&nbsp;|&nbsp;<a href="javascript:doDeleteLogo()">Delete</a>'
	}
	
	document.write(outputval)
}

function goAddLogo(){
		var w = ""
		if (w.name == null){		
			var w = window.open("/<%=application("appkey")%>/reports/upload_logos.asp?dbname=<%=dbkey%>&formgroup=<%=formgroup%>&profile_name=<%=profile%>&profile_id=<%=profile_id%>","upload_logo","width=450,height=100,scrollbars=yes,status=no,resizable=yes");
			w.focus()}
		else{
			w.focus()}
	
}
function doAddLogo(filename){
	var fullpath = '<%=Application("appkey")%>/reports/report_profile.asp?filename=' + filename + '&dbname=<%=dbkey%>&formgroup=<%=formgroup%>&action=add_logo&profile_name=<%=profile_name%>&profile_id=<%=profile_id%>'
	document.formx.action = fullpath
	document.formx.method="post"
	document.formx.submit()
}
function doDeleteLogo(){
	var bContinue=false
	var logo_name = document.forms["form1"].elements["rpt_logo"].options[document.forms["form1"].elements["rpt_logo"].selectedIndex].text
	var logo_value= document.forms["form1"].elements["rpt_logo"].options[document.forms["form1"].elements["rpt_logo"].selectedIndex].value
	if (logo_value.toLowerCase()=="none"){
		alert("sorry, this entry cannot be removed")
		window.focus()
	}else{
		if(confirm("Are you sure you want to delete the logo " + logo_name + "?")){
			
			bContinue=true
			var fullpath = '/biosar_browser/reports/report_profile.asp?dbname=<%=request("dbname")%>&formgroup=<%=request("formgroup")%>&logo_name=' + logo_value + '&action=delete_logo&profile_name=<%=request("profile_name")%>&profile_id=<%=request("profile_id")%>'
			document.form1.action = fullpath
			document.form1.method = "post"
			document.form1.submit()
		}else{
			window.focus()
		}
	}
	
	
}
function getProfileButtons(){
		var isNetscape = "<%=detectNS%>"
		var current_user = "<%=Session("UserName" & request("dbname"))%>"
		var bAddformgroup = "<%=Session("ADD_USER_FORMGROUP" & request("dbname"))%>"
		add_schema = "<%=Session("ADD_ADMIN_SCHEMA"  & "biosar_browser")%>"
		delete_schema = "<%=Session("DELETE_ADMIN_SCHEMA" & "biosar_browser")%>"
		var outputval = ""
		var profile_info = document.forms["form1"].elements["profile_name"].options[document.forms["form1"].elements["profile_name"].selectedIndex].value
		var thearray = profile_info.split("|")
	
		var profile_id = thearray[0]
		
		var owner = thearray[1]
		outputval = outputval + '<a href="javascript:doReportProfile(&quot;view&quot;)">View</a>'
		if ((bAddformgroup.toLowerCase() == "true") && (isNetscape.toLowerCase() == "false")){
			if (current_user.toLowerCase() == owner.toLowerCase()){
				outputval = outputval + '&nbsp;|&nbsp;<a href="javascript:doReportProfile(&quot;edit&quot;)">Edit</a>'
			}
			outputval = outputval + '&nbsp;|&nbsp;<a href="javascript:doReportProfile(&quot;new&quot;)">New</a>'
			outputval = outputval + '&nbsp;|&nbsp;<a href="javascript:doReportProfile(&quot;duplicate&quot;)">Duplicate</a>'
			
			if (((current_user.toLowerCase() == owner.toLowerCase())&& (profile_id>1))||((delete_schema.toLowerCase() == "true") && (profile_id>1))){
				outputval = outputval + '&nbsp;|&nbsp;<a href="javascript:doReportProfile(&quot;delete&quot;)">Delete</a>'
			}
		}
		document.write(outputval)
		
}

function doReportProfile(action){
	var bContinue=""
	if (action.toLowerCase() == "delete"){
			if(confirm("Are you sure you want to delete this profile?")){
				bContinue=true
			}
		else{
			bContinue=false
		}
	}else{
		bContinue = true
	}
	if (bContinue == true){
		var profile_info = document.forms["form1"].elements["profile_name"].options[document.forms["form1"].elements["profile_name"].selectedIndex].value
		var thearray = profile_info.split("|")
		var profile_id = thearray[0]
		var dbname="biosar_browser"
		var formgroup="<%=request("formgroup")%>"
		fullpath = '/' + '<%=Application("appkey")%>/' + 'reports/report_profile.asp?dbname=' + dbname + "&formgroup=" + formgroup + '&action='+ action + '&profile_name=' + profile_info + '&profile_id=' + profile_id
		
		var rptWindow2 = window.open(fullpath, "View_Profile", "width=700,height=600,scrollbars=yes,status=no,resizable=yes");
		//rptWindow2.focus()
	}
}

function doCreateReport(dbname, formgroup){

	fullpath = '/' + '<%=Application("appkey")%>/'  + '/Create_Report.asp?dbname=' + dbname + '&formgroup=' + formgroup 
	var rptWindow = window.open(fullpath, "Create_BioSAR_Report", "width=700,height=600,scrollbars=no,status=no,resizable=yes");
	//rptWindow.focus()
}






function getGenerateReportButton(){
		var outputval = ""
		var enableReports  = "<%=Application("ENABLE_REPORT_GENERATION")%>"
		if(enableReports == '1') {
			outputval = outputval + '<a href="javascript:MainWindow.doCreateReport(MainWindow.dbname, MainWindow.formgroup)">Generate Report</a>'
		}
		return outputval
}

function doRunReport(){
		var processing_page = ""
		var ReportName =  document.forms["form1"].elements["ReportName"].options[document.forms["form1"].elements["ReportName"].selectedIndex].value
		if ((ReportName == null) || (ReportName == "undefined")|| (ReportName == "NULL")){
			alert("Please select a report layout")}
		else{
			ReportName = ReportName.toUpperCase()
			if (ReportName.indexOf("GENERIC_REPORT") == -1){
				processing_page = "processing_report.asp"}
			else{
				processing_page = "processing_report_layout.asp"
			}
		
			var myLocation = top.DisplayFrame.location.href
			if (myLocation.indexOf("processing_report") == -1){
				top.DisplayFrame.location.href = processing_page
				document.forms["form1"].elements["run_report"].value = "true"
				document.form1.submit()
			}
			else{
				alert("report is processing. please wait")
			}
		}

}
		var newpage = ""
function doSetNewPage(dbkey, formgroup){

		var table_layout = document.forms["form1"].elements["table_layout"].options[document.forms["form1"].elements["table_layout"].selectedIndex].value
		if	((table_layout.toLowerCase() == "down")||(table_layout.toLowerCase() == "down_across"))  {
			newpage = "Yes"
			newpage_value="2"
		}
		else{
			newpage = "No"
			newpage_value="0"
		}
		document.forms["form1"].elements["New_Page_Each_Rec"].options[document.forms["form1"].elements["New_Page_Each_Rec"].selectedIndex].text = newpage
		document.forms["form1"].elements["New_Page_Each_Rec"].options[document.forms["form1"].elements["New_Page_Each_Rec"].selectedIndex].value = newpage_value

}


</script>
