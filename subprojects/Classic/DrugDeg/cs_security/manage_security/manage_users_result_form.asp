<%@ LANGUAGE=VBScript%>
<%Response.expires=0
'Copyright 1998-2001 CambridgeSoft Corporation All Rights Reserved
'DO NOT EDIT THIS FILE
if not dbkey <> "" then dbkey=request("dbname")
if Not Session("UserValidated" & dbkey) = 1 then  response.redirect "/" & Application("Appkey") & "/logged_out.asp"%>



<script language="javascript">

	MainWindow =<%=Application("MainWindow")%>
	
	function getCookie(name){
	var cname = name  + "=";
	var dc= document.cookie;
	if(dc.length > 0){
		begin = dc.indexOf(cname);
			if(begin != -1){
				begin += cname.length;
				end = dc.indexOf(";",begin);
					if(end == -1) end = dc.length;
						 temp = unescape(dc.substring(begin,end));
						 theResult = temp
						 
						  return theResult
			}
		}
	return null;	
}	

	
</script> 
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/cows_func_js.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/server_const_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/search_func_vbs.asp"-->
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/display_func_vbs.asp"-->

<!--#INCLUDE FILE = "../../cs_security/admin_utils_vbs.asp"-->
<!--#INCLUDE FILE = "../../cs_security/admin_utils_js.js"-->

<!--#INCLUDE FILE = "../../source/secure_nav.asp"-->

<html>
<head>

<% action = request.querystring("process_request")
user_name = Request.QueryString("uniqueid")
user_password = GetUserPassword(dbkey, formgroup,user_name)
password_confirmed = user_password
user_roles_list = GetUserRoles(dbkey, formgroup, user_name)
sendlist = user_roles_list
roles_string = GetAvailRoleList(dbkey, formgroup, sendlist)



%>

<script language="javascript">
formmode = "edit_record"
w_current_list =  "<%=user_roles_list%>"
orig_current_list =  w_current_list
orig_user_password = "<%=user_password%>"
w_avail_list = "<%=UCase(roles_string)%>"
user_name = "<%=user_name%>"
</script>
</head>
<body <%=Application("BODY_BACKGROUND")%> onload="fill_lists()">






<!--#INCLUDE FILE = "../../source/app_vbs.asp"-->


<% Select Case UCase(action)
	Case "UPDATE_USER"
		username = Request.QueryString("uniqueid")
		isOK = update_user(username)
		if not isOK <> "" then%>
		<script language="javascript">
		alert("<%=username%>" + " updated")
		top.frames["main"].location.replace("<%=Session( "ListLocation" & dbkey & formgroup )%>")
		</script>
		<%
		else
			Response.Write "the following errors occurred: " & isOK
		end if
	Case "DELETE_USER"
		username = Request("uniqueid")
		isOK = delete_user(username)
		if not isOK <> "" then%>
		<script language="javascript">
		alert("<%=username%>" + " deleted")
		top.frames["main"].location.replace("<%=Session( "ListLocation" & dbkey & formgroup )%>")
		</script>
		<%
		else
			Response.Write "the following errors occurred: " & isOK
		end if
		
Case Else
%>
<form name="user_manager" action="/<%=Application("appkey")%>/<%=dbkey%>/manage_security/manage_users_list.asp" Method="Post">
<table width="544">
<tr><td width="294">
<table <tr width="300">
<td width="144" nowrap>
User Name&nbsp;
</td>
<td width="142">
 <%=user_name%>
 <input type="hidden" name="user_name" value="<%=user_name%>">
<tr>
<td width="144" nowrap>
Password&nbsp;
</td>
<td width="142">
 <input type="password" name="password" value="<%=user_password%>" width="40">
</td>
</tr>

<tr>
<td width="145" nowrap>
Password Confirm&nbsp;&nbsp;
</td>
<td width="142">
 <input type="password" name="password_confirmed" value="<%=password_confirmed%>" width="40">

</td>
</tr>

<tr>
<td width="436" nowrap colspan="2">
<table border="0" width="100%">
  <tr>
    <td width="20%">Available Roles
    </td>
    <td width="20%">
    </td>
    <td width="20%">Current Roles
    </td>
  </tr>
  <tr>
    <td width="20%">
    <select name="roles" width="220" size="6">
    </select>
        <input type="hidden" value name="roles_hidden">

    </td>
    <td width="20%">
      <table border="0" width="100%">
        <tr>
          <td width="100%">
<a href="javascript:addCurrentList()"><img SRC="/<%=Application("AppKey")%>/graphics/add_role_btn.gif" BORDER="0"></a>
          </td>
        </tr>
        <tr>
          <td width="100%">
<a href="javascript:removeCurrentList()"><img SRC="/<%=Application("appkey")%>/graphics/remove_role_btn.gif" BORDER="0"></a>
          </td>
        </tr>
      </table>
    </td>
    <td width="20%"><select name="current_roles" width="220" size="6">
    </select>
    <input type="hidden" value name="current_roles_hidden">
    <input type="hidden" value="<%=user_roles_list%>" name="original_roles_hidden">

    </td>
  </tr>
</table>
</td>

</tr>

<tr>
<td colspan="2" width="275">

</td>
</tr>

</table>
</td></tr></table>

</form>
<%end select%>
<script language="javascript">
	top.frames["navbar"].location.replace("/<%=Application("appkey")%>/navbar.asp?nav_override=true&dbname=<%=dbkey%>&formmode=manage_users")
</script>
</body>
</html>















