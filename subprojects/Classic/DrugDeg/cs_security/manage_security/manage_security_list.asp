<%@ LANGUAGE=VBScript%>
<%Response.expires=0
'Copyright 1998-2001 CambridgeSoft Corporation All Rights Reserved
'DO NOT EDIT THIS FILE
if not dbkey <> "" then dbkey=request("dbname")
if Not Session("UserValidated" & dbkey) = 1 then  response.redirect "/" & Application("Appkey") & "/logged_out.asp"%>


<html>

<head>
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/cows_func_js.asp"-->
<!--#INCLUDE FILE = "../../source/secure_nav.asp"-->

<%
Session("ListLocation" & dbkey & formgroup) = Session("CurrentLocation" & dbkey & formgroup)
formmode = UCase(request("formmode"))
%>



<title>Manage Security</title>
<%
table_name = Request("table_name")
if table_name <> "" then
Session("table_name") = table_name
else
table_name = Session("table_name")
end if

if Not table_name  <> "" then
	table_name= "dba_users"
end if

%>


</head>

<body <%=Application("BODY_BACKGROUND")%>>
<!--#INCLUDE FILE = "../../source/app_vbs.asp"-->
<table border="1" cellpadding="0" cellspacing="0"><tr>
<!--#INCLUDE VIRTUAL = "/cfserverasp/source/header_vbs.asp"-->

<input type = "hidden" name = "table_name" value = "<%=table_name%>">
<%
Select Case UCase(table_Name)
	Case "DBA_USERS"%>
		<script language="javascript">
			getFormViewLink('new', "/<%=Application("AppKey")%>/cs_security/manage_security/manage_users_new.asp","0",'edit', "&table_name=" + "<%=table_name%>")
		</script>		
	<%Case "SECURITY_ROLES"%>
		<script language="javascript">
			getFormViewLink('new', "/<%=Application("AppKey")%>/cs_security/manage_security/manage_roles_result_form.asp","0",'add_record', "&table_name=" + "<%=table_name%>")
		</script>		
<%End select%>


<%
if Not Session( "fEmptyRecordset" & dbkey & formgroup ) = True  then

	Select case UCase(table_name)
		Case "DBA_USERS"
			relfields = "dba_users.username;0"
		Case "SECURITY_ROLES"
			relfields = "security_roles.role_ID;2,security_roles.role_name;0"
		
	end select
	relfields_array = split(relfields, ",", -1)%>

	<%for i = 0 to UBound(relfields_array)
	temp_array = split(relfields_array(i), ";", -1)
	if instr(temp_array(0), ".")> 0 then
		new_array = split(temp_array(0), ".", -1)
		fieldname = new_array(1)
	else
		fieldname =temp_array(0)
	end if %>
    <td><%="<strong>" & fieldname &  "</strong>"%></td>
   <%next%>
  </tr>
 

<%end if%>
<!--#INCLUDE VIRTUAL ="/cfserverasp/source/recordset_vbs.asp"-->
<script language ="javascript">
function getLink(field_val,force_formmode){
		var  commit_type = "full_commit_ns"
		var table_name = "<%=table_name%>"
		var uniqueid = "<%=baseid%>"
		//setCookie("TableName" + MainWindow.dbname,table_name,1)
		//setCookie("CommitType" + MainWindow.dbname,commit_type,1)
		//setCookie("UniqueID" +  MainWindow.dbname,uniqueid,1)  
		if (table_name.toUpperCase() =="DBA_USERS"){
			getFormViewLink(field_val, "/<%=Application("AppKey")%>/cs_security/manage_security/manage_users_result_form.asp", <%=BaseActualIndex%>,"edit", "&uniqueid=" + uniqueid)
		}
		else{
			getFormViewLink(field_val, "/<%=Application("AppKey")%>/cs_security/manage_security/manage_roles_result_form.asp", <%=BaseActualIndex%>,force_formmode, "&table_name=" + table_name)

		}
	}
</script>
<%'BaseID represents the primary key for the recordset from the base array for the current row
'BaseActualIndex is the actual id for the index the record is at in the array
'BaseRunningIndex if the id based on the number shown in list view
'BastTotalRecords is the recordcount for the array
'BaseRS (below is the recordset that is pulled for each record generated
	
	'on error resume next
	uniqueid = BaseID
	commit_type = "full_commit_ns"
	privTable = Application("PRIV_TABLE_NAME")
	Set DataConn = GetNewConnection(dbkey, formgroup, "base_connection")
	Select Case UCase(table_Name)
		Case "DBA_USERS"
			sql = "Select username from dba_users where Upper(username)=" & "'" & UCase(BaseID) & "'"
		Case "SECURITY_ROLES"
			sql = "Select role_ID, role_name from SECURITY_ROLES, PRIVILEGE_TABLES where role_ID=" & BaseID & " AND Upper(privilege_table_name)=" & "'" & UCase(privTable) & "'" & " AND privilege_tables.privilege_table_ID = security_roles.privilege_table_int_ID"
	
	End select
	Set BaseRS = DataConn.Execute(sql)
	BaseRS.MoveFirst
	
	
%>
	

<tr>


<%for i = 0 to UBound(relfields_array)
	value = ""
	link_value = ""
	temp_array = split(relfields_array(i), ";", -1)
	if instr(temp_array(0), ".")> 0 then
		new_array = split(temp_array(0), ".", -1)
		fieldname = new_array(1)
	else
		fieldname =temp_array(0)
	end if 
	
	if Not (BaseRS.BOF AND BaseRS.EOF)then
			value = BaseRS(fieldname)
			if UCase(value) = "REGDB" then
				value = ""
			end if
		else
			value = ""
	end if
	%>
	<td>
	<%
	if i = 0 then%>
		
		<script language="javascript">
			link_value = "<%=value%>"
			if(link_value.length > 0 ){
				getLink(link_value, "edit_record")
			}
			else{
				document.write('')
			}
		</script>
	<%else
		
		if Not value <> "" then
			value = "&nbsp;"
		end if
		if UCase(fieldname) = "ACTIVE" then
		value = CBool(value)
		end if
		Response.Write value
   end if%>
   </td>
<%next%>
</tr>
<%CloseRS(BaseRS)
CloseConn(DataConn)%>



<!--#INCLUDE VIRTUAL ="/cfserverasp/source/recordset_footer_vbs.asp"-->

</table>

</body>
</html>


