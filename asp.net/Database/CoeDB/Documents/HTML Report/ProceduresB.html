<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">

<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<meta name="keywords" content="Toad Data Modeler, html, report">
		<title>Toad Data Modeler - HTML Report</title>

		<link rel="stylesheet" type="text/css" media="screen" href="aqua_blue.css" title="report">
		<link rel="stylesheet" type="text/css" media="print" href="aqua_blue_print.css" title="report">
	</head>

<body class="rightPage">
<a name = "Procedure_15"></a>
<div class="caption1">COEDB.CREATESERVICETABLES</div><br><br> 
<table class="tabformat" border="0" cellpadding="2" cellspacing="1" width="100%">
 
  <tr>
    <td class="tabdata" > <pre><code>CREATE PROCEDURE &quot;COEDB&quot;.&quot;CREATESERVICETABLES&quot;  (<br>     aServiceName           IN   VARCHAR2,<br>     aSchemaName            IN   VARCHAR2 := NULL,<br>     aIndexTableSpaceName   IN   VARCHAR2 := NULL)<br>  IS<br>     lSqlDdl       VARCHAR2 (4000);<br>     lSchemaName   VARCHAR2 (30);<br>     lExist        INTEGER;<br>  <br>     PROCEDURE createSearchTables IS<br>     BEGIN<br>        SELECT COUNT (1) INTO lExist<br>          FROM dba_tables<br>         WHERE UPPER (table_name) = 'COESAVEDSEARCHCRITERIA'<br>           AND UPPER (owner) = UPPER (lSchemaName);<br>  <br>        IF lExist = 0 THEN<br>           lSqlDdl := 'CREATE TABLE ' || lSchemaName || '.COESAVEDSEARCHCRITERIA<br>                  (<br>                    ID                 NUMBER(10)                 NOT NULL,<br>                    NAME               VARCHAR2(255 BYTE)         NOT NULL,<br>                    DESCRIPTION        VARCHAR2(255 BYTE),<br>                    USER_ID            VARCHAR2(30 BYTE),<br>                    NUM_HITS           NUMBER(10),<br>                    IS_PUBLIC          VARCHAR2(1 BYTE)           NOT NULL,<br>                    FORMGROUP          VARCHAR2(255 BYTE),<br>                    DATE_CREATED       DATE                       NOT NULL,<br>                    COESEARCHCRITERIA  CLOB                       NOT NULL,<br>                    DATABASE           VARCHAR2(30 BYTE)          NOT NULL,<br>                    CONSTRAINT PK_CHEMINVDB2_COESAVEDSEARCH PRIMARY KEY (ID) USING INDEX TABLESPACE ' || aIndexTableSpaceName || '<br>                  )';<br>  <br>           EXECUTE IMMEDIATE lSqlDdl;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COESAVEDSEARCH_USER_ID ON '   || lSchemaName || '.COESAVEDSEARCHCRITERIA (USER_ID ASC)  TABLESPACE '      || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COESAVEDSEARCH_IS_PUBLIC ON ' || lSchemaName || '.COESAVEDSEARCHCRITERIA (IS_PUBLIC ASC)  TABLESPACE '    || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COESAVEDSEARCH_FORMGROUP ON ' || lSchemaName || '.COESAVEDSEARCHCRITERIA (FORMGROUP ASC)  TABLESPACE '    || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COESAVEDSEARCH_DATE_CREA ON ' || lSchemaName || '.COESAVEDSEARCHCRITERIA (DATE_CREATED ASC)  TABLESPACE ' || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COESAVEDSEARCH_DATABASE ON '  || lSchemaName || '.COESAVEDSEARCHCRITERIA (DATABASE ASC)  TABLESPACE '     || aIndexTableSpaceName;<br>        END IF;<br>  <br>        SELECT COUNT (1) INTO lExist<br>          FROM dba_tables<br>         WHERE UPPER (table_name) = 'COESEARCHCRITERIA'<br>           AND UPPER (owner) = UPPER (lSchemaName);<br>  <br>        IF lExist = 0 THEN<br>           lSqlDdl := 'CREATE TABLE ' || lSchemaName || '.COESEARCHCRITERIA<br>                  (<br>                    ID                 NUMBER(10)                 NOT NULL,<br>                    NAME               VARCHAR2(255 BYTE),<br>                    DESCRIPTION        VARCHAR2(255 BYTE),<br>                    USER_ID            VARCHAR2(30 BYTE),<br>                    NUM_HITS           NUMBER(10),<br>                    IS_PUBLIC          VARCHAR2(1 BYTE)           NOT NULL,<br>                    FORMGROUP          VARCHAR2(255 BYTE),<br>                    DATE_CREATED       DATE                       NOT NULL,<br>                    COESEARCHCRITERIA  CLOB                       NOT NULL,<br>                    DATABASE      VARCHAR2(30 BYTE)               NOT NULL,<br>                    CONSTRAINT PK_CHEMINVDB2_COESEARCHCRITE PRIMARY KEY (ID) USING INDEX TABLESPACE ' || aIndexTableSpaceName || '<br>                  )';<br>  <br>           EXECUTE IMMEDIATE lSqlDdl;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COESEARCH_USER_ID ON '       || lSchemaName || '.COESEARCHCRITERIA (USER_ID ASC)  TABLESPACE '      || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COESEARCH_IS_PUBLIC ON '     || lSchemaName || '.COESEARCHCRITERIA (IS_PUBLIC ASC)  TABLESPACE '    || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_CCOESEARCH_FORMGROUP ON '    || lSchemaName || '.COESEARCHCRITERIA (FORMGROUP ASC)  TABLESPACE '    || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_CCOESEARCH_DATE_CREATED ON ' || lSchemaName || '.COESEARCHCRITERIA (DATE_CREATED ASC)  TABLESPACE ' || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_CCOESEARCH_DATABASE ON '     || lSchemaName || '.COESEARCHCRITERIA (DATABASE ASC)  TABLESPACE '     || aIndexTableSpaceName;<br>  <br>           SELECT COUNT (1) INTO lExist<br>             FROM dba_sequences<br>            WHERE UPPER (sequence_name) = 'COESEARCHCRITERIA_SEQ'<br>              AND UPPER (sequence_owner) = UPPER (lSchemaName);<br>  <br>           IF lExist = 1 THEN<br>              EXECUTE IMMEDIATE 'DROP SEQUENCE ' || lSchemaName || '.COESEARCHCRITERIA_SEQ';<br>           END IF;<br>  <br>           EXECUTE IMMEDIATE 'CREATE SEQUENCE ' || lSchemaName || '.COESEARCHCRITERIA_SEQ INCREMENT BY 1 START WITH 1 MAXVALUE 1.0E27 MINVALUE 1 NOCYCLE CACHE 20 NOORDER';<br>        END IF;<br>     END;<br>  <br>     PROCEDURE createHitListTables IS<br>        lExist   INTEGER;<br>     BEGIN<br>        -- Partition Section<br>        BEGIN<br>           partitionManagment.validatePartitionSupport;<br>  <br>           SELECT COUNT (1) INTO lExist<br>             FROM dba_tables<br>            WHERE UPPER (table_name) = 'COESAVEDHITLIST'<br>              AND UPPER (owner) = UPPER (lSchemaName);<br>  <br>           IF lExist = 0 THEN<br>              lSqlDdl := 'CREATE TABLE ' || lSchemaName || '.COESAVEDHITLIST<br>                  (<br>                    HITLISTID     NUMBER(10)                         NOT NULL,<br>                    ID            VARCHAR2(30 BYTE)                  NOT NULL,<br>                    DATESTAMP     DATE               DEFAULT SYSDATE NOT NULL,<br>                    SORTORDER     FLOAT,<br>                    CONSTRAINT PK_CHEMINVDB2_COESAVEDHITLIST PRIMARY KEY (HITLISTID,ID,DATESTAMP)<br>                  ) ORGANIZATION INDEX<br>                    PARTITION BY RANGE (DATESTAMP)<br>                      (PARTITION COESAVEDHITLISTMAXVALUE VALUES LESS THAN(MAXVALUE))';<br>  <br>              EXECUTE IMMEDIATE lSqlDdl;<br>           END IF;<br>  <br>           SELECT COUNT (1) INTO lExist<br>             FROM dba_tables<br>            WHERE UPPER (table_name) = 'COETEMPHITLIST'<br>              AND UPPER (owner) = UPPER (lSchemaName);<br>  <br>           IF lExist = 0 THEN<br>              lSqlDdl := 'CREATE TABLE ' || lSchemaName || '.COETEMPHITLIST<br>                  	(<br>                  	  HITLISTID  NUMBER(10)                            NOT NULL,<br>                  	  ID         VARCHAR2(30 BYTE)                     NOT NULL,<br>                        DATESTAMP  DATE                  DEFAULT SYSDATE NOT NULL,<br>                  	  SORTORDER  FLOAT,<br>                  	  CONSTRAINT PK_CHEMINVDB2_COETEMPHITLIST PRIMARY KEY (HITLISTID,ID,DATESTAMP)<br>                  	) ORGANIZATION INDEX<br>                            PARTITION BY RANGE (DATESTAMP)<br>                              (PARTITION COETEMPHITLISTMAXVALUE VALUES LESS THAN(MAXVALUE))';<br>  <br>              EXECUTE IMMEDIATE lSqlDdl;<br>           END IF;<br>        EXCEPTION<br>           WHEN OTHERS THEN<br>              SELECT COUNT (1) INTO lExist<br>                FROM dba_tables<br>               WHERE UPPER (table_name) = 'COESAVEDHITLIST'<br>                 AND UPPER (owner) = UPPER (lSchemaname);<br>  <br>              IF lExist = 0 THEN<br>                 EXECUTE IMMEDIATE 'CREATE TABLE ' || lSchemaName || '.COESAVEDHITLIST '<br>                                   || '( '<br>                                   || '  HITLISTID     NUMBER(10)                         NOT NULL, '<br>                                   || '  ID            VARCHAR2(30 BYTE)                  NOT NULL, '<br>                                   || '  SORTORDER     FLOAT, '<br>                                   || '  CONSTRAINT PK_CHEMINVDB2_COESAVEDHITLIST PRIMARY KEY (HITLISTID,ID) '<br>                                   || ') ORGANIZATION INDEX';<br>              END IF;<br>  <br>              SELECT COUNT (1) INTO lExist<br>                FROM dba_tables<br>               WHERE UPPER (table_name) = 'COETEMPHITLIST'<br>                 AND UPPER (owner) = UPPER (lSchemaName);<br>  <br>              IF lExist = 0 THEN<br>                 EXECUTE IMMEDIATE 'CREATE TABLE ' || lSchemaName || '.COETEMPHITLIST '<br>                                   || '(  '<br>                                   || '  HITLISTID  NUMBER(10)                         NOT NULL, '<br>                                   || '  ID         VARCHAR2(30 BYTE)                  NOT NULL, '<br>                                   || '  SORTORDER  FLOAT, '<br>                                   || '  CONSTRAINT PK_CHEMINVDB2_COETEMPHITLIST PRIMARY KEY (HITLISTID,ID) '<br>                                   || ') ORGANIZATION INDEX ';<br>              END IF;<br>        END;<br>  <br>        partitionManagment.updatePartitionJob ('COETEMPHITLIST', SYSDATE, lSchemaName);<br>        partitionManagment.updatePartitionJob ('COESAVEDHITLIST', SYSDATE, lSchemaName);<br>  <br>        SELECT COUNT (1) INTO lExist<br>          FROM dba_tables<br>         WHERE UPPER (table_name) = 'COESAVEDHITLISTID'<br>           AND UPPER (owner) = UPPER (lSchemaName);<br>  <br>        IF lExist = 0 THEN<br>           lSqlDdl := 'CREATE TABLE ' || lSchemaName || '.COESAVEDHITLISTID<br>                  (<br>                    ID            NUMBER(10)                      NOT NULL,<br>                    NAME          VARCHAR2(255 BYTE)              NOT NULL,<br>                    DESCRIPTION   VARCHAR2(255 BYTE),<br>                    USER_ID       VARCHAR2(30 BYTE),<br>                    NUMBER_HITS   NUMBER(10),<br>                    IS_PUBLIC     VARCHAR2(1 BYTE)                NOT NULL,<br>                    FORMGROUP     NUMBER(10),<br>                    DATE_CREATED  DATE                            NOT NULL,<br>                    DATABASE      VARCHAR2(30 BYTE)               NOT NULL,<br>                    CONSTRAINT PK_CHEMINVDB2_COESAVEDHITID PRIMARY KEY (ID) USING INDEX TABLESPACE  ' || aIndexTableSpaceName || '<br>                  )';<br>  <br>           EXECUTE IMMEDIATE lSqlDdl;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COESAVHITLISID_USER_ID ON '   || lSchemaName || '.COESAVEDHITLISTID (USER_ID ASC)  TABLESPACE '      || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COESAVHITLISID_IS_PUBLIC ON ' || lSchemaName || '.COESAVEDHITLISTID (IS_PUBLIC ASC)  TABLESPACE '    || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COESAVHITLISID_FORMGROUP ON ' || lSchemaName || '.COESAVEDHITLISTID (FORMGROUP ASC)  TABLESPACE '    || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COESAVHITLISID_DATE_CRE ON '  || lSchemaName || '.COESAVEDHITLISTID (DATE_CREATED ASC)  TABLESPACE ' || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COESAVHITLISID_DATABASE ON '  || lSchemaName || '.COESAVEDHITLISTID (DATABASE ASC)  TABLESPACE '     || aIndexTableSpaceName;<br>        END IF;<br>  <br>        SELECT COUNT (1) INTO lExist<br>          FROM dba_tables<br>         WHERE UPPER (table_name) = 'COETEMPHITLISTID'<br>           AND UPPER (owner) = UPPER (lSchemaName);<br>  <br>        IF lExist = 0 THEN<br>           lSqlDdl := 'CREATE TABLE ' || lSchemaName || '.COETEMPHITLISTID<br>                  (<br>                    ID            NUMBER(10)                      NOT NULL,<br>                    NAME          VARCHAR2(255 BYTE)              NOT NULL,<br>                    DESCRIPTION   VARCHAR2(255 BYTE),<br>                    USER_ID       VARCHAR2(30 BYTE),<br>                    NUMBER_HITS   NUMBER(10),<br>                    IS_PUBLIC     VARCHAR2(1 BYTE)                NOT NULL,<br>                    FORMGROUP     NUMBER(10),<br>                    DATE_CREATED  DATE                            NOT NULL,<br>                    DATABASE      VARCHAR2(30 BYTE)               NOT NULL,<br>                    CONSTRAINT PK_CHEMINVDB2_COETEMPHITLISTID PRIMARY KEY (ID) USING INDEX TABLESPACE ' || aIndexTableSpaceName || '<br>                  )';<br>  <br>           EXECUTE IMMEDIATE lSqlDdl;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COEHITLISTID_USER_ID ON ' || lSchemaName || '.COETEMPHITLISTID (USER_ID ASC)  TABLESPACE ' || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COEHITLISTID_IS_PUBLIC ON ' || lSchemaName || '.COETEMPHITLISTID (IS_PUBLIC ASC)  TABLESPACE ' || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COEHITLISTID_FORMGROUP ON ' || lSchemaName || '.COETEMPHITLISTID (FORMGROUP ASC)  TABLESPACE ' || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COEHITLISTID_DATE_CREATE ON ' || lSchemaName || '.COETEMPHITLISTID (DATE_CREATED ASC)  TABLESPACE ' || aIndexTableSpaceName;<br>           EXECUTE IMMEDIATE 'CREATE INDEX ' || lSchemaName || '.INDEX_COEHITLISTID_DATABASE ON ' || lSchemaName || '.COETEMPHITLISTID (DATABASE ASC)  TABLESPACE ' || aIndexTableSpaceName;<br>  <br>           SELECT COUNT (1) INTO lExist<br>             FROM dba_sequences<br>            WHERE UPPER (sequence_name) = 'COEHITLISTID_SEQ'<br>              AND UPPER (sequence_owner) = UPPER (lSchemaName);<br>  <br>           IF lExist = 1 THEN<br>              EXECUTE IMMEDIATE 'DROP SEQUENCE ' || lSchemaName || '.COEHITLISTID_SEQ';<br>           END IF;<br>  <br>           EXECUTE IMMEDIATE 'CREATE SEQUENCE ' || lSchemaName || '.COEHITLISTID_SEQ INCREMENT BY 1 START WITH 1 MAXVALUE 1.0E27 MINVALUE 1 NOCYCLE CACHE 20 NOORDER';<br>        END IF;<br>     END;<br>  BEGIN<br>     IF aSchemaName IS NOT NULL THEN<br>        lSchemaName := aSchemaName;<br>     ELSE<br>        lSchemaName := USER;<br>     END IF;<br>  <br>     CASE UPPER (aServiceName)<br>        WHEN 'SEARCH' THEN<br>           BEGIN<br>              createSearchTables;<br>           END;<br>        WHEN 'HITLIST' THEN<br>           BEGIN<br>              createHitListTables;<br>           END;<br>        WHEN 'ALL' THEN<br>           BEGIN<br>              createSearchTables;<br>              createHitListTables;<br>           END;<br>     END CASE;<br>  EXCEPTION<br>     WHEN OTHERS THEN<br>        BEGIN<br>           Raise_Application_Error (-20000, DBMS_UTILITY.Format_Error_Stack);<br>        END;<br>  END;<br> /
</code></pre>   </td>  </tr>
</table>

 <br><br> 
<a name = "Procedure_16"></a>
<div class="caption1">COEDB.GRANTONCORETABLETOALLROLES</div><br><br> 
<table class="tabformat" border="0" cellpadding="2" cellspacing="1" width="100%">
 
  <tr>
    <td class="tabdata" > <pre><code>CREATE PROCEDURE &quot;COEDB&quot;.&quot;GRANTONCORETABLETOALLROLES&quot;  (<br>     pTableName          IN   VARCHAR2,<br>     pSchemaName         IN   object_privileges.SCHEMA%TYPE,<br>     pMinimumPrivilege   IN   VARCHAR2,<br>     pPrivTableName      IN   privilege_tables.privilege_table_name%TYPE)<br>  IS<br>     TYPE cursor_type IS REF CURSOR;<br>  <br>     roles_cur   cursor_type;<br>     theRole     VARCHAR2 (30);<br>  BEGIN<br>     -- Insert object_privs<br>     DELETE FROM COEDB.object_privileges<br>           WHERE SCHEMA = UPPER (pSchemaName)<br>             AND object_name = UPPER (pTableName);<br>  <br>     INSERT INTO COEDB.object_privileges VALUES (pMinimumPrivilege, 'SELECT', UPPER (pSchemaName), UPPER (pTableName));<br>     INSERT INTO COEDB.object_privileges VALUES (pMinimumPrivilege, 'INSERT', UPPER (pSchemaName), UPPER (pTableName));<br>     INSERT INTO COEDB.object_privileges VALUES (pMinimumPrivilege, 'DELETE', UPPER (pSchemaName), UPPER (pTableName));<br>     INSERT INTO COEDB.object_privileges VALUES (pMinimumPrivilege, 'UPDATE', UPPER (pSchemaName), UPPER (pTableName));<br>  <br>     -- Loop over all roles for this priv table<br>     manage_roles.getRoles (pPrivTableName, roles_cur);<br>     LOOP FETCH roles_cur INTO theRole;<br>     EXIT WHEN roles_cur%NOTFOUND;<br>        -- grant to role<br>        EXECUTE IMMEDIATE 'GRANT SELECT, INSERT, DELETE, UPDATE ON ' || pSchemaName || '.' || pTableName || ' TO ' || theRole;<br>     END LOOP;<br>  END grantOnCoreTableToAllRoles;<br> /
</code></pre>   </td>  </tr>
</table>

 <br><br> 
<a name = "Procedure_17"></a>
<div class="caption1">COEDB.MAPPRIVSTOROLE</div><br><br> 
<table class="tabformat" border="0" cellpadding="2" cellspacing="1" width="100%">
 
  <tr>
    <td class="tabdata" > <pre><code>CREATE PROCEDURE &quot;COEDB&quot;.&quot;MAPPRIVSTOROLE&quot;  (<br>     pRoleName   IN   security_roles.role_name%TYPE,<br>     pPrivName   IN   VARCHAR2,<br>     pAction     IN   VARCHAR2)<br>  IS<br>     cannot_revoke   EXCEPTION;<br>     PRAGMA EXCEPTION_INIT (cannot_revoke, -1927);<br>  <br>     CURSOR privs_cur (privname_in IN VARCHAR2) IS<br>        SELECT   PRIVILEGE, SCHEMA, object_name<br>            FROM COEDB.object_privileges<br>           WHERE privilege_name = privname_in AND SCHEMA IS NOT NULL<br>        ORDER BY SCHEMA, PRIVILEGE;<br>  <br>     thePrivilege    VARCHAR (30);<br>     theSchema       VARCHAR (30);<br>     theObjectName   VARCHAR (30);<br>     mySql           VARCHAR2 (2000);<br>     keyword         VARCHAR2 (10);<br>  BEGIN<br>     IF pAction = 'GRANT' THEN<br>        keyword := ' TO ';<br>     ELSE<br>        keyword := ' FROM ';<br>     END IF;<br>  <br>     OPEN privs_cur (pPrivName);<br>     LOOP FETCH privs_cur INTO thePrivilege, theSchema, theObjectName;<br>     EXIT WHEN privs_cur%NOTFOUND;<br>        mySql := pAction || ' ' || thePrivilege || ' ON ' || theSchema || '.' || theObjectName || keyword || pRoleName;<br>        EXECUTE IMMEDIATE mySql;<br>     END LOOP;<br>  <br>     CLOSE privs_cur;<br>  EXCEPTION<br>     WHEN cannot_revoke THEN<br>        RETURN;<br>     WHEN OTHERS THEN<br>        raise_application_error (-20000, 'COEDB  does not have sufficient privileges to ' || mySql);<br>  END mapPrivStoRole;<br> /
</code></pre>   </td>  </tr>
</table>

 <br><br> 
</body></html>
