<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>New Page 3</title>
</head>

<body>

<p align="center">Move Business Logic into Stored Procedures -- Registration 
System 10.0</p>
<p align="justify">&nbsp;</p>
<p align="justify">As the first step to port Reg to .Net, we are going to move 
the business logics from embedded SQLs in asp code to Stored Procedures. Because 
the post interface has the essential functionalities of Reg, and does not have 
big effect on the overall web UI functionalities, it serves a good starting 
point of the porting.</p>
<p align="justify">Here is the business logic of the post interface. Also refer 
to
<a href="http://csnet/informatics/people/sunny_yan/cschemregwebservice/documentation.htm">
API Webservice documentation</a>.</p>
<ul>
  <li>
  <p align="justify">Reg_Parameter
  <ul>
    <li>
    <p align="justify">AUTHENTICATE</li>
    <li>
    <p align="justify">ADD_COMPOUND</li>
    <li>
    <p align="justify">ADD_BATCH</li>
    <li>
    <p align="justify">ADD_SALT</li>
    <li>
    <p align="justify">ADD_IDENTIFIER</li>
  </ul>
  </li>
  <li>
  <p align="justify">Reg_Method<ul>
    <li>
    <p align="justify">REG_TEMP</li>
    <li>
    <p align="justify">REG_PERM</li>
  </ul>
  </li>
  <li>
  <p align="justify">Commit_Type -- If Null, FULL_COMMIT<ul>
    <li>
    <p align="justify">FULL_COMMIT</li>
    <li>
    <p align="justify">COMMIT_BATCH</li>
    <li>
    <p align="justify">ADD_SALT</li>
    <li>
    <p align="justify">ADD_IDENTIFIER</li>
  </ul>
  </li>
  <li>
  <p align="left">&nbsp;Return_Fields&nbsp; -- If Null, return 
  Reg_Numbers.Reg_Number (for temp?)</li>
</ul>
<p align="justify"><u>Insert into temporary tables -- Case 1. ADD_COMPOUND</u></p>
<p align="justify"><i>Call Scenario</i></p>
<ul>
  <li>
  <p align="justify">Reg_Method<ul>
    <li>
    <p align="justify">REG_TEMP</li>
  </ul>
  </li>
  <li>
  <p align="justify">Reg_Parameter<ul>
    <li>
    <p align="justify">ADD_COMPOUND</li>
  </ul>
  </li>
  <li>
  <p align="justify">Commit_Type
  <ul>
    <li>
    <p align="justify">FULL_COMMIT</li>
  </ul>
  </li>
</ul>
<p align="justify"><i>Before Insert</i></p>
<blockquote>
  <p align="justify">Validate User (asp or PL/SQL?)<br>
  Check Project_ID if RLS</p>
</blockquote>
<p align="justify"><i>Insert</i></p>
<blockquote>
  <p align="left">Relational Data, <br>
  COMMIT_TYPE, <br>
  LEGACY_REG_NUMBER <br>
  NOTEBOOK_NUMBER (1 if Null)<br>
  SALT_CODE(1 if Null)<br>
  PROJECT_ID(1 if Null)<br>
  COMPOUND_TYPE(1 if Null)<br>
  LOAD_ID<br>
  ENTRY_DATE<br>
  DATETIME_STAMP<br>
  ENTRY_PERSON_ID<br>
  BASE64_CDX<br>
  MW2<br>
  FORMULA2<br>
  CHEM_NAME_AUTOGEN</p>
  <p align="left">SALT_EQUIVALENTS<br>
  SALT_MW<br>
  SOLVATE_EQUIVALENTS<br>
  SOLVATE_MW<br>
  FORMULA_WEIGHT<br>
  PERCENT_ACTIVE</p>
</blockquote>
<p align="left">&nbsp;</p>
<p align="left">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; into 
TEMPORARY_STRUCTURES table</p>
<p align="left"><i>Output </i></p>
<blockquote>
  <p align="left">&nbsp;Error and TEMP_COMPOUND_ID of the insertion</p>
</blockquote>
<p align="justify"><u>Insert into temporary tables -- Case 2. ADD_BATCH</u></p>
<p align="justify"><i>Call Scenario</i></p>
<ul>
  <li>
  <p align="justify">Reg_Method<ul>
    <li>
    <p align="justify">REG_TEMP</li>
  </ul>
  </li>
  <li>
  <p align="justify">Reg_Parameter<ul>
    <li>
    <p align="justify"><u>ADD_BATCH</u></li>
  </ul>
  </li>
  <li>
  <p align="justify">Commit_Type
  <ul>
    <li>
    <p align="justify">COMMIT_BATCH</li>
  </ul>
  </li>
</ul>
<p align="justify">Does exactly same thing as Case 1 except the COMMIT_TYPE 
value in the table is COMMIT_BATCH</p>
<p align="justify"><u>Insert into temporary tables -- Case 3. ADD_SALT</u></p>
<p align="justify"><i>Call Scenario</i></p>
<ul>
  <li>
  <p align="justify">Reg_Method<ul>
    <li>
    <p align="justify">REG_TEMP</li>
  </ul>
  </li>
  <li>
  <p align="justify">Reg_Parameter<ul>
    <li>
    <p align="justify"><u>ADD_SALT</u></li>
  </ul>
  </li>
  <li>
  <p align="justify">Commit_Type
  <ul>
    <li>
    <p align="justify">ADD_SALT</li>
  </ul>
  </li>
</ul>
<p align="justify">Not supported? Need to confirm.</p>
<p align="justify"><u>Insert into temporary tables -- Case 4. </u><font size="3">ADD_IDENTIFIER
    </font></p>
<p align="justify"><i>Call Scenario</i></p>
<ul>
  <li>
  <p align="justify">Reg_Method<ul>
    <li>
    <p align="justify">REG_TEMP</li>
  </ul>
  </li>
  <li>
  <p align="justify">Reg_Parameter<ul>
    <li>
    <p align="justify"><font size="3">ADD_IDENTIFIER
    </font></li>
  </ul>
  </li>
</ul>
<p align="justify">Not supported? Need to confirm.</p>
<p align="justify"><u>Insert into temporary tables -- Case 5. </u>A<font size="3">UTHENTICATE
    </font></p>
<p align="justify"><i>Call Scenario</i></p>
<ul>
  <li>
  <p align="justify">Reg_Method<ul>
    <li>
    <p align="justify">REG_TEMP</li>
  </ul>
  </li>
  <li>
  <p align="justify">Reg_Parameter<ul>
    <li>
    <p align="justify">A<font size="3">UTHENTICATE
    </font></li>
  </ul>
  </li>
</ul>
<p align="justify">Returns: &quot;User Authenticated&quot;</p>
<p align="justify"><u>Insert into permanent tables -- Case 1.  </u></p>
<p align="justify"><i>Call Scenario</i></p>
<ul>
  <li>
  <p align="justify">Reg_Method<ul>
    <li>
    <p align="justify">REG_PERM</li>
  </ul>
  </li>
  <li>
  <p align="justify">Reg_Parameter<ul>
    <li>
    <p align="justify">
    <!doctype HTML PUBLIC "-//W3C//DTD W3 HTML//EN">UNIQUE_DEL_TEMP | 
    UNIQUE_DEL_TEMP2 | UNIQUE (documented as insert to perm and remove from 
    temp, but actually not removed from temp)</li>
    <li>
    <p align="justify"><font size="3">Two step operation. The compound is first 
    added to temp table???where, then a duplicate checking is performed. Adds to 
    permanent table only if no duplicates are found and removes from temp 
    table(not really).<br>
&nbsp;</font></li>
  </ul>
  </li>
  <li>
  <p align="justify">Commit_Type
  <ul>
    <li>
    <p align="justify">FULL_COMMIT</li>
  </ul>
  </li>
</ul>
<p align="justify"><i>Before Insert</i></p>
<ul>
  <li>
<p align="justify">User validation</p>
  </li>
  <li>
<p align="justify">Validate project_id if RLS turned on</p>
  </li>
  <li>
<p align="justify">Duplicate checking</p>
  </li>
</ul>
<p align="justify"><i>Insert</i></p>
<ul>
  <li>
<p align="justify">If duplicate found(single/multiple)<br>
<br>
?where is insert into temp?<br>
<br>
Insert with following tables and values</p>
  </li>
</ul>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SEQUENCE</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
NEXT_IN_SEQUENCE</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
COMPOUND_MOLECULE</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
ROOT_NUMBER</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
SEQUENCE_INTERNAL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
LOAD_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
DATETIME_STAMP</p>
<blockquote>
  <blockquote>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If RLS</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
Add to compound_project?</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STRUCTURES</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
CPD_INTERNAL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
LOAD_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
DATETIME_STAMP</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
BASE64_CDX</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
return mol_id after insertion to this table</p>
<p align="justify">MOL_ID</p>
<p align="justify">MW2</p>
<p align="justify">FORMULA2</p>
  </blockquote>
<p align="justify">REG_NUMBERS</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ROOT_NUMBER (If 
Legacy Reg Number used, insert legacy number)</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
SEQUENCE_INTERNAL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SEQUENCE_NUMBER</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REGISTRY_DATE 
(system date)</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
REGISTRAR_PERSON_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REG_NUMBER 
(generated from root_number)</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DATETIME_STAMP</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOAD_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LAST_BATCH_NUMBER</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOL_ID</p>
<p align="justify">COMPOUND_PROJECT</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CPD_INTERNAL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
PROJECT_INTERNAL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOAD_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DATETIME_STAMP</p>
<p align="justify">COMPOUND_SALT</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CPD_INTERNAL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ROOT_NUMBER</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REG_INTERNAL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SALT_INTERNAL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOAD_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DATETIME_STAMP</p>
<p align="justify">BATCHES</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; relational data</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; update 
REG_NUMBERS.LAST_BATCH_NUMBER</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REG_INTERNAL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BATCH_NUMBER</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CPD_INTERNAL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BATCH_REG_DATE</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOAD_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DATETIME_STAMP</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TEMPID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SALT_EQUIVALENTS</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SALT_MW</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
SOLVATE_EQUIVALENTS</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SOLVATE_MW</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FORMULA_WEIGHT (I 
think it is compound + salt + solvate)</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PERCENT_ACTIVE</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
BATCH_REG_PERSON_ID</p>
<p align="justify">ALT_IDS</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REG_INTERNAL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IDENTIFIER</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IDENTIFIER_TYPE</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOAD_ID&nbsp;&nbsp;&nbsp; </p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DATETIME_STAMP</p>
<p align="justify">CMPD_MOL_UTILIZATIONS</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if 
UTILIZATION_PERMISSIONS_USED = true</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CPD_INTERNAL_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UTILIZATION_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOAD_ID</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
UTILIZATION_BOOLEAN</p>
</blockquote>
<ul>
  <li>
<p align="justify">If no duplicate  found</p>
  </li>
</ul>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add to perm, if 
failed, add to temp.</p>
<p align="left"><i>Output </i></p>
<p align="justify"><u>Insert into permanent tables -- Case 2. </u></p>
<p align="justify"><i>Call Scenario</i></p>
<ul>
  <li>
  <p align="justify">Reg_Method<ul>
    <li>
    <p align="justify">REG_PERM</li>
  </ul>
  </li>
  <li>
  <p align="justify">Reg_Parameter<ul>
  <li>
<p align="justify">OVERRIDE</p>
  </li>
</ul>
  </li>
  <li>
  <p align="justify">Commit_Type
  <ul>
    <li>
    <p align="justify">FULL_COMMIT</li>
  </ul>
  </li>
</ul>
<p align="justify">If duplicate found (single/multiple)</p>

<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add to perm first, 
if failed, add to temp.</p>

<p align="justify">If no duplicate  found</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add to perm, if 
failed, add to temp.</p>
<p align="justify"><u>Insert into permanent tables -- Case 3. </u></p>
<p align="justify"><i>Call Scenario</i></p>
<ul>
  <li>
  <p align="justify">Reg_Method<ul>
    <li>
    <p align="justify">REG_PERM</li>
  </ul>
  </li>
  <li>
  <p align="justify">Reg_Parameter<ul>
  <li>
<p align="justify">NEW_BATCH</p>
  </li>
</ul>
  </li>
  <li>
  <p align="justify">Commit_Type
  <ul>
    <li>
    <p align="justify">FULL_COMMIT</li>
  </ul>
  </li>
</ul>
    <p align="justify">If duplicate found(single):<blockquote>
    <p align="justify">Based on dup_type (ADD_SALT | BATCH_COMMIT), add to salts 
    table (detail needed) or add to batch (detail needed)<p align="justify">The 
  new batch needs to be approved (detail needed)</p>

<p align="justify">If fail to add batch, add to temp table.</p>

</blockquote>
<p align="justify">If multiple duplicate found: </p>

<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; add to temp.</p>

<p align="justify">If no duplicate  found:</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add to perm, if 
failed, add to temp.</p>
<p align="justify"><u>Insert into permanent tables -- Case 4. </u></p>
<p align="justify"><i>Call Scenario</i></p>
<ul>
  <li>
  <p align="justify">Reg_Method<ul>
    <li>
    <p align="justify">REG_PERM</li>
  </ul>
  </li>
  <li>
  <p align="justify">Reg_Parameter<ul>
  <li>
<p align="justify">USER_INPUT</p>
  </li>
</ul>
  </li>
  <li>
  <p align="justify">Commit_Type
  <ul>
    <li>
    <p align="justify">FULL_COMMIT</li>
  </ul>
  </li>
</ul>
    <p align="justify">Add to temp.<p align="justify">If duplicate found 
(single):<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mark 
record as duplicate.<p align="justify">If multiple duplicate found:<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
Add to temp.<p align="justify">If no duplicate  found</p>
<p align="justify">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add to perm, if 
failed, add to temp.</p>
    <p align="justify">&nbsp;</body></html>